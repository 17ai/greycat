<html>
<head>
    <script type="text/javascript" src="java.js"></script>
    <script type="text/javascript" src="org.kevoree.modeling.microframework.typescript.js"></script>
    <script type="text/javascript" src="org.kevoree.modeling.drivers.websocket.js"></script>
    <script type="text/javascript" src="paperclip.js"></script>
</head>
<body>
<script>

    var metaModel = new org.kevoree.modeling.meta.impl.MetaModel("IoTModel");
    var sensorClass = metaModel.addMetaClass("Sensor");
    sensorClass.addAttribute("value", org.kevoree.modeling.meta.KPrimitiveTypes.LONG);
    sensorClass.addReference("sensors", sensorClass, null, true);

    var wsClient = new org.kevoree.modeling.drivers.websocket.WebSocketCDNClient("ws://localhost:8080/cdn");
    var model = metaModel.model();
    model.setContentDeliveryDriver(wsClient);
    model.connect(function () {
        model.lookup(0, 0, 1, function (obj) {
            var template = paperclip.template('<b>uuid:{{elem.uuid}}/value:{{elem.value}}</b><input class="form-control" type="text" value="{{ <~>value }}"></input><ul repeat.each="{{elem.sensors}}" repeat.as="i"><li>item {{i}} <br /></li></ul>');
            //var template = paperclip.template('elem({{elem.uuid}}),val={{elem.value}} <br /><input class="form-control" type="text" value="{{ <~>elem.value }}" />');
            var view = template.view({elem: obj });
            document.body.appendChild(view.render());
        });
    });
</script>
</body>
</html>