<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>MWG Metrics</title>
    <meta name="description" content="MWG Metrics">
    <meta name="author" content="Fouqet Francois">
    <script src="moment.js"></script>
    <script src="d3.js"></script>
    <script src="c3.js"></script>
    <link href="c3.css" rel="stylesheet" type="text/css"/>
</head>

<body>

<script>
    var oReq = new XMLHttpRequest();
    oReq.onload = function (e) {
        var charts = e.target.response;
        for (var chartName in charts) {
            var chart = charts[chartName];
            var div = document.createElement("div");
            div.id = chartName;
            var chartTitle = document.createElement("h2");
            chartTitle.innerText = chartName;
            document.body.appendChild(chartTitle);
            document.body.appendChild(div);
            var dataObj = {xs: {}, columns: []};
            for (var metric in chart) {
                var metricObj = chart[metric];
                var x = [];
                var y = [];
                y.push(metric);
                x.push('x_' + metric);
                for (var metricValues in metricObj) {
                    var valueObj = metricObj[metricValues];
                    var tpoint = moment(valueObj.time);
                    y.push(valueObj.value);
                    x.push(tpoint.toDate());
                }
                dataObj.columns.push(y);
                dataObj.columns.push(x);
                dataObj.xs[metric + ''] = 'x_' + metric;
            }
            c3.generate({
                bindto: div,
                data: dataObj,
                axis: {
                    x: {
                        type: 'timeseries',
                        tick: {
                            format: '%Y-%m-%d,%H:%M:%S'
                        }
                    }
                }
            });
        }
    };
    oReq.open('GET', "/rpc/charts", true);
    oReq.responseType = 'json';
    oReq.send();
</script>
</body>
</html>