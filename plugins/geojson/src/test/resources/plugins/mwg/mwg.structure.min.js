var __extends=this&&this.__extends||function(e,u){function v(){this.constructor=e}for(var x in u)u.hasOwnProperty(x)&&(e[x]=u[x]);e.prototype=null===u?Object.create(u):(v.prototype=u.prototype,new v)},org;
(function(e){(function(u){(function(v){var u=function(){function q(){}q.nTreeInsertTo=function(n){return e.mwg.task.Actions.newTask().action(e.mwg.structure.action.NTreeInsertTo.NAME,n)};q.nTreeNearestN=function(n){return e.mwg.task.Actions.newTask().action(e.mwg.structure.action.NTreeNearestN.NAME,n)};q.nTreeNearestWithinRadius=function(n){return e.mwg.task.Actions.newTask().action(e.mwg.structure.action.NTreeNearestWithinRadius.NAME,n)};q.nTreeNearestNWithinRadius=function(n){return e.mwg.task.Actions.newTask().action(e.mwg.structure.action.NTreeNearestNWithinRadius.NAME,
n)};return q}();v.StructureActions=u;u=function(q){function n(){q.call(this);this.declareNodeType(e.mwg.structure.tree.KDTree.NAME,function(c,a,d,b){return new e.mwg.structure.tree.KDTree(c,a,d,b)});this.declareNodeType(e.mwg.structure.tree.NDTree.NAME,function(c,a,d,b){return new e.mwg.structure.tree.NDTree(c,a,d,b)});this.declareTaskAction(e.mwg.structure.action.NTreeInsertTo.NAME,function(c){if(1!=c.length)throw Error("Bad param number!");return new e.mwg.structure.action.NTreeInsertTo(c[0])});
this.declareTaskAction(e.mwg.structure.action.TraverseById.NAME,function(c){if(1!=c.length)throw Error("Bad param number!");return new e.mwg.structure.action.TraverseById(c[0])});this.declareTaskAction(e.mwg.structure.action.NTreeNearestN.NAME,function(c){if(2>c.length)throw Error("Bad param number!");for(var a=java.lang.Integer.parseInt(c[c.length-1]),d=new Float64Array(c.length-1),b=0;b<c.length-1;b++)d[b]=parseFloat(c[b]);return new e.mwg.structure.action.NTreeNearestN(d,a)});this.declareTaskAction(e.mwg.structure.action.NTreeNearestWithinRadius.NAME,
function(c){if(2>c.length)throw Error("Bad param number!");for(var a=parseFloat(c[c.length-1]),d=new Float64Array(c.length-1),b=0;b<c.length-1;b++)d[b]=parseFloat(c[b]);return new e.mwg.structure.action.NTreeNearestWithinRadius(d,a)});this.declareTaskAction(e.mwg.structure.action.NTreeNearestNWithinRadius.NAME,function(c){if(3>c.length)throw Error("Bad param number!");for(var a=parseFloat(c[c.length-1]),d=java.lang.Integer.parseInt(c[c.length-2]),b=new Float64Array(c.length-2),p=0;p<c.length-2;p++)b[p]=
parseFloat(c[p]);return new e.mwg.structure.action.NTreeNearestNWithinRadius(b,d,a)})}__extends(n,q);return n}(e.mwg.plugin.AbstractPlugin);v.StructurePlugin=u;(function(q){var n=function(c){function a(a){c.call(this);this._variableName=a}__extends(a,c);a.prototype.eval=function(a){var b=a.result(),p=a.variable(a.template(this._variableName));if(null!=b&&null!=p){for(var h=a.graph().newCounter(b.size()),b=b.iterator(),c=b.next();null!=c;){if(c instanceof e.mwg.plugin.AbstractNode)for(var f=p.iterator(),
k=f.next();null!=k;)k instanceof e.mwg.structure.tree.KDTree?k.insert(c,function(a){h.count()}):h.count(),k=f.next();else h.count();c=b.next()}h.then(function(){a.continueTask()})}else a.continueTask()};a.prototype.toString=function(){return"nTreeInsertTo('"+this._variableName+"')"};a.NAME="nTreeInsertTo";return a}(e.mwg.plugin.AbstractTaskAction);q.NTreeInsertTo=n;n=function(c){function a(a,b){c.call(this);this._key=a;this._n=b}__extends(a,c);a.prototype.eval=function(a){var b=a.result(),p=a.newResult();
if(null!=b){for(var h=a.graph().newCounter(b.size()),b=b.iterator(),c=b.next();null!=c;)c instanceof e.mwg.structure.tree.KDTree?c.nearestN(this._key,this._n,function(a){for(var b=0;b<a.length;b++)p.add(a[b]);h.count()}):h.count(),c=b.next();h.then(function(){a.continueWith(p)})}else a.continueWith(p)};a.prototype.toString=function(){return"nTreeNearestN('')"};a.NAME="nTreeNearestN";return a}(e.mwg.plugin.AbstractTaskAction);q.NTreeNearestN=n;n=function(c){function a(a,b,p){c.call(this);this._key=
a;this._n=b;this._radius=p}__extends(a,c);a.prototype.eval=function(a){var b=a.result(),p=a.newResult();if(null!=b){for(var h=a.graph().newCounter(b.size()),b=b.iterator(),c=b.next();null!=c;)c instanceof e.mwg.structure.tree.KDTree?c.nearestNWithinRadius(this._key,this._n,this._radius,function(a){for(var b=0;b<a.length;b++)p.add(a[b]);h.count()}):h.count(),c=b.next();h.then(function(){a.continueWith(p)})}else a.continueWith(p)};a.prototype.toString=function(){return"nTreeNearestNWithinRadius('')"};
a.NAME="nTreeNearestNWithinRadius";return a}(e.mwg.plugin.AbstractTaskAction);q.NTreeNearestNWithinRadius=n;n=function(c){function a(a,b){c.call(this);this._key=a;this._radius=b}__extends(a,c);a.prototype.eval=function(a){var b=a.result(),p=a.newResult();if(null!=b){for(var h=a.graph().newCounter(b.size()),b=b.iterator(),c=b.next();null!=c;)c instanceof e.mwg.structure.tree.KDTree?c.nearestWithinRadius(this._key,this._radius,function(a){for(var b=0;b<a.length;b++)p.add(a[b]);h.count()}):h.count(),
c=b.next();h.then(function(){a.continueWith(p)})}else a.continueWith(p)};a.prototype.toString=function(){return"nTreeNearestWithinRadius('')"};a.NAME="nTreeNearestWithinRadius";return a}(e.mwg.plugin.AbstractTaskAction);q.NTreeNearestWithinRadius=n;n=function(c){function a(a){c.call(this);this._name=a}__extends(a,c);a.prototype.eval=function(a){var b=a.wrap(null),p=java.lang.Long.parseLong(a.template(this._name)),c=a.result();if(null!=c){for(var g=c.size(),f=a.graph().newCounter(g),k=function(a){var d=
c.get(a);d instanceof e.mwg.plugin.AbstractNode?d.relByIndex(p,function(a){if(null!=a)for(var p=0;p<a.length;p++)b.add(a[p]);d.free();f.count()}):(b.add(d),f.count())},m=0;m<g;m++)k(m);f.then(function(){c.clear();a.continueWith(b)})}else a.continueTask()};a.prototype.toString=function(){return"traverseById('"+this._name+"')"};a.NAME="traverseById";return a}(e.mwg.plugin.AbstractTaskAction);q.TraverseById=n})(v.action||(v.action={}));(function(q){var n=function(){function c(){}c.instance=function(){null==
c.static_instance&&(c.static_instance=new e.mwg.structure.distance.CosineDistance);return c.static_instance};c.prototype.measure=function(a,d){for(var b=0,p=0,e=0,c=0;c<a.length;c++)b+=a[c]*d[c],p+=a[c]*a[c],e+=d[c]*d[c];b/=Math.sqrt(p)*Math.sqrt(e);0>b&&(b=0);return 1-b};c.prototype.compare=function(a,d){return a<d};c.prototype.getMinValue=function(){return 0};c.prototype.getMaxValue=function(){return java.lang.Double.MAX_VALUE};c.static_instance=null;return c}();q.CosineDistance=n;n=function(){function e(){}
e.EUCLIDEAN=0;e.GEODISTANCE=1;e.COSINE=2;return e}();q.Distances=n;n=function(){function c(){}c.instance=function(){null==c.static_instance&&(c.static_instance=new e.mwg.structure.distance.EuclideanDistance);return c.static_instance};c.prototype.measure=function(a,d){for(var b=0,p=0;p<a.length;p++)b+=(a[p]-d[p])*(a[p]-d[p]);return Math.sqrt(b)};c.prototype.compare=function(a,d){return a<d};c.prototype.getMinValue=function(){return 0};c.prototype.getMaxValue=function(){return java.lang.Double.MAX_VALUE};
c.static_instance=null;return c}();q.EuclideanDistance=n;n=function(){function c(){}c.instance=function(){null==c.static_instance&&(c.static_instance=new e.mwg.structure.distance.GeoDistance);return c.static_instance};c.prototype.measure=function(a,d){var b=e.mwg.structure.distance.GeoDistance.toRadians(d[0]-a[0]),p=e.mwg.structure.distance.GeoDistance.toRadians(d[1]-a[1]),b=Math.sin(b/2)*Math.sin(b/2)+Math.cos(e.mwg.structure.distance.GeoDistance.toRadians(a[0]))*Math.cos(e.mwg.structure.distance.GeoDistance.toRadians(d[0]))*
Math.sin(p/2)*Math.sin(p/2);return 12742E3*Math.atan2(Math.sqrt(b),Math.sqrt(1-b))};c.toRadians=function(a){return a*Math.PI/180};c.prototype.compare=function(a,d){return a<d};c.prototype.getMinValue=function(){return 0};c.prototype.getMaxValue=function(){return java.lang.Double.MAX_VALUE};c.static_instance=null;return c}();q.GeoDistance=n;n=function(){function c(){}c.instance=function(){null==c.static_instance&&(c.static_instance=new e.mwg.structure.distance.PearsonDistance);return c.static_instance};
c.prototype.measure=function(a,d){for(var b=0,p=0,e=0,c=0,f=0,k=0;k<a.length;k++)b+=a[k]*d[k],p+=a[k],c+=d[k],e+=a[k]*a[k],f+=d[k]*d[k];k=a.length;return(b-p*c/k)/Math.sqrt((e-p*p/k)*(f-c*c/k))};c.prototype.compare=function(a,d){return Math.abs(a)>Math.abs(d)};c.prototype.getMinValue=function(){return 1};c.prototype.getMaxValue=function(){return 0};c.static_instance=null;return c}();q.PearsonDistance=n})(v.distance||(v.distance={}));(function(q){var n=function(c){function a(a,b,p,e){c.call(this,a,
b,p,e)}__extends(a,c);a.initFindNear=function(){var a=e.mwg.task.Actions.newTask();a.then(function(a){var d=a.resultAsNodes().get(0);if(null!=d){var c=d.get(e.mwg.structure.tree.KDTree.KEY),g=a.variable("dim").get(0),f=a.variable("key").get(0),k=a.variable("distance").get(0),m=a.variable("lev").get(0),l=a.variable("hr").get(0),t=a.variable("max_dist_sqd").get(0),r=m%g,k=k.measure(c,f),g=l.clone();l.max[r]=c[r];g.min[r]=c[r];f[r]<c[r]?(c=d.get(e.mwg.structure.tree.KDTree.LEFT),r=e.mwg.structure.tree.KDTree.LEFT,
f=l,d=d.get(e.mwg.structure.tree.KDTree.RIGHT),l=g,g=e.mwg.structure.tree.KDTree.RIGHT):(c=d.get(e.mwg.structure.tree.KDTree.RIGHT),f=g,r=e.mwg.structure.tree.KDTree.RIGHT,d=d.get(e.mwg.structure.tree.KDTree.LEFT),g=e.mwg.structure.tree.KDTree.LEFT);a.defineVariable("further_hr",l);a.defineVariable("pivot_to_target",k);null!=c&&0!=c.size()?(a.defineVariable("near",r),a.defineVariableForSubTask("hr",f),a.defineVariableForSubTask("max_dist_sqd",t),a.defineVariableForSubTask("lev",m+1)):a.defineVariableForSubTask("near",
a.newResult());null!=d&&0!=d.size()?a.defineVariableForSubTask("far",g):a.defineVariableForSubTask("far",a.newResult())}a.continueTask()}).isolate(e.mwg.task.Actions.ifThen(function(a){return 0<a.variable("near").size()},e.mwg.task.Actions.traverse("{{near}}").isolate(a))).then(function(a){var d=a.variable("nnl").get(0),c=a.variable("key").get(0),g=a.variable("distance").get(0),f=a.variable("max_dist_sqd").get(0),k=a.variable("further_hr").get(0),m=a.variable("pivot_to_target").get(0),l=a.variable("lev").get(0),
t=a.resultAsNodes().get(0),r;r=d.isCapacityReached()?d.getMaxPriority():java.lang.Double.MAX_VALUE;var w=Math.min(f,r),B=k.closest(c);g.measure(B,c)<f?(m<r&&(r=m,d.insert(t.get(e.mwg.structure.tree.KDTree.VALUE).get(0),r),t.get(e.mwg.structure.tree.KDTree.KEY),w=d.isCapacityReached()?d.getMaxPriority():java.lang.Double.MAX_VALUE),a.defineVariableForSubTask("hr",k),a.defineVariableForSubTask("max_dist_sqd",w),a.defineVariableForSubTask("lev",l+1),a.defineVariable("continueFar",!0)):a.defineVariable("continueFar",
!1);a.continueTask()}).isolate(e.mwg.task.Actions.ifThen(function(a){return a.variable("continueFar").get(0)&&0<a.variable("far").size()},e.mwg.task.Actions.traverse("{{far}}").isolate(a)));return a};a.initFindRadius=function(){var a=e.mwg.task.Actions.newTask();a.then(function(a){var d=a.resultAsNodes().get(0);if(null!=d){var c=d.get(e.mwg.structure.tree.KDTree.KEY),g=a.variable("dim").get(0),f=a.variable("key").get(0),k=a.variable("distance").get(0),m=a.variable("lev").get(0),l=a.variable("hr").get(0),
t=a.variable("max_dist_sqd").get(0),r=m%g,k=k.measure(c,f),g=l.clone();l.max[r]=c[r];g.min[r]=c[r];f[r]<c[r]?(c=d.get(e.mwg.structure.tree.KDTree.LEFT),r=e.mwg.structure.tree.KDTree.LEFT,f=l,d=d.get(e.mwg.structure.tree.KDTree.RIGHT),l=g,g=e.mwg.structure.tree.KDTree.RIGHT):(c=d.get(e.mwg.structure.tree.KDTree.RIGHT),f=g,r=e.mwg.structure.tree.KDTree.RIGHT,d=d.get(e.mwg.structure.tree.KDTree.LEFT),g=e.mwg.structure.tree.KDTree.LEFT);a.defineVariable("further_hr",l);a.defineVariable("pivot_to_target",
k);null!=c&&0!=c.size()?(a.defineVariable("near",r),a.defineVariableForSubTask("hr",f),a.defineVariableForSubTask("max_dist_sqd",t),a.defineVariableForSubTask("lev",m+1)):a.defineVariableForSubTask("near",a.newResult());null!=d&&0!=d.size()?a.defineVariableForSubTask("far",g):a.defineVariableForSubTask("far",a.newResult())}a.continueTask()}).isolate(e.mwg.task.Actions.ifThen(function(a){return 0<a.variable("near").size()},e.mwg.task.Actions.traverse("{{near}}").isolate(a))).then(function(a){var d=
a.variable("nnl").get(0),c=a.variable("key").get(0),g=a.variable("distance").get(0),f=a.variable("radius").get(0),k=a.variable("max_dist_sqd").get(0),m=a.variable("further_hr").get(0),l=a.variable("pivot_to_target").get(0),t=a.variable("lev").get(0),r=a.resultAsNodes().get(0),w=java.lang.Double.MAX_VALUE,B=Math.min(k,w),n=m.closest(c);g.measure(n,c)<k?(l<w&&(w=l,w<=f&&d.insert(r.get(e.mwg.structure.tree.KDTree.VALUE).get(0),w),B=java.lang.Double.MAX_VALUE),a.defineVariableForSubTask("hr",m),a.defineVariableForSubTask("max_dist_sqd",
B),a.defineVariableForSubTask("lev",t+1),a.defineVariable("continueFar",!0)):a.defineVariable("continueFar",!1);a.continueTask()}).isolate(e.mwg.task.Actions.ifThen(function(a){return a.variable("continueFar").get(0)&&0<a.variable("far").size()},e.mwg.task.Actions.traverse("{{far}}").isolate(a)));return a};a.prototype.setProperty=function(d,b,e){a.enforcer.check(d,b,e);c.prototype.setProperty.call(this,d,b,e)};a.prototype.insert=function(a,b){var e=this;this.extractFeatures(a,function(c){e.insertWith(c,
a,b)})};a.prototype.insertWith=function(d,b,e){var c=this.unphasedState(),g=c.getFromKeyWithDefault(a.DIMENSIONS,d.length),f=c.getFromKeyWithDefault(a.DISTANCE_THRESHOLD,a.DISTANCE_THRESHOLD_DEF);if(d.length!=g)throw Error("Key size should always be the same");if(null==b)throw Error("To index node should not be null");var c=this.getDistance(c),k=a.insert.prepareWith(this.graph(),this,function(a){a.free();null!=e&&e(!0)}),m=k.newResult();m.add(d);k.setGlobalVariable("key",m);k.setGlobalVariable("value",
b);k.setGlobalVariable("root",this);k.setGlobalVariable("distance",c);k.setGlobalVariable("dim",g);k.setGlobalVariable("err",f);k.defineVariable("lev",0);a.insert.executeUsing(k)};a.prototype.size=function(){return this.graph().resolver().resolveState(this).getFromKeyWithDefault(a.SIZE,0)};a.prototype.setDistance=function(d){this.set(a.DISTANCE,d)};a.prototype.setFrom=function(d){this.set(a.FROM,d)};a.prototype.nearestNWithinRadius=function(d,b,c,h){var g=this,f=this.unphasedState(),k=f.getFromKeyWithDefault(a.DIMENSIONS,
d.length);if(d.length!=k)throw Error("Key size should always be the same");var m=e.mwg.structure.util.HRect.infiniteHRect(d.length),l=java.lang.Double.MAX_VALUE,t=new e.mwg.structure.util.NearestNeighborList(b);b=this.getDistance(f);var f=a.nearestTask.prepareWith(this.graph(),this,function(a){var d=t.getAllNodesWithin(c);a=e.mwg.task.Actions.setWorld(java.lang.String.valueOf(g.world())).setTime(java.lang.String.valueOf(g.time())).fromVar("res").lookupAll("{{result}}");var b=a.prepareWith(g.graph(),
null,function(a){for(var d=Array(a.size()),b=0;b<a.size();b++)d[b]=a.get(b);h(d)}),d=b.wrap(d);b.addToGlobalVariable("res",d);a.executeUsing(b)}),r=f.newResult();r.add(d);f.setGlobalVariable("key",r);f.setGlobalVariable("distance",b);f.setGlobalVariable("dim",k);f.setGlobalVariable("nnl",t);f.defineVariable("lev",0);f.defineVariable("hr",m);f.defineVariable("max_dist_sqd",l);a.nearestTask.executeUsing(f)};a.prototype.nearestWithinRadius=function(d,b,c){var h=this,g=this.unphasedState(),f=g.getFromKeyWithDefault(a.DIMENSIONS,
d.length);if(d.length!=f)throw Error("Key size should always be the same");var k=e.mwg.structure.util.HRect.infiniteHRect(d.length),m=java.lang.Double.MAX_VALUE,l=new e.mwg.structure.util.NearestNeighborArrayList,g=this.getDistance(g),t=a.nearestRadiusTask.prepareWith(this.graph(),this,function(a){var d=l.distroyAndGetAllNodes();a=e.mwg.task.Actions.setWorld(java.lang.String.valueOf(h.world())).setTime(java.lang.String.valueOf(h.time())).fromVar("res").lookupAll("{{result}}");var b=a.prepareWith(h.graph(),
null,function(a){for(var d=Array(a.size()),b=0;b<a.size();b++)d[b]=a.get(b);c(d)}),d=b.wrap(d);b.addToGlobalVariable("res",d);a.executeUsing(b)}),r=t.newResult();r.add(d);t.setGlobalVariable("key",r);t.setGlobalVariable("distance",g);t.setGlobalVariable("dim",f);t.setGlobalVariable("nnl",l);t.setGlobalVariable("radius",b);t.defineVariable("lev",0);t.defineVariable("hr",k);t.defineVariable("max_dist_sqd",m);a.nearestRadiusTask.executeUsing(t)};a.prototype.nearestN=function(d,b,c){var h=this,g=this.unphasedState(),
f=g.getFromKeyWithDefault(a.DIMENSIONS,d.length);if(d.length!=f)throw Error("Key size should always be the same");var k=e.mwg.structure.util.HRect.infiniteHRect(d.length),m=java.lang.Double.MAX_VALUE,l=new e.mwg.structure.util.NearestNeighborList(b);b=this.getDistance(g);var g=a.nearestTask.prepareWith(this.graph(),this,function(a){var d=l.getNodes();a=e.mwg.task.Actions.setWorld(java.lang.String.valueOf(h.world())).setTime(java.lang.String.valueOf(h.time())).fromVar("res").lookupAll("{{result}}");
var b=a.prepareWith(h.graph(),null,function(a){for(var d=Array(a.size()),b=0;b<a.size();b++)d[b]=a.get(b);c(d)}),d=b.wrap(d);b.addToGlobalVariable("res",d);a.executeUsing(b)}),t=g.newResult();t.add(d);g.setGlobalVariable("key",t);g.setGlobalVariable("distance",b);g.setGlobalVariable("dim",f);g.setGlobalVariable("nnl",l);g.defineVariable("lev",0);g.defineVariable("hr",k);g.defineVariable("max_dist_sqd",m);a.nearestTask.executeUsing(g)};a.prototype.getDistance=function(d){d=d.getFromKeyWithDefault(a.DISTANCE,
a.DISTANCE_TYPE_DEF);if(d==e.mwg.structure.distance.Distances.EUCLIDEAN)d=e.mwg.structure.distance.EuclideanDistance.instance();else if(d==e.mwg.structure.distance.Distances.GEODISTANCE)d=e.mwg.structure.distance.GeoDistance.instance();else throw Error("Unknown distance code metric");return d};a.prototype.extractFeatures=function(d,b){var p=this,h=c.prototype.get.call(this,a.FROM);if(null!=h){for(var h=h.split(","),g=Array(h.length),f=0;f<h.length;f++){var k=e.mwg.task.Actions.setWorld(""+this.world());
k.setTime(this.time()+"");k.parse(h[f].trim());g[f]=k}for(var m=new Float64Array(g.length),l=this.graph().newCounter(g.length),k=function(a){var b=e.mwg.task.Actions.newTask().emptyResult();b.add(d);(function(a){g[a].executeWith(p.graph(),b,function(d){null==d?m[a]=e.mwg.Constants.NULL_LONG:(m[a]=parseFloat(d.get(0).toString()),d.free());l.count()})})(a)},f=0;f<h.length;f++)k(f);l.then(function(){b(m)})}else b(null)};a.NAME="KDTree";a.FROM="from";a.LEFT="left";a.RIGHT="right";a.KEY="key";a.VALUE=
"value";a.SIZE="size";a.DIMENSIONS="dimensions";a.DISTANCE="distance";a.DISTANCE_THRESHOLD="threshold";a.DISTANCE_THRESHOLD_DEF=1E-10;a.DISTANCE_TYPE_DEF=0;a.insert=e.mwg.task.Actions.whileDo(function(a){var b=a.resultAsNodes().get(0),c=b.get(e.mwg.structure.tree.KDTree.KEY),h=a.variable("dim").get(0),g=a.variable("key").get(0),f=a.variable("value").get(0),k=a.variable("root").get(0),m=a.variable("distance").get(0),l=a.variable("err").get(0),t=a.variable("lev").get(0);if(null==c)return b.setProperty(e.mwg.structure.tree.KDTree.DIMENSIONS,
e.mwg.Type.INT,h),b.setProperty(e.mwg.structure.tree.KDTree.KEY,e.mwg.Type.DOUBLE_ARRAY,g),b.getOrCreateRel(e.mwg.structure.tree.KDTree.VALUE).clear().add(f.id()),b.setProperty(e.mwg.structure.tree.KDTree.SIZE,e.mwg.Type.INT,1),!1;if(m.measure(g,c)<l)return b.getOrCreateRel(e.mwg.structure.tree.KDTree.VALUE).clear().add(f.id()),!1;g[t]>c[t]?(m=b.get(e.mwg.structure.tree.KDTree.RIGHT),c=e.mwg.structure.tree.KDTree.RIGHT):(m=b.get(e.mwg.structure.tree.KDTree.LEFT),c=e.mwg.structure.tree.KDTree.LEFT);
if(null==m||0==m.size())return a=a.graph().newTypedNode(b.world(),b.time(),e.mwg.structure.tree.KDTree.NAME),a.setProperty(e.mwg.structure.tree.KDTree.KEY,e.mwg.Type.DOUBLE_ARRAY,g),a.getOrCreateRel(e.mwg.structure.tree.KDTree.VALUE).clear().add(f.id()),b.getOrCreateRel(c).clear().add(a.id()),k.setProperty(e.mwg.structure.tree.KDTree.SIZE,e.mwg.Type.INT,k.get(e.mwg.structure.tree.KDTree.SIZE)+1),a.free(),!1;a.setGlobalVariable("next",c);a.setGlobalVariable("lev",(t+1)%h);return!0},e.mwg.task.Actions.traverse("{{next}}"));
a.nearestTask=a.initFindNear();a.nearestRadiusTask=a.initFindRadius();a.enforcer=(new e.mwg.utility.Enforcer).asPositiveDouble(a.DISTANCE_THRESHOLD);return a}(e.mwg.plugin.AbstractNode);q.KDTree=n;n=function(c){function a(a,b,e,h){c.call(this,a,b,e,h)}__extends(a,c);a.initNearestTask=function(){var a=e.mwg.task.Actions.newTask();a.defineVar("parent").then(function(a){var d=a.result().get(0),c=d.graph().resolver().resolveState(d),d=a.variable("nnl").get(0),g=c.get(e.mwg.structure.tree.NDTree._VALUES);
if(null!=g){for(var f=a.variable("dim").get(0),k=new Float64Array(f),c=c.get(e.mwg.structure.tree.NDTree._KEYS),m=a.variable("key").get(0),l=a.variable("distance").get(0),t=0;t<g.size();t++){for(var r=0;r<f;r++)k[r]=c[t*f+r];d.insert(g.get(t),l.measure(k,m))}a.continueWith(null)}else{var w=c.get(e.mwg.structure.tree.NDTree._BOUNDMAX),n=c.get(e.mwg.structure.tree.NDTree._BOUNDMIN),q=a.variable("key").get(0),D=a.variable("distance").get(0),g=d.getWorstDistance();if(!d.isCapacityReached()||e.mwg.structure.tree.NDTree.getclosestDistance(q,
n,w,D)<=g){var A=a.variable("precision").get(0),u=n.length,v=new Float64Array(u),y=new Float64Array(u),z=new e.mwg.structure.util.NearestNeighborArrayList;c.each(function(a,d,b){if(a>=e.mwg.structure.tree.NDTree._RELCONST){d=e.mwg.structure.tree.NDTree.binaryFromLong(a,u);for(b=0;b<u;b++)d[b]?(v[b]=w[b]-Math.max((w[b]-n[b])/2,A[b]),y[b]=w[b]):(v[b]=n[b],y[b]=Math.max((w[b]-n[b])/2,A[b])+n[b]);z.insert(a,e.mwg.structure.tree.NDTree.getclosestDistance(q,v,y,D))}});z.sort();d=z.getNodes();a.continueWith(a.wrap(d))}else a.continueWith(null)}}).foreach(e.mwg.task.Actions.defineVar("relid").fromVar("parent").action(e.mwg.structure.action.TraverseById.NAME,
"{{relid}}").subTask(a));return a};a.initRadusTask=function(){var a=e.mwg.task.Actions.newTask();a.defineVar("parent").then(function(a){var d=a.result().get(0),c=d.graph().resolver().resolveState(d),d=a.variable("nnl").get(0),g=c.get(e.mwg.structure.tree.NDTree._VALUES);if(null!=g){for(var f=a.variable("dim").get(0),k=new Float64Array(f),c=c.get(e.mwg.structure.tree.NDTree._KEYS),m=a.variable("key").get(0),l=a.variable("distance").get(0),t=0;t<g.size();t++){for(var r=0;r<f;r++)k[r]=c[t*f+r];d.insert(g.get(t),
l.measure(k,m))}a.continueWith(null)}else{var n=c.get(e.mwg.structure.tree.NDTree._BOUNDMAX),q=c.get(e.mwg.structure.tree.NDTree._BOUNDMIN),u=a.variable("key").get(0),v=a.variable("distance").get(0),d=a.variable("radius").get(0);if(e.mwg.structure.tree.NDTree.getclosestDistance(u,q,n,v)<=d){var A=a.variable("precision").get(0),C=q.length,x=new Float64Array(C),y=new Float64Array(C),z=new e.mwg.structure.util.NearestNeighborArrayList;c.each(function(a,d,b){if(a>=e.mwg.structure.tree.NDTree._RELCONST){d=
e.mwg.structure.tree.NDTree.binaryFromLong(a,C);for(b=0;b<C;b++)d[b]?(x[b]=n[b]-Math.max((n[b]-q[b])/2,A[b]),y[b]=n[b]):(x[b]=q[b],y[b]=Math.max((n[b]-q[b])/2,A[b])+q[b]);z.insert(a,e.mwg.structure.tree.NDTree.getclosestDistance(u,x,y,v))}});z.sort();d=z.getNodes();a.continueWith(a.wrap(d))}else a.continueWith(null)}}).foreach(e.mwg.task.Actions.defineVar("relid").fromVar("parent").action(e.mwg.structure.action.TraverseById.NAME,"{{relid}}").subTask(a));return a};a.prototype.setUpdateStat=function(d){this.unphasedState().set(a._STAT,
e.mwg.Type.BOOL,d)};a.updateGaussian=function(d,b){var c=0,h=d.get(a._TOTAL);null!=h&&(c=h);if(0==c)d.set(a._TOTAL,e.mwg.Type.INT,1),d.set(a._SUM,e.mwg.Type.DOUBLE_ARRAY,b);else{var h=b.length,g,f;if(1==c){g=d.get(a._SUM);f=new Float64Array(h*(h+1)/2);for(var k=0,m=0;m<h;m++)for(var l=m;l<h;l++)f[k]=g[m]*g[l],k++}else g=d.get(a._SUM),f=d.get(a._SUMSQ);for(m=0;m<h;m++)g[m]+=b[m];for(m=k=0;m<h;m++)for(l=m;l<h;l++)f[k]+=b[m]*b[l],k++;c++;d.set(a._TOTAL,e.mwg.Type.INT,c);d.set(a._SUM,e.mwg.Type.DOUBLE_ARRAY,
g);d.set(a._SUMSQ,e.mwg.Type.DOUBLE_ARRAY,f)}};a.prototype.getTotal=function(){var d=c.prototype.getByIndex.call(this,a._TOTAL);return null==d?0:d};a.prototype.getAvg=function(){var d=this.getTotal();if(0==d)return null;if(1==d)return c.prototype.getByIndex.call(this,a._SUM);for(var b=c.prototype.getByIndex.call(this,a._SUM),e=0;e<b.length;e++)b[e]/=d;return b};a.prototype.getCovarianceArray=function(d,b){if(null==d){var e=new Float64Array(b.length);java.lang.System.arraycopy(b,0,e,0,b.length);return e}null==
b&&(b=new Float64Array(d.length));var e=d.length,h=this.getTotal();if(0==h)return null;if(1<h){var g=new Float64Array(e),f=c.prototype.getByIndex.call(this,a._SUMSQ),k;k=h/(h-1);for(var m=0,l=0;l<e;l++)g[l]=(f[m]/h-d[l]*d[l])*k,g[l]<b[l]&&(g[l]=b[l]),m+=e-l;return g}e=new Float64Array(b.length);java.lang.System.arraycopy(b,0,e,0,b.length);return e};a.getRelationId=function(a,b){for(var c=Long.UZERO,h=0;h<a.length;h++)0!=h&&(c=c.shiftLeft(1)),b[h]>a[h]&&(c=c.add(Long.ONE));return c.add(Long.fromNumber(e.mwg.structure.tree.NDTree._RELCONST,
!0)).toNumber()};a.binaryFromLong=function(d,b){for(var c=d-a._RELCONST,e=c>>1,g=[],f=0;f<b;f++)g[b-f-1]=1==c-(e<<1),c=e,e=c>>1;return g};a.prototype.setProperty=function(d,b,p){d===a.BOUNDMIN?(d=this.unphasedState(),d.set(a._BOUNDMIN,e.mwg.Type.DOUBLE_ARRAY,p)):d===a.BOUNDMAX?(d=this.unphasedState(),d.set(a._BOUNDMAX,e.mwg.Type.DOUBLE_ARRAY,p)):d===a.PRECISION?(d=this.unphasedState(),d.set(a._PRECISION,e.mwg.Type.DOUBLE_ARRAY,p)):c.prototype.setProperty.call(this,d,b,p)};a.prototype.getDistance=
function(d){d=d.getWithDefault(a._DISTANCE,a.DISTANCE_TYPE_DEF);if(d==e.mwg.structure.distance.Distances.EUCLIDEAN)d=e.mwg.structure.distance.EuclideanDistance.instance();else if(d==e.mwg.structure.distance.Distances.GEODISTANCE)d=e.mwg.structure.distance.GeoDistance.instance();else throw Error("Unknown distance code metric");return d};a.prototype.setDistance=function(d){this.setPropertyByIndex(a._DISTANCE,e.mwg.Type.INT,d)};a.prototype.setFrom=function(d){this.setPropertyByIndex(a._FROM,e.mwg.Type.STRING,
d)};a.prototype.nearestN=function(d,b,c){var h=this,g=this.unphasedState(),f=g.get(a._DIM);if(null==f)c(null);else{if(d.length!=f)throw Error("Key size should always be the same");var k=new e.mwg.structure.util.NearestNeighborList(b),m=this.getDistance(g);b=a.nearestTask.prepareWith(this.graph(),this,function(a){var d=k.getNodes();a=e.mwg.task.Actions.setWorld(java.lang.String.valueOf(h.world())).setTime(java.lang.String.valueOf(h.time())).fromVar("res").lookupAll("{{result}}");var b=a.prepareWith(h.graph(),
null,function(a){for(var d=Array(a.size()),b=0;b<a.size();b++)d[b]=a.get(b);c(d)}),d=b.wrap(d);b.addToGlobalVariable("res",d);a.executeUsing(b)});var l=b.newResult();l.add(d);b.setGlobalVariable("key",l);b.setGlobalVariable("distance",m);b.setGlobalVariable("dim",f);d=g.get(a._PRECISION);g=b.newResult();g.add(d);b.setGlobalVariable("precision",g);b.setGlobalVariable("nnl",k);a.nearestTask.executeUsing(b)}};a.prototype.nearestWithinRadius=function(d,b,c){var h=this,g=this.unphasedState(),f=g.get(a._DIM);
if(null==f)c(null);else{if(d.length!=f)throw Error("Key size should always be the same");var k=new e.mwg.structure.util.NearestNeighborArrayList,m=this.getDistance(g),l=a.nearestRadiusTask.prepareWith(this.graph(),this,function(a){var d=k.getNodes();a=e.mwg.task.Actions.setWorld(java.lang.String.valueOf(h.world())).setTime(java.lang.String.valueOf(h.time())).fromVar("res").lookupAll("{{result}}");var b=a.prepareWith(h.graph(),null,function(a){for(var d=Array(a.size()),b=0;b<a.size();b++)d[b]=a.get(b);
c(d)}),d=b.wrap(d);b.addToGlobalVariable("res",d);a.executeUsing(b)}),t=l.newResult();t.add(d);l.setGlobalVariable("key",t);l.setGlobalVariable("distance",m);l.setGlobalVariable("dim",f);l.setGlobalVariable("radius",b);d=g.get(a._PRECISION);b=l.newResult();b.add(d);l.setGlobalVariable("precision",b);l.setGlobalVariable("nnl",k);a.nearestRadiusTask.executeUsing(l)}};a.prototype.nearestNWithinRadius=function(d,b,c,h){var g=this,f=this.unphasedState(),k=f.get(a._DIM);if(null==k)h(null);else{if(d.length!=
k)throw Error("Key size should always be the same");var m=new e.mwg.structure.util.NearestNeighborList(b),l=this.getDistance(f);b=a.nearestTask.prepareWith(this.graph(),this,function(a){var d=m.getAllNodesWithin(c);a=e.mwg.task.Actions.setWorld(java.lang.String.valueOf(g.world())).setTime(java.lang.String.valueOf(g.time())).fromVar("res").lookupAll("{{result}}");var b=a.prepareWith(g.graph(),null,function(a){for(var d=Array(a.size()),b=0;b<a.size();b++)d[b]=a.get(b);h(d)}),d=b.wrap(d);b.addToGlobalVariable("res",
d);a.executeUsing(b)});var t=b.newResult();t.add(d);b.setGlobalVariable("key",t);b.setGlobalVariable("distance",l);b.setGlobalVariable("dim",k);d=f.get(a._PRECISION);f=b.newResult();f.add(d);b.setGlobalVariable("precision",f);b.setGlobalVariable("nnl",m);a.nearestTask.executeUsing(b)}};a.prototype.insertWith=function(d,b,c){var h=this.unphasedState(),g=h.get(a._PRECISION);null==h.get(a._DIM)&&h.set(a._DIM,e.mwg.Type.INT,d.length);var f=h.getWithDefault(a._DIM,d.length);if(d.length!=f)throw Error("Key size should always be the same");
var f=a.insert.prepareWith(this.graph(),this,function(a){a.free();null!=c&&c(!0)}),k=f.newResult();k.add(d);f.setGlobalVariable("key",k);null!=b&&f.setGlobalVariable("value",b);d=h.getWithDefault(a._STAT,a.STAT_DEF);f.setGlobalVariable("updatestat",d);f.setGlobalVariable("root",this);d=f.newResult();d.add(g);f.setGlobalVariable("precision",d);a.insert.executeUsing(f)};a.prototype.extractFeatures=function(d,b){var p=this,h=c.prototype.getByIndex.call(this,a._FROM);if(null!=h){for(var h=h.split(","),
g=Array(h.length),f=0;f<h.length;f++){var k=e.mwg.task.Actions.setWorld(""+this.world());k.setTime(this.time()+"");k.parse(h[f].trim());g[f]=k}for(var m=new Float64Array(g.length),l=this.graph().newCounter(g.length),k=function(a){var b=e.mwg.task.Actions.newTask().emptyResult();b.add(d);(function(a){g[a].executeWith(p.graph(),b,function(d){null==d?m[a]=e.mwg.Constants.NULL_LONG:(m[a]=parseFloat(d.get(0).toString()),d.free());l.count()})})(a)},f=0;f<h.length;f++)k(f);l.then(function(){b(m)})}else b(null)};
a.prototype.insert=function(a,b){var c=this;this.extractFeatures(a,function(e){c.insertWith(e,a,b)})};a.prototype.size=function(){return null!=this.getByIndex(a._NUMNODES)?this.getByIndex(a._NUMNODES):1};a.getclosestDistance=function(a,b,c,e){for(var g=new Float64Array(a.length),f=0;f<a.length;f++)g[f]=a[f]>=c[f]?c[f]:a[f]<=b[f]?b[f]:a[f];return e.measure(g,a)};a.NAME="NDTree";a._STAT=0;a._TOTAL=1;a._SUM=2;a._SUMSQ=3;a._BOUNDMIN=6;a._BOUNDMAX=7;a._VALUES=8;a._KEYS=9;a._VALUES_STR="8";a._KEYS_STR=
"9";a._PRECISION=10;a._NUMNODES=11;a._DIM=12;a._DISTANCE=13;a._DISTANCETHRESHOLD=14;a._FROM=15;a.DISTANCE_THRESHOLD="threshold";a.DISTANCE_THRESHOLD_DEF=1E-10;a.DISTANCE_TYPE_DEF=0;a.STAT_DEF=!1;a.BOUNDMIN="boundmin";a.BOUNDMAX="boundmax";a.PRECISION="precision";a._RELCONST=16;a.nearestTask=a.initNearestTask();a.nearestRadiusTask=a.initRadusTask();a.insert=e.mwg.task.Actions.whileDo(function(a){for(var b=a.variable("root").get(0),c=a.resultAsNodes().get(0),h=c.graph().resolver().resolveState(c),g=
a.variable("updatestat").get(0),f=h.get(e.mwg.structure.tree.NDTree._BOUNDMAX),k=h.get(e.mwg.structure.tree.NDTree._BOUNDMIN),m=new Float64Array(f.length),l=0;l<m.length;l++)m[l]=(f[l]+k[l])/2;var n=a.variable("key").get(0),r=a.variable("precision").get(0),q=n.length;g&&e.mwg.structure.tree.NDTree.updateGaussian(h,n);g=!1;for(l=0;l<q;l++)if(f[l]-k[l]>r[l]){g=!0;break}if(g){var u=e.mwg.structure.tree.NDTree.getRelationId(m,n);if(null==h.get(u)){for(var v=new Float64Array(q),q=new Float64Array(q),l=
0;l<m.length;l++)n[l]<=m[l]?(v[l]=k[l],q[l]=Math.max(m[l]-k[l],r[l])+k[l]):(v[l]=f[l]-Math.max(f[l]-m[l],r[l]),q[l]=f[l]);n=c.graph().newTypedNode(c.world(),c.time(),e.mwg.structure.tree.NDTree.NAME);c=n.graph().resolver().resolveState(n);c.set(e.mwg.structure.tree.NDTree._BOUNDMIN,e.mwg.Type.DOUBLE_ARRAY,v);c.set(e.mwg.structure.tree.NDTree._BOUNDMAX,e.mwg.Type.DOUBLE_ARRAY,q);h.getOrCreate(u,e.mwg.Type.RELATION).add(n.id());n.free();null!=b.getByIndex(e.mwg.structure.tree.NDTree._NUMNODES)?(h=b.getByIndex(e.mwg.structure.tree.NDTree._NUMNODES),
h++,b.setPropertyByIndex(e.mwg.structure.tree.NDTree._NUMNODES,e.mwg.Type.INT,h)):b.setPropertyByIndex(e.mwg.structure.tree.NDTree._NUMNODES,e.mwg.Type.INT,2)}a.setVariable("next",u)}else a=a.variable("value").get(0),h.getOrCreate(e.mwg.structure.tree.NDTree._VALUES,e.mwg.Type.RELATION).add(a.id()),a=h.get(e.mwg.structure.tree.NDTree._KEYS),null!=a?(b=new Float64Array(a.length+q),java.lang.System.arraycopy(a,0,b,0,a.length),java.lang.System.arraycopy(n,0,b,a.length,q),h.set(e.mwg.structure.tree.NDTree._KEYS,
e.mwg.Type.DOUBLE_ARRAY,b)):h.set(e.mwg.structure.tree.NDTree._KEYS,e.mwg.Type.DOUBLE_ARRAY,n);return g},e.mwg.task.Actions.action(e.mwg.structure.action.TraverseById.NAME,"{{next}}"));return a}(e.mwg.plugin.AbstractNode);q.NDTree=n})(v.tree||(v.tree={}));(function(q){var n=function(){function c(a,d){this.min=new Float64Array(a.length);this.max=new Float64Array(d.length);java.lang.System.arraycopy(a,0,this.min,0,a.length);java.lang.System.arraycopy(d,0,this.max,0,d.length)}c.prototype.clone=function(){return new e.mwg.structure.util.HRect(this.min,
this.max)};c.prototype.closest=function(a){for(var d=new Float64Array(a.length),b=0;b<a.length;++b)d[b]=a[b]<=this.min[b]?this.min[b]:a[b]>=this.max[b]?this.max[b]:a[b];return d};c.infiniteHRect=function(a){for(var d=new Float64Array(a),b=new Float64Array(a),c=0;c<a;++c)d[c]=java.lang.Double.NEGATIVE_INFINITY,b[c]=java.lang.Double.POSITIVE_INFINITY;return new e.mwg.structure.util.HRect(d,b)};c.prototype.intersection=function(a){for(var d=new Float64Array(this.min.length),b=new Float64Array(this.min.length),
c=0;c<this.min.length;++c)if(d[c]=Math.max(this.min[c],a.min[c]),b[c]=Math.min(this.max[c],a.max[c]),d[c]>=b[c])return null;return new e.mwg.structure.util.HRect(d,b)};c.prototype.area=function(){for(var a=1,d=0;d<this.min.length;++d)a*=this.max[d]-this.min[d];return a};c.prototype.toString=function(){return this.min+"\n"+this.max+"\n"};return c}();q.HRect=n;n=function(){return function(){}}();q.NDResult=n;n=function(){function c(){this.maxPriority=java.lang.Double.MAX_VALUE;this.count=0;this.data=
new java.util.ArrayList;this.value=new java.util.ArrayList;this.value.add(this.maxPriority);this.data.add(-1)}c.prototype.getMaxPriority=function(){return 0==this.count?java.lang.Double.POSITIVE_INFINITY:this.value.get(1)};c.prototype.insert=function(a,d){this.count++;this.value.add(d);this.data.add(a);this.bubbleUp(this.count);return!0};c.prototype.distroyAndGetAllNodes=function(){for(var a=this.count,d=new Float64Array(this.count),b=0;b<a;++b)d[a-b-1]=this.remove();return d};c.prototype.sort=function(){for(var a=
2;a<this.count;a++)for(var d=a+1;d<this.count;d++)if(this.value.get(a)<this.value.get(d)){var b=this.value.get(a);this.value.set(a,this.value.get(d));this.value.set(d,b);b=this.data.get(a);this.data.set(a,this.data.get(d));this.data.set(d,b)}};c.prototype.getWorstDistance=function(){return this.value.get(1)};c.prototype.getNodes=function(){for(var a=new Float64Array(this.count),d=0;d<this.count;d++)a[d]=this.data.get(this.count-d);return a};c.prototype.getDistances=function(){for(var a=new Float64Array(this.count),
d=0;d<this.count;d++)a[d]=this.value.get(this.count-d);return a};c.prototype.getHighest=function(){return this.data.get(1)};c.prototype.getBestDistance=function(){return this.value.get(1)};c.prototype.isEmpty=function(){return 0==this.count};c.prototype.getSize=function(){return this.count};c.prototype.remove=function(){if(0==this.count)return 0;var a=this.data.get(1);this.data.set(1,this.data.get(this.count));this.value.set(1,this.value.get(this.count));this.data.set(this.count,0);this.value.set(this.count,
0);this.count--;this.bubbleDown(1);return a};c.prototype.bubbleDown=function(a){for(var d=this.data.get(a),b=this.value.get(a),c;2*a<=this.count;a=c)if(c=2*a,c!=this.count&&this.value.get(c)<this.value.get(c+1)&&c++,b<this.value.get(c))this.value.set(a,this.value.get(c)),this.data.set(a,this.data.get(c));else break;this.value.set(a,b);this.data.set(a,d)};c.prototype.bubbleUp=function(a){for(var d=this.data.get(a),b=this.value.get(a),c=Math.floor(a/2);this.value.get(c)<b;)this.value.set(a,this.value.get(c)),
this.data.set(a,this.data.get(c)),a=Math.floor(a/2),c=Math.floor(a/2);this.value.set(a,b);this.data.set(a,d)};return c}();q.NearestNeighborArrayList=n;n=function(){function c(a){this.maxPriority=java.lang.Double.MAX_VALUE;this.count=0;this.capacity=a;this.data=new Float64Array(a+1);this.value=new Float64Array(a+1);this.value[0]=this.maxPriority}c.prototype.getMaxPriority=function(){return 0==this.count?java.lang.Double.POSITIVE_INFINITY:this.value[1]};c.prototype.removeNode=function(a){for(var d=
-1,b=1;b<this.capacity+1;b++)if(this.data[b]==a){d=b;break}if(-1==d)return!1;if(1==d)this.remove();else{if(d==this.capacity+1)this.data[d]=0,this.value[d]=0;else for(b=d;b<this.capacity;b++)this.data[b]=this.data[b+1],this.value[b]=this.value[b+1];this.count--}return!0};c.prototype.insert=function(a,d){if(this.count<this.capacity)return this.add(a,d),!0;if(d>this.getMaxPriority())return!1;this.remove();this.add(a,d);return!0};c.prototype.print=function(){console.log(" ");console.log("keys: ");for(var a=
0;a<this.data.length;a++)console.log(this.data[a]);console.log(" ");console.log("dist: ");for(a=0;a<this.value.length;a++)console.log(this.value[a]);console.log(" ")};c.prototype.getNodes=function(){for(var a=Math.min(this.capacity,this.count),d=new Float64Array(a),b=0;b<a;++b)d[a-b-1]=this.remove();return d};c.prototype.isCapacityReached=function(){return this.count>=this.capacity};c.prototype.getHighest=function(){return this.data[1]};c.prototype.getWorstDistance=function(){return this.value[1]};
c.prototype.isEmpty=function(){return 0==this.count};c.prototype.getSize=function(){return this.count};c.prototype.add=function(a,d){this.count++>=this.capacity&&this.expandCapacity();this.value[this.count]=d;this.data[this.count]=a;this.bubbleUp(this.count)};c.prototype.remove=function(){if(0==this.count)return 0;var a=this.data[1];this.data[1]=this.data[this.count];this.value[1]=this.value[this.count];this.data[this.count]=0;this.value[this.count]=0;this.count--;this.bubbleDown(1);return a};c.prototype.bubbleDown=
function(a){for(var d=this.data[a],b=this.value[a],c;2*a<=this.count;a=c)if(c=2*a,c!=this.count&&this.value[c]<this.value[c+1]&&c++,b<this.value[c])this.value[a]=this.value[c],this.data[a]=this.data[c];else break;this.value[a]=b;this.data[a]=d};c.prototype.bubbleUp=function(a){for(var c=this.data[a],b=this.value[a],e=Math.floor(a/2);this.value[e]<b;)this.value[a]=this.value[e],this.data[a]=this.data[e],a=Math.floor(a/2),e=Math.floor(a/2);this.value[a]=b;this.data[a]=c};c.prototype.expandCapacity=
function(){this.capacity=2*this.count;var a=new Float64Array(this.capacity+1),c=new Float64Array(this.capacity+1);java.lang.System.arraycopy(this.data,0,a,0,this.data.length);java.lang.System.arraycopy(this.value,0,c,0,this.data.length);this.data=a;this.value=c};c.prototype.getAllNodesWithin=function(a){for(var c=Math.min(this.capacity,this.count),b=new Float64Array(c),e=0,h=0;h<c;++h)this.getMaxPriority()<=a?(b[c-e-1]=this.remove(),e++):this.remove();a=new Float64Array(e);java.lang.System.arraycopy(b,
c-e,a,0,e);return a};return c}();q.NearestNeighborList=n})(v.util||(v.util={}))})(u.structure||(u.structure={}))})(e.mwg||(e.mwg={}))})(org||(org={}));
