var __extends=this&&this.__extends||function(c,r){function t(){this.constructor=c}for(var w in r)r.hasOwnProperty(w)&&(c[w]=r[w]);c.prototype=null===r?Object.create(r):(t.prototype=r.prototype,new t)},org;
(function(c){(function(r){(function(t){var r=function(){function l(){}l.nTreeInsertTo=function(f){return c.mwg.task.Actions.newTask().action(c.mwg.structure.action.NTreeInsertTo.NAME,f)};l.nTreeNearestN=function(f){return c.mwg.task.Actions.newTask().action(c.mwg.structure.action.NTreeNearestN.NAME,f)};l.nTreeNearestWithinRadius=function(f){return c.mwg.task.Actions.newTask().action(c.mwg.structure.action.NTreeNearestWithinRadius.NAME,f)};l.nTreeNearestNWithinRadius=function(f){return c.mwg.task.Actions.newTask().action(c.mwg.structure.action.NTreeNearestNWithinRadius.NAME,
f)};return l}();t.StructureActions=r;r=function(l){function f(){l.call(this);this.declareNodeType(c.mwg.structure.tree.KDTree.NAME,function(b,a,m,d){return new c.mwg.structure.tree.KDTree(b,a,m,d)});this.declareTaskAction(c.mwg.structure.action.NTreeInsertTo.NAME,function(b){if(1!=b.length)throw Error("Bad param number!");return new c.mwg.structure.action.NTreeInsertTo(b[0])});this.declareTaskAction(c.mwg.structure.action.TraverseById.NAME,function(b){if(1!=b.length)throw Error("Bad param number!");
return new c.mwg.structure.action.TraverseById(b[0])});this.declareTaskAction(c.mwg.structure.action.NTreeNearestN.NAME,function(b){if(2>b.length)throw Error("Bad param number!");for(var a=java.lang.Integer.parseInt(b[b.length-1]),m=new Float64Array(b.length-1),d=0;d<b.length-1;d++)m[d]=parseFloat(b[d]);return new c.mwg.structure.action.NTreeNearestN(m,a)});this.declareTaskAction(c.mwg.structure.action.NTreeNearestWithinRadius.NAME,function(b){if(2>b.length)throw Error("Bad param number!");for(var a=
parseFloat(b[b.length-1]),m=new Float64Array(b.length-1),d=0;d<b.length-1;d++)m[d]=parseFloat(b[d]);return new c.mwg.structure.action.NTreeNearestWithinRadius(m,a)});this.declareTaskAction(c.mwg.structure.action.NTreeNearestNWithinRadius.NAME,function(b){if(3>b.length)throw Error("Bad param number!");for(var a=parseFloat(b[b.length-1]),m=java.lang.Integer.parseInt(b[b.length-2]),d=new Float64Array(b.length-2),g=0;g<b.length-2;g++)d[g]=parseFloat(b[g]);return new c.mwg.structure.action.NTreeNearestNWithinRadius(d,
m,a)})}__extends(f,l);return f}(c.mwg.plugin.AbstractPlugin);t.StructurePlugin=r;(function(l){var f=function(b){function a(a){b.call(this);this._variableName=a}__extends(a,b);a.prototype.eval=function(a){var d=a.result(),g=a.variable(a.template(this._variableName));if(null!=d&&null!=g){for(var b=a.graph().newCounter(d.size()),d=d.iterator(),e=d.next();null!=e;){if(e instanceof c.mwg.plugin.AbstractNode)for(var k=g.iterator(),h=k.next();null!=h;)h instanceof c.mwg.structure.tree.KDTree?h.insert(e,
function(a){b.count()}):b.count(),h=k.next();else b.count();e=d.next()}b.then(function(){a.continueTask()})}else a.continueTask()};a.prototype.toString=function(){return"nTreeInsertTo('"+this._variableName+"')"};a.NAME="nTreeInsertTo";return a}(c.mwg.plugin.AbstractTaskAction);l.NTreeInsertTo=f;f=function(b){function a(a,d){b.call(this);this._key=a;this._n=d}__extends(a,b);a.prototype.eval=function(a){var d=a.result(),g=a.newResult();if(null!=d){for(var b=a.graph().newCounter(d.size()),d=d.iterator(),
e=d.next();null!=e;)e instanceof c.mwg.structure.tree.KDTree?e.nearestN(this._key,this._n,function(a){for(var d=0;d<a.length;d++)g.add(a[d]);b.count()}):b.count(),e=d.next();b.then(function(){a.continueWith(g)})}else a.continueWith(g)};a.prototype.toString=function(){return"nTreeNearestN('')"};a.NAME="nTreeNearestN";return a}(c.mwg.plugin.AbstractTaskAction);l.NTreeNearestN=f;f=function(b){function a(a,d,g){b.call(this);this._key=a;this._n=d;this._radius=g}__extends(a,b);a.prototype.eval=function(a){var d=
a.result(),g=a.newResult();if(null!=d){for(var b=a.graph().newCounter(d.size()),d=d.iterator(),e=d.next();null!=e;)e instanceof c.mwg.structure.tree.KDTree?e.nearestNWithinRadius(this._key,this._n,this._radius,function(a){for(var d=0;d<a.length;d++)g.add(a[d]);b.count()}):b.count(),e=d.next();b.then(function(){a.continueWith(g)})}else a.continueWith(g)};a.prototype.toString=function(){return"nTreeNearestNWithinRadius('')"};a.NAME="nTreeNearestNWithinRadius";return a}(c.mwg.plugin.AbstractTaskAction);
l.NTreeNearestNWithinRadius=f;f=function(b){function a(a,d){b.call(this);this._key=a;this._radius=d}__extends(a,b);a.prototype.eval=function(a){var d=a.result(),b=a.newResult();if(null!=d){for(var u=a.graph().newCounter(d.size()),d=d.iterator(),e=d.next();null!=e;)e instanceof c.mwg.structure.tree.KDTree?e.nearestWithinRadius(this._key,this._radius,function(a){for(var d=0;d<a.length;d++)b.add(a[d]);u.count()}):u.count(),e=d.next();u.then(function(){a.continueWith(b)})}else a.continueWith(b)};a.prototype.toString=
function(){return"nTreeNearestWithinRadius('')"};a.NAME="nTreeNearestWithinRadius";return a}(c.mwg.plugin.AbstractTaskAction);l.NTreeNearestWithinRadius=f;f=function(b){function a(a){b.call(this);this._name=a}__extends(a,b);a.prototype.eval=function(a){var d=a.wrap(null),b=java.lang.Long.parseLong(a.template(this._name)),u=a.result();if(null!=u){for(var e=u.size(),k=a.graph().newCounter(e),h=0;h<e;h++){var f=u.get(h);if(f instanceof c.mwg.plugin.AbstractNode){var p=f;p.relByIndex(b,function(a){if(null!=
a)for(var b=0;b<a.length;b++)d.add(a[b]);p.free();k.count()})}else d.add(f),k.count()}k.then(function(){u.clear();a.continueWith(d)})}else a.continueTask()};a.prototype.toString=function(){return"traverseById('"+this._name+"')"};a.NAME="traverseById";return a}(c.mwg.plugin.AbstractTaskAction);l.TraverseById=f})(t.action||(t.action={}));(function(l){var f=function(){function b(){}b.instance=function(){null==b.static_instance&&(b.static_instance=new c.mwg.structure.distance.CosineDistance);return b.static_instance};
b.prototype.measure=function(a,b){for(var d=0,g=0,c=0,e=0;e<a.length;e++)d+=a[e]*b[e],g+=a[e]*a[e],c+=b[e]*b[e];d/=Math.sqrt(g)*Math.sqrt(c);0>d&&(d=0);return 1-d};b.prototype.compare=function(a,b){return a<b};b.prototype.getMinValue=function(){return 0};b.prototype.getMaxValue=function(){return java.lang.Double.MAX_VALUE};b.static_instance=null;return b}();l.CosineDistance=f;f=function(){function b(){}b.EUCLIDEAN=0;b.GEODISTANCE=1;b.COSINE=2;return b}();l.Distances=f;f=function(){function b(){}b.instance=
function(){null==b.static_instance&&(b.static_instance=new c.mwg.structure.distance.EuclideanDistance);return b.static_instance};b.prototype.measure=function(a,b){for(var d=0,g=0;g<a.length;g++)d+=(a[g]-b[g])*(a[g]-b[g]);return Math.sqrt(d)};b.prototype.compare=function(a,b){return a<b};b.prototype.getMinValue=function(){return 0};b.prototype.getMaxValue=function(){return java.lang.Double.MAX_VALUE};b.static_instance=null;return b}();l.EuclideanDistance=f;f=function(){function b(){}b.instance=function(){null==
b.static_instance&&(b.static_instance=new c.mwg.structure.distance.GeoDistance);return b.static_instance};b.prototype.measure=function(a,b){var d=c.mwg.structure.distance.GeoDistance.toRadians(b[0]-a[0]),g=c.mwg.structure.distance.GeoDistance.toRadians(b[1]-a[1]),d=Math.sin(d/2)*Math.sin(d/2)+Math.cos(c.mwg.structure.distance.GeoDistance.toRadians(a[0]))*Math.cos(c.mwg.structure.distance.GeoDistance.toRadians(b[0]))*Math.sin(g/2)*Math.sin(g/2);return 12742E3*Math.atan2(Math.sqrt(d),Math.sqrt(1-d))};
b.toRadians=function(a){return a*Math.PI/180};b.prototype.compare=function(a,b){return a<b};b.prototype.getMinValue=function(){return 0};b.prototype.getMaxValue=function(){return java.lang.Double.MAX_VALUE};b.static_instance=null;return b}();l.GeoDistance=f;f=function(){function b(){}b.instance=function(){null==b.static_instance&&(b.static_instance=new c.mwg.structure.distance.PearsonDistance);return b.static_instance};b.prototype.measure=function(a,b){for(var d=0,g=0,c=0,e=0,k=0,h=0;h<a.length;h++)d+=
a[h]*b[h],g+=a[h],e+=b[h],c+=a[h]*a[h],k+=b[h]*b[h];h=a.length;return(d-g*e/h)/Math.sqrt((c-g*g/h)*(k-e*e/h))};b.prototype.compare=function(a,b){return Math.abs(a)>Math.abs(b)};b.prototype.getMinValue=function(){return 1};b.prototype.getMaxValue=function(){return 0};b.static_instance=null;return b}();l.PearsonDistance=f})(t.distance||(t.distance={}));(function(l){var f=function(b){function a(a,d,g,c){b.call(this,a,d,g,c)}__extends(a,b);a.initFindNear=function(){var a=c.mwg.task.Actions.newTask();
a.then(function(a){var b=a.resultAsNodes().get(0);if(null!=b){var m=b.get(c.mwg.structure.tree.KDTree.KEY),e=a.variable("dim").get(0),k=a.variable("key").get(0),h=a.variable("distance").get(0),f=a.variable("lev").get(0),p=a.variable("hr").get(0),q=a.variable("max_dist_sqd").get(0),n=f%e,h=h.measure(m,k),e=p.clone();p.max[n]=m[n];e.min[n]=m[n];k[n]<m[n]?(m=b.get(c.mwg.structure.tree.KDTree.LEFT),n=c.mwg.structure.tree.KDTree.LEFT,k=p,b=b.get(c.mwg.structure.tree.KDTree.RIGHT),p=e,e=c.mwg.structure.tree.KDTree.RIGHT):
(m=b.get(c.mwg.structure.tree.KDTree.RIGHT),k=e,n=c.mwg.structure.tree.KDTree.RIGHT,b=b.get(c.mwg.structure.tree.KDTree.LEFT),e=c.mwg.structure.tree.KDTree.LEFT);a.defineVariable("further_hr",p);a.defineVariable("pivot_to_target",h);null!=m&&0!=m.size()?(a.defineVariable("near",n),a.defineVariableForSubTask("hr",k),a.defineVariableForSubTask("max_dist_sqd",q),a.defineVariableForSubTask("lev",f+1)):a.defineVariableForSubTask("near",a.newResult());null!=b&&0!=b.size()?a.defineVariableForSubTask("far",
e):a.defineVariableForSubTask("far",a.newResult())}a.continueTask()}).isolate(c.mwg.task.Actions.ifThen(function(a){return 0<a.variable("near").size()},c.mwg.task.Actions.traverse("{{near}}").isolate(a))).then(function(a){var b=a.variable("nnl").get(0),m=a.variable("key").get(0),e=a.variable("distance").get(0),k=a.variable("max_dist_sqd").get(0),h=a.variable("further_hr").get(0),f=a.variable("pivot_to_target").get(0),p=a.variable("lev").get(0),q=a.resultAsNodes().get(0),n;n=b.isCapacityReached()?
b.getMaxPriority():java.lang.Double.MAX_VALUE;var l=Math.min(k,n),v=h.closest(m);e.measure(v,m)<k?(f<n&&(n=f,b.insert(q.get(c.mwg.structure.tree.KDTree.VALUE).get(0),n),q.get(c.mwg.structure.tree.KDTree.KEY),l=b.isCapacityReached()?b.getMaxPriority():java.lang.Double.MAX_VALUE),a.defineVariableForSubTask("hr",h),a.defineVariableForSubTask("max_dist_sqd",l),a.defineVariableForSubTask("lev",p+1),a.defineVariable("continueFar",!0)):a.defineVariable("continueFar",!1);a.continueTask()}).isolate(c.mwg.task.Actions.ifThen(function(a){return a.variable("continueFar").get(0)&&
0<a.variable("far").size()},c.mwg.task.Actions.traverse("{{far}}").isolate(a)));return a};a.initFindRadius=function(){var a=c.mwg.task.Actions.newTask();a.then(function(a){var b=a.resultAsNodes().get(0);if(null!=b){var m=b.get(c.mwg.structure.tree.KDTree.KEY),e=a.variable("dim").get(0),k=a.variable("key").get(0),h=a.variable("distance").get(0),f=a.variable("lev").get(0),p=a.variable("hr").get(0),q=a.variable("max_dist_sqd").get(0),n=f%e,h=h.measure(m,k),e=p.clone();p.max[n]=m[n];e.min[n]=m[n];k[n]<
m[n]?(m=b.get(c.mwg.structure.tree.KDTree.LEFT),n=c.mwg.structure.tree.KDTree.LEFT,k=p,b=b.get(c.mwg.structure.tree.KDTree.RIGHT),p=e,e=c.mwg.structure.tree.KDTree.RIGHT):(m=b.get(c.mwg.structure.tree.KDTree.RIGHT),k=e,n=c.mwg.structure.tree.KDTree.RIGHT,b=b.get(c.mwg.structure.tree.KDTree.LEFT),e=c.mwg.structure.tree.KDTree.LEFT);a.defineVariable("further_hr",p);a.defineVariable("pivot_to_target",h);null!=m&&0!=m.size()?(a.defineVariable("near",n),a.defineVariableForSubTask("hr",k),a.defineVariableForSubTask("max_dist_sqd",
q),a.defineVariableForSubTask("lev",f+1)):a.defineVariableForSubTask("near",a.newResult());null!=b&&0!=b.size()?a.defineVariableForSubTask("far",e):a.defineVariableForSubTask("far",a.newResult())}a.continueTask()}).isolate(c.mwg.task.Actions.ifThen(function(a){return 0<a.variable("near").size()},c.mwg.task.Actions.traverse("{{near}}").isolate(a))).then(function(a){var b=a.variable("nnl").get(0),m=a.variable("key").get(0),e=a.variable("distance").get(0),k=a.variable("radius").get(0),h=a.variable("max_dist_sqd").get(0),
f=a.variable("further_hr").get(0),p=a.variable("pivot_to_target").get(0),q=a.variable("lev").get(0),n=a.resultAsNodes().get(0),l=java.lang.Double.MAX_VALUE,v=Math.min(h,l),r=f.closest(m);e.measure(r,m)<h?(p<l&&(l=p,l<=k&&b.insert(n.get(c.mwg.structure.tree.KDTree.VALUE).get(0),l),v=java.lang.Double.MAX_VALUE),a.defineVariableForSubTask("hr",f),a.defineVariableForSubTask("max_dist_sqd",v),a.defineVariableForSubTask("lev",q+1),a.defineVariable("continueFar",!0)):a.defineVariable("continueFar",!1);a.continueTask()}).isolate(c.mwg.task.Actions.ifThen(function(a){return a.variable("continueFar").get(0)&&
0<a.variable("far").size()},c.mwg.task.Actions.traverse("{{far}}").isolate(a)));return a};a.prototype.setProperty=function(m,d,c){a.enforcer.check(m,d,c);b.prototype.setProperty.call(this,m,d,c)};a.prototype.insert=function(a,b){var c=this;this.extractFeatures(a,function(f){c.insertWith(f,a,b)})};a.prototype.insertWith=function(b,d,c){var f=this.unphasedState(),e=f.getFromKeyWithDefault(a.DIMENSIONS,b.length),k=f.getFromKeyWithDefault(a.DISTANCE_THRESHOLD,a.DISTANCE_THRESHOLD_DEF);if(b.length!=e)throw Error("Key size should always be the same");
if(null==d)throw Error("To index node should not be null");var f=this.getDistance(f),h=a.insert.prepareWith(this.graph(),this,function(a){a.free();null!=c&&c(!0)}),l=h.newResult();l.add(b);h.setGlobalVariable("key",l);h.setGlobalVariable("value",d);h.setGlobalVariable("root",this);h.setGlobalVariable("distance",f);h.setGlobalVariable("dim",e);h.setGlobalVariable("err",k);h.defineVariable("lev",0);a.insert.executeUsing(h)};a.prototype.size=function(){return this.graph().resolver().resolveState(this).getFromKeyWithDefault(a.SIZE,
0)};a.prototype.setDistance=function(b){this.set(a.DISTANCE,b)};a.prototype.setFrom=function(b){this.set(a.FROM,b)};a.prototype.nearestNWithinRadius=function(b,d,g,f){var e=this,k=this.unphasedState(),h=k.getFromKeyWithDefault(a.DIMENSIONS,b.length);if(b.length!=h)throw Error("Key size should always be the same");var l=c.mwg.structure.util.HRect.infiniteHRect(b.length),p=java.lang.Double.MAX_VALUE,q=new c.mwg.structure.util.NearestNeighborList(d);d=this.getDistance(k);var k=a.nearestTask.prepareWith(this.graph(),
this,function(a){var b=q.getAllNodesWithin(g);a=c.mwg.task.Actions.setWorld(java.lang.String.valueOf(e.world())).setTime(java.lang.String.valueOf(e.time())).fromVar("res").foreach(c.mwg.task.Actions.lookup("{{result}}"));var d=a.prepareWith(e.graph(),null,function(a){for(var b=Array(a.size()),d=0;d<a.size();d++)b[d]=a.get(d);f(b)}),b=d.wrap(b);d.addToGlobalVariable("res",b);a.executeUsing(d)}),n=k.newResult();n.add(b);k.setGlobalVariable("key",n);k.setGlobalVariable("distance",d);k.setGlobalVariable("dim",
h);k.setGlobalVariable("nnl",q);k.defineVariable("lev",0);k.defineVariable("hr",l);k.defineVariable("max_dist_sqd",p);a.nearestTask.executeUsing(k)};a.prototype.nearestWithinRadius=function(b,d,g){var f=this,e=this.unphasedState(),k=e.getFromKeyWithDefault(a.DIMENSIONS,b.length);if(b.length!=k)throw Error("Key size should always be the same");var h=c.mwg.structure.util.HRect.infiniteHRect(b.length),l=java.lang.Double.MAX_VALUE,p=new c.mwg.structure.util.NearestNeighborArrayList,e=this.getDistance(e),
q=a.nearestRadiusTask.prepareWith(this.graph(),this,function(a){var b=p.getAllNodes();a=c.mwg.task.Actions.setWorld(java.lang.String.valueOf(f.world())).setTime(java.lang.String.valueOf(f.time())).fromVar("res").foreach(c.mwg.task.Actions.lookup("{{result}}"));var d=a.prepareWith(f.graph(),null,function(a){for(var b=Array(a.size()),d=0;d<a.size();d++)b[d]=a.get(d);g(b)}),b=d.wrap(b);d.addToGlobalVariable("res",b);a.executeUsing(d)}),n=q.newResult();n.add(b);q.setGlobalVariable("key",n);q.setGlobalVariable("distance",
e);q.setGlobalVariable("dim",k);q.setGlobalVariable("nnl",p);q.setGlobalVariable("radius",d);q.defineVariable("lev",0);q.defineVariable("hr",h);q.defineVariable("max_dist_sqd",l);a.nearestRadiusTask.executeUsing(q)};a.prototype.nearestN=function(b,d,g){var f=this,e=this.unphasedState(),k=e.getFromKeyWithDefault(a.DIMENSIONS,b.length);if(b.length!=k)throw Error("Key size should always be the same");var h=c.mwg.structure.util.HRect.infiniteHRect(b.length),l=java.lang.Double.MAX_VALUE,p=new c.mwg.structure.util.NearestNeighborList(d);
d=this.getDistance(e);var e=a.nearestTask.prepareWith(this.graph(),this,function(a){var b=p.getAllNodes();a=c.mwg.task.Actions.setWorld(java.lang.String.valueOf(f.world())).setTime(java.lang.String.valueOf(f.time())).fromVar("res").foreach(c.mwg.task.Actions.lookup("{{result}}"));var d=a.prepareWith(f.graph(),null,function(a){for(var b=Array(a.size()),d=0;d<a.size();d++)b[d]=a.get(d);g(b)}),b=d.wrap(b);d.addToGlobalVariable("res",b);a.executeUsing(d)}),q=e.newResult();q.add(b);e.setGlobalVariable("key",
q);e.setGlobalVariable("distance",d);e.setGlobalVariable("dim",k);e.setGlobalVariable("nnl",p);e.defineVariable("lev",0);e.defineVariable("hr",h);e.defineVariable("max_dist_sqd",l);a.nearestTask.executeUsing(e)};a.prototype.getDistance=function(b){b=b.getFromKeyWithDefault(a.DISTANCE,a.DISTANCE_TYPE_DEF);if(b==c.mwg.structure.distance.Distances.EUCLIDEAN)b=c.mwg.structure.distance.EuclideanDistance.instance();else if(b==c.mwg.structure.distance.Distances.GEODISTANCE)b=c.mwg.structure.distance.GeoDistance.instance();
else throw Error("Unknown distance code metric");return b};a.prototype.extractFeatures=function(m,d){var g=this,f=b.prototype.get.call(this,a.FROM);if(null!=f){for(var f=f.split(","),e=Array(f.length),k=0;k<f.length;k++){var h=c.mwg.task.Actions.setWorld(""+this.world());h.setTime(this.time()+"");h.parse(f[k].trim());e[k]=h}for(var l=new Float64Array(e.length),p=this.graph().newCounter(e.length),k=0;k<f.length;k++){var q=c.mwg.task.Actions.newTask().emptyResult();q.add(m);(function(a){e[a].executeWith(g.graph(),
q,function(b){null==b?l[a]=c.mwg.Constants.NULL_LONG:(l[a]=parseFloat(b.get(0).toString()),b.free());p.count()})})(k)}p.then(function(){d(l)})}else d(null)};a.NAME="KDTree";a.FROM="from";a.LEFT="left";a.RIGHT="right";a.KEY="key";a.VALUE="value";a.SIZE="size";a.DIMENSIONS="dimensions";a.DISTANCE="distance";a.DISTANCE_THRESHOLD="threshold";a.DISTANCE_THRESHOLD_DEF=1E-10;a.DISTANCE_TYPE_DEF=0;a.insert=c.mwg.task.Actions.whileDo(function(a){var b=a.resultAsNodes().get(0),g=b.get(c.mwg.structure.tree.KDTree.KEY),
f=a.variable("dim").get(0),e=a.variable("key").get(0),k=a.variable("value").get(0),h=a.variable("root").get(0),l=a.variable("distance").get(0),p=a.variable("err").get(0),q=a.variable("lev").get(0);if(null==g)return b.setProperty(c.mwg.structure.tree.KDTree.DIMENSIONS,c.mwg.Type.INT,f),b.setProperty(c.mwg.structure.tree.KDTree.KEY,c.mwg.Type.DOUBLE_ARRAY,e),b.getOrCreateRel(c.mwg.structure.tree.KDTree.VALUE).clear().add(k.id()),b.setProperty(c.mwg.structure.tree.KDTree.SIZE,c.mwg.Type.INT,1),!1;if(l.measure(e,
g)<p)return b.getOrCreateRel(c.mwg.structure.tree.KDTree.VALUE).clear().add(k.id()),!1;e[q]>g[q]?(l=b.get(c.mwg.structure.tree.KDTree.RIGHT),g=c.mwg.structure.tree.KDTree.RIGHT):(l=b.get(c.mwg.structure.tree.KDTree.LEFT),g=c.mwg.structure.tree.KDTree.LEFT);if(null==l||0==l.size())return a=a.graph().newTypedNode(b.world(),b.time(),c.mwg.structure.tree.KDTree.NAME),a.setProperty(c.mwg.structure.tree.KDTree.KEY,c.mwg.Type.DOUBLE_ARRAY,e),a.getOrCreateRel(c.mwg.structure.tree.KDTree.VALUE).clear().add(k.id()),
b.getOrCreateRel(g).clear().add(a.id()),h.setProperty(c.mwg.structure.tree.KDTree.SIZE,c.mwg.Type.INT,h.get(c.mwg.structure.tree.KDTree.SIZE)+1),a.free(),!1;a.setGlobalVariable("next",g);a.setGlobalVariable("lev",(q+1)%f);return!0},c.mwg.task.Actions.traverse("{{next}}"));a.nearestTask=a.initFindNear();a.nearestRadiusTask=a.initFindRadius();a.enforcer=(new c.mwg.utility.Enforcer).asPositiveDouble(a.DISTANCE_THRESHOLD);return a}(c.mwg.plugin.AbstractNode);l.KDTree=f})(t.tree||(t.tree={}));(function(l){var f=
function(){function b(a,b){this.min=new Float64Array(a.length);this.max=new Float64Array(b.length);java.lang.System.arraycopy(a,0,this.min,0,a.length);java.lang.System.arraycopy(b,0,this.max,0,b.length)}b.prototype.clone=function(){return new c.mwg.structure.util.HRect(this.min,this.max)};b.prototype.closest=function(a){for(var b=new Float64Array(a.length),d=0;d<a.length;++d)b[d]=a[d]<=this.min[d]?this.min[d]:a[d]>=this.max[d]?this.max[d]:a[d];return b};b.infiniteHRect=function(a){for(var b=new Float64Array(a),
d=new Float64Array(a),g=0;g<a;++g)b[g]=java.lang.Double.NEGATIVE_INFINITY,d[g]=java.lang.Double.POSITIVE_INFINITY;return new c.mwg.structure.util.HRect(b,d)};b.prototype.intersection=function(a){for(var b=new Float64Array(this.min.length),d=new Float64Array(this.min.length),g=0;g<this.min.length;++g)if(b[g]=Math.max(this.min[g],a.min[g]),d[g]=Math.min(this.max[g],a.max[g]),b[g]>=d[g])return null;return new c.mwg.structure.util.HRect(b,d)};b.prototype.area=function(){for(var a=1,b=0;b<this.min.length;++b)a*=
this.max[b]-this.min[b];return a};b.prototype.toString=function(){return this.min+"\n"+this.max+"\n"};return b}();l.HRect=f;f=function(){function b(){this.maxPriority=java.lang.Double.MAX_VALUE;this.count=0;this.data=new java.util.ArrayList;this.value=new java.util.ArrayList;this.value.add(this.maxPriority);this.data.add(-1)}b.prototype.getMaxPriority=function(){return 0==this.count?java.lang.Double.POSITIVE_INFINITY:this.value.get(1)};b.prototype.insert=function(a,b){this.count++;this.value.add(b);
this.data.add(a);this.bubbleUp(this.count);return!0};b.prototype.getAllNodes=function(){for(var a=this.count,b=new Float64Array(this.count),d=0;d<a;++d)b[a-d-1]=this.remove();return b};b.prototype.getHighest=function(){return this.data.get(1)};b.prototype.getBestDistance=function(){return this.value.get(1)};b.prototype.isEmpty=function(){return 0==this.count};b.prototype.getSize=function(){return this.count};b.prototype.remove=function(){if(0==this.count)return 0;var a=this.data.get(1);this.data.set(1,
this.data.get(this.count));this.value.set(1,this.value.get(this.count));this.data.set(this.count,0);this.value.set(this.count,0);this.count--;this.bubbleDown(1);return a};b.prototype.bubbleDown=function(a){for(var b=this.data.get(a),d=this.value.get(a),c;2*a<=this.count;a=c)if(c=2*a,c!=this.count&&this.value.get(c)<this.value.get(c+1)&&c++,d<this.value.get(c))this.value.set(a,this.value.get(c)),this.data.set(a,this.data.get(c));else break;this.value.set(a,d);this.data.set(a,b)};b.prototype.bubbleUp=
function(a){for(var b=this.data.get(a),d=this.value.get(a),c=Math.floor(a/2);this.value.get(c)<d;)this.value.set(a,this.value.get(c)),this.data.set(a,this.data.get(c)),a=Math.floor(a/2),c=Math.floor(a/2);this.value.set(a,d);this.data.set(a,b)};return b}();l.NearestNeighborArrayList=f;f=function(){function b(a){this.maxPriority=java.lang.Double.MAX_VALUE;this.count=0;this.capacity=a;this.data=new Float64Array(a+1);this.value=new Float64Array(a+1);this.value[0]=this.maxPriority}b.prototype.getMaxPriority=
function(){return 0==this.count?java.lang.Double.POSITIVE_INFINITY:this.value[1]};b.prototype.insert=function(a,b){if(this.count<this.capacity)return this.add(a,b),!0;if(b>this.getMaxPriority())return!1;this.remove();this.add(a,b);return!0};b.prototype.print=function(){console.log(" ");console.log("keys: ");for(var a=0;a<this.data.length;a++)console.log(this.data[a]);console.log(" ");console.log("dist: ");for(a=0;a<this.value.length;a++)console.log(this.value[a]);console.log(" ")};b.prototype.getAllNodes=
function(){for(var a=Math.min(this.capacity,this.count),b=new Float64Array(a),d=0;d<a;++d)b[a-d-1]=this.remove();return b};b.prototype.isCapacityReached=function(){return this.count>=this.capacity};b.prototype.getHighest=function(){return this.data[1]};b.prototype.getBestDistance=function(){return this.value[1]};b.prototype.isEmpty=function(){return 0==this.count};b.prototype.getSize=function(){return this.count};b.prototype.add=function(a,b){this.count++>=this.capacity&&this.expandCapacity();this.value[this.count]=
b;this.data[this.count]=a;this.bubbleUp(this.count)};b.prototype.remove=function(){if(0==this.count)return 0;var a=this.data[1];this.data[1]=this.data[this.count];this.value[1]=this.value[this.count];this.data[this.count]=0;this.value[this.count]=0;this.count--;this.bubbleDown(1);return a};b.prototype.bubbleDown=function(a){for(var b=this.data[a],d=this.value[a],c;2*a<=this.count;a=c)if(c=2*a,c!=this.count&&this.value[c]<this.value[c+1]&&c++,d<this.value[c])this.value[a]=this.value[c],this.data[a]=
this.data[c];else break;this.value[a]=d;this.data[a]=b};b.prototype.bubbleUp=function(a){for(var b=this.data[a],d=this.value[a],c=Math.floor(a/2);this.value[c]<d;)this.value[a]=this.value[c],this.data[a]=this.data[c],a=Math.floor(a/2),c=Math.floor(a/2);this.value[a]=d;this.data[a]=b};b.prototype.expandCapacity=function(){this.capacity=2*this.count;var a=new Float64Array(this.capacity+1),b=new Float64Array(this.capacity+1);java.lang.System.arraycopy(this.data,0,a,0,this.data.length);java.lang.System.arraycopy(this.value,
0,b,0,this.data.length);this.data=a;this.value=b};b.prototype.getAllNodesWithin=function(a){for(var b=Math.min(this.capacity,this.count),d=new Float64Array(b),c=0,f=0;f<b;++f)this.getMaxPriority()<=a?(d[b-c-1]=this.remove(),c++):this.remove();a=new Float64Array(c);java.lang.System.arraycopy(d,b-c,a,0,c);return a};return b}();l.NearestNeighborList=f})(t.util||(t.util={}))})(r.structure||(r.structure={}))})(c.mwg||(c.mwg={}))})(org||(org={}));
