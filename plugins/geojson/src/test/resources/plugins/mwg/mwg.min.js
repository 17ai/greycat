var __extends=this&&this.__extends||function(b,f){function n(){this.constructor=b}for(var r in f)f.hasOwnProperty(r)&&(b[r]=f[r]);b.prototype=null===f?Object.create(f):(n.prototype=f.prototype,new n)},java;
(function(b){var f;(function(b){var f=function(){function b(){}b.gc=function(){};b.arraycopy=function(b,d,a,c,k){if((a instanceof Float64Array||a instanceof Int32Array)&&(b instanceof Float64Array||b instanceof Int32Array))k==b.length?a.set(b,c):a.set(b.subarray(d,d+k),c);else for(var m=0;m<k;m++)a[c+m]=b[d+m]};return b}();b.System=f;f=function(){function b(){this._buffer="";this.length=0}b.prototype.append=function(b){this._buffer+=b;this.length=this._buffer.length;return this};b.prototype.insert=
function(b,d){this._buffer=this._buffer.slice(0,b)+d+this._buffer.slice(b);return this};b.prototype.toString=function(){return this._buffer};return b}();b.StringBuilder=f;f=function(){function b(){}b.valueOf=function(b,d,a){return"undefined"===typeof d&&"undefined"===typeof a?b+"":b.slice(d,d+a)};b.hashCode=function(b){var d=b._hashCode?b._hashCode:0;if(0===d&&0<b.length){for(var a=0;a<b.length;a++)d=31*d+b.charCodeAt(a);b._hashCode=d}return d};b.isEmpty=function(b){return 0===b.length};b.join=function(b){for(var d=
[],a=1;a<arguments.length;a++)d[a-1]=arguments[a];return d.join(b)};return b}();b.String=f;f=function(){function b(){}b.sleep=function(b){};return b}();b.Thread=f;f=function(){function b(){}b.MAX_VALUE=Number.MAX_VALUE;b.POSITIVE_INFINITY=Number.POSITIVE_INFINITY;b.NEGATIVE_INFINITY=Number.NEGATIVE_INFINITY;b.NaN=NaN;return b}();b.Double=f;f=function(){function b(){}b.parseLong=function(b){return parseInt(b)};return b}();b.Long=f;f=function(){function b(){}b.parseInt=function(b){return parseInt(b)};
return b}();b.Integer=f})(f=b.lang||(b.lang={}));(function(n){(function(a){(function(c){var a=function(){function c(a){this._internal=new Int32Array(a)}c.prototype.set=function(c,a){this._internal[c]=a};c.prototype.get=function(c){return this._internal[c]};c.prototype.getAndSet=function(c,a){var k=this._internal[c];this._internal[c]=a;return k};c.prototype.compareAndSet=function(c,a,k){return this._internal[c]==a?(this._internal[c]=k,!0):!1};return c}();c.AtomicIntegerArray=a;a=function(){function c(a){this._internal=
new Float64Array(a)}c.prototype.set=function(c,a){this._internal[c]=a};c.prototype.get=function(c){return this._internal[c]};c.prototype.getAndSet=function(c,a){var k=this._internal[c];this._internal[c]=a;return k};c.prototype.compareAndSet=function(c,a,k){return this._internal[c]==a?(this._internal[c]=k,!0):!1};c.prototype.length=function(){return this._internal.length};return c}();c.AtomicLongArray=a;a=function(){function c(a){this._internal=[]}c.prototype.set=function(c,a){this._internal[c]=a};
c.prototype.get=function(c){return this._internal[c]};c.prototype.getAndSet=function(c,a){var k=this._internal[c];this._internal[c]=a;return k};c.prototype.compareAndSet=function(c,a,k){return this._internal[c]==a?(this._internal[c]=k,!0):!1};c.prototype.length=function(){return this._internal.length};return c}();c.AtomicReferenceArray=a;a=function(){function c(){this._internal=null}c.prototype.compareAndSet=function(c,a){return this._internal==c?(this._internal=a,!0):!1};c.prototype.get=function(){return this._internal};
c.prototype.set=function(c){this._internal=c};c.prototype.getAndSet=function(c){var a=this._internal;this._internal=c;return a};return c}();c.AtomicReference=a;a=function(){function c(a){this._internal=0;this._internal=a}c.prototype.compareAndSet=function(c,a){return this._internal==c?(this._internal=a,!0):!1};c.prototype.get=function(){return this._internal};c.prototype.incrementAndGet=function(){this._internal++;return this._internal};c.prototype.decrementAndGet=function(){this._internal--;return this._internal};
return c}();c.AtomicLong=a;a=function(){function c(a){this._internal=!1;this._internal=a}c.prototype.compareAndSet=function(c,a){return this._internal==c?(this._internal=a,!0):!1};c.prototype.get=function(){return this._internal};c.prototype.set=function(c){this._internal=c};return c}();c.AtomicBoolean=a;a=function(){function c(a){this._internal=0;this._internal=a}c.prototype.compareAndSet=function(c,a){return this._internal==c?(this._internal=a,!0):!1};c.prototype.get=function(){return this._internal};
c.prototype.set=function(c){this._internal=c};c.prototype.getAndSet=function(c){var a=this._internal;this._internal=c;return a};c.prototype.incrementAndGet=function(){this._internal++;return this._internal};c.prototype.decrementAndGet=function(){this._internal--;return this._internal};c.prototype.getAndIncrement=function(){var c=this._internal;this._internal++;return c};c.prototype.getAndDecrement=function(){var c=this._internal;this._internal--;return c};return c}();c.AtomicInteger=a})(a.atomic||
(a.atomic={}));(function(c){var a=function(){function c(){}c.prototype.lock=function(){};c.prototype.unlock=function(){};return c}();c.ReentrantLock=a})(a.locks||(a.locks={}))})(n.concurrent||(n.concurrent={}));var r=function(){function a(){this.seed=void 0}a.prototype.nextInt=function(c){"undefined"===typeof c&&(c=Math.pow(2,32));return void 0==this.seed?Math.floor(Math.random()*c):Math.floor(this.nextSeeded(0,c))};a.prototype.nextDouble=function(){return void 0==this.seed?Math.random():this.nextSeeded(Number.MIN_VALUE,
Number.MAX_VALUE)};a.prototype.nextBoolean=function(){return void 0==this.seed?.5<=Math.random():.5<=this.nextSeeded()};a.prototype.setSeed=function(c){this.seed=c};a.prototype.nextSeeded=function(c,a){c=c||0;this.seed=(9301*this.seed+49297)%233280;return c+this.seed/233280*((a||1)-c)};return a}();n.Random=r;r=function(){function a(){}a.fill=function(c,a,b,d){for(b=a+b;a<b;a++)c[a]=d};a.copyOf=function(c,a,b){b=Array(a);f.System.arraycopy(c,0,b,0,Math.min(c.length,a));return b};return a}();n.Arrays=
r;r=function(){function a(){}a.swap=function(c,a,b){c.set(a,c.set(b,c.get(a)))};return a}();n.Collections=r;var q=function(){function a(c){this.cursor=0;this.lastRet=-1;this.list=c}a.prototype.hasNext=function(){return this.cursor!=this.list.size()};a.prototype.next=function(){try{var c=this.cursor,a=this.list.get(c);this.lastRet=c;this.cursor=c+1;return a}catch(b){if(b instanceof Error)throw Error("no such element exception");throw b;}};return a}();n.Itr=q;var e=function(){function a(){this.content=
{}}a.prototype.add=function(c){this.content[c]=c};a.prototype.clear=function(){this.content={}};a.prototype.contains=function(c){return this.content.hasOwnProperty(c)};a.prototype.containsAll=function(c){return!1};a.prototype.addAll=function(c){c=c.toArray(null);for(var a=0;a<c.length;a++)this.content[c[a]]=c[a];return!0};a.prototype.remove=function(c){var a=!1;this.content[c]&&(a=!0);delete this.content[c];return a};a.prototype.removeAll=function(){return!1};a.prototype.size=function(){return Object.keys(this.content).length};
a.prototype.isEmpty=function(){return 0==this.size()};a.prototype.toArray=function(c){var a=this;return Object.keys(this.content).map(function(c){return a.content[c]})};a.prototype.iterator=function(){return new b.util.Itr(this)};a.prototype.forEach=function(c){for(var a in this.content)c(this.content[a])};a.prototype.get=function(c){return this.content[c]};return a}();n.HashSet=e;r=function(){function a(){this.content=[]}a.prototype.addAll=function(c,a){for(var b=a.toArray(null),d=0;d<b.length;d++)this.content.push(b[d]);
return!1};a.prototype.clear=function(){this.content=[]};a.prototype.poll=function(){return this.content.shift()};a.prototype.remove=function(c){this.content.splice(c,1);return!0};a.prototype.removeAll=function(){this.content=[];return!0};a.prototype.toArray=function(c){return this.content};a.prototype.size=function(){return this.content.length};a.prototype.add=function(c,a){"undefined"!==typeof a?this.content.splice(c,0,a):this.content.push(c)};a.prototype.get=function(c){return this.content[c]};
a.prototype.contains=function(c){return-1!=this.content.indexOf(c)};a.prototype.containsAll=function(c){return!1};a.prototype.isEmpty=function(){return 0==this.content.length};a.prototype.set=function(c,a){return this.content[c]=a};a.prototype.indexOf=function(c){return this.content.indexOf(c)};a.prototype.lastIndexOf=function(c){return this.content.lastIndexOf(c)};a.prototype.iterator=function(){return new q(this)};return a}();n.AbstractList=r;var d=function(a){function c(){a.apply(this,arguments)}
__extends(c,a);return c}(r);n.LinkedList=d;r=function(a){function c(){a.apply(this,arguments)}__extends(c,a);return c}(r);n.ArrayList=r;r=function(){function a(){this.content=[]}a.prototype.pop=function(){return this.content.pop()};a.prototype.push=function(c){this.content.push(c)};a.prototype.isEmpty=function(){return 0==this.content.length};a.prototype.peek=function(){return this.content.slice(-1)[0]};return a}();n.Stack=r;r=function(){function a(){this.content={}}a.prototype.get=function(c){return this.content[c]};
a.prototype.put=function(c,a){var b=this.content[c];this.content[c]=a;return b};a.prototype.containsKey=function(c){return this.content.hasOwnProperty(c)};a.prototype.remove=function(c){var a=this.content[c];delete this.content[c];return a};a.prototype.keySet=function(){var c=new e,a;for(a in this.content)this.content.hasOwnProperty(a)&&c.add(a);return c};a.prototype.isEmpty=function(){return 0==Object.keys(this.content).length};a.prototype.values=function(){var c=new e,a;for(a in this.content)this.content.hasOwnProperty(a)&&
c.add(this.content[a]);return c};a.prototype.clear=function(){this.content={}};a.prototype.size=function(){return Object.keys(this.content).length};return a}();n.HashMap=r;r=function(a){function c(){a.apply(this,arguments)}__extends(c,a);return c}(r);n.ConcurrentHashMap=r})(b.util||(b.util={}))})(java||(java={}));function arrayInstanceOf(b,f){return b instanceof Array?0==b.length?!0:b[0]instanceof f:!1}
var Long=function(){function b(b,n,r){this.low=this.high=0;this.unsigned=!1;this.eq=this.equals;this.neq=this.notEquals;this.lt=this.lessThan;this.lte=this.lessThanOrEqual;this.gt=this.greaterThan;this.gte=this.greaterThanOrEqual;this.comp=this.compare;this.neg=this.negate;this.sub=this.subtract;this.mul=this.multiply;this.div=this.divide;this.mod=this.modulo;this.shl=this.shiftLeft;this.shr=this.shiftRight;this.shru=this.shiftRightUnsigned;void 0!=n&&(this.high=n);void 0!=b&&(this.low=b);void 0!=
r&&(this.unsigned=r)}b.isLong=function(b){return!0===(b&&b.__isLong__)};b.fromInt=function(f,n){var r,q;if(n){f>>>=0;if(q=0<=f&&256>f)if(r=b.UINT_CACHE[f])return r;r=b.fromBits(f,0>(f|0)?-1:0,!0);q&&(b.UINT_CACHE[f]=r)}else{f|=0;if(q=-128<=f&&128>f)if(r=b.INT_CACHE[f])return r;r=b.fromBits(f,0>f?-1:0,!1);q&&(b.INT_CACHE[f]=r)}return r};b.fromNumber=function(f,n){if(isNaN(f)||!isFinite(f))return n?b.UZERO:b.ZERO;if(n){if(0>f)return b.UZERO;if(f>=b.TWO_PWR_64_DBL)return b.MAX_UNSIGNED_VALUE}else{if(f<=
-b.TWO_PWR_63_DBL)return b.MIN_VALUE;if(f+1>=b.TWO_PWR_63_DBL)return b.MAX_VALUE}return 0>f?b.fromNumber(-f,n).neg():b.fromBits(f%b.TWO_PWR_32_DBL|0,f/b.TWO_PWR_32_DBL|0,n)};b.fromBits=function(f,n,r){return new b(f,n,r)};b.fromString=function(f,n,r){void 0===n&&(n=10);void 0===r&&(r=!1);if(0===f.length)throw Error("empty string");if("NaN"===f||"Infinity"===f||"+Infinity"===f||"-Infinity"===f)return b.ZERO;n=n||10;if(2>n||36<n)throw RangeError("radix");var q;if(0<(q=f.indexOf("-")))throw Error("interior hyphen");
if(0===q)return b.fromString(f.substring(1),n,r).neg();q=b.fromNumber(b.pow_dbl(n,8));for(var e=b.ZERO,d=0;d<f.length;d+=8){var a=Math.min(8,f.length-d),c=parseInt(f.substring(d,d+a),n);8>a?(a=b.fromNumber(b.pow_dbl(n,a)),e=e.mul(a).add(b.fromNumber(c))):(e=e.mul(q),e=e.add(b.fromNumber(c)))}e.unsigned=r;return e};b.fromValue=function(f){return f instanceof b?f:"number"===typeof f?b.fromNumber(f):"string"===typeof f?b.fromString(f):b.fromBits(f.low,f.high,f.unsigned)};b.prototype.toInt=function(){return this.unsigned?
this.low>>>0:this.low};b.prototype.toNumber=function(){return this.unsigned?(this.high>>>0)*b.TWO_PWR_32_DBL+(this.low>>>0):this.high*b.TWO_PWR_32_DBL+(this.low>>>0)};b.prototype.toString=function(f){f=f||10;if(2>f||36<f)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(b.MIN_VALUE)){var n=b.fromNumber(f),r=this.div(n),n=r.mul(n).sub(this);return r.toString(f)+n.toInt().toString(f)}return"-"+this.neg().toString(f)}for(var r=b.fromNumber(b.pow_dbl(f,6),this.unsigned),
n=this,q="";;){var e=n.div(r),d=(n.sub(e.mul(r)).toInt()>>>0).toString(f),n=e;if(n.isZero())return d+q;for(;6>d.length;)d="0"+d;q=""+d+q}};b.prototype.getHighBits=function(){return this.high};b.prototype.getHighBitsUnsigned=function(){return this.high>>>0};b.prototype.getLowBits=function(){return this.low};b.prototype.getLowBitsUnsigned=function(){return this.low>>>0};b.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.eq(b.MIN_VALUE)?64:this.neg().getNumBitsAbs();for(var f=0!=this.high?
this.high:this.low,n=31;0<n&&0==(f&1<<n);n--);return 0!=this.high?n+33:n+1};b.prototype.isZero=function(){return 0===this.high&&0===this.low};b.prototype.isNegative=function(){return!this.unsigned&&0>this.high};b.prototype.isPositive=function(){return this.unsigned||0<=this.high};b.prototype.isOdd=function(){return 1===(this.low&1)};b.prototype.isEven=function(){return 0===(this.low&1)};b.prototype.equals=function(f){b.isLong(f)||(f=b.fromValue(f));return this.unsigned!==f.unsigned&&1===this.high>>>
31&&1===f.high>>>31?!1:this.high===f.high&&this.low===f.low};b.prototype.notEquals=function(b){return!this.eq(b)};b.prototype.lessThan=function(b){return 0>this.comp(b)};b.prototype.lessThanOrEqual=function(b){return 0>=this.comp(b)};b.prototype.greaterThan=function(b){return 0<this.comp(b)};b.prototype.greaterThanOrEqual=function(b){return 0<=this.comp(b)};b.prototype.compare=function(f){b.isLong(f)||(f=b.fromValue(f));if(this.eq(f))return 0;var n=this.isNegative(),r=f.isNegative();return n&&!r?
-1:!n&&r?1:this.unsigned?f.high>>>0>this.high>>>0||f.high===this.high&&f.low>>>0>this.low>>>0?-1:1:this.sub(f).isNegative()?-1:1};b.prototype.negate=function(){return!this.unsigned&&this.eq(b.MIN_VALUE)?b.MIN_VALUE:this.not().add(b.ONE)};b.prototype.add=function(f){b.isLong(f)||(f=b.fromValue(f));var n=this.high>>>16,r=this.high&65535,q=this.low>>>16,e=f.high>>>16,d=f.high&65535,a=f.low>>>16;f=0+((this.low&65535)+(f.low&65535));a=0+(f>>>16)+(q+a);q=0+(a>>>16);q+=r+d;n=0+(q>>>16)+(n+e)&65535;return b.fromBits((a&
65535)<<16|f&65535,n<<16|q&65535,this.unsigned)};b.prototype.subtract=function(f){b.isLong(f)||(f=b.fromValue(f));return this.add(f.neg())};b.prototype.multiply=function(f){if(this.isZero())return b.ZERO;b.isLong(f)||(f=b.fromValue(f));if(f.isZero())return b.ZERO;if(this.eq(b.MIN_VALUE))return f.isOdd()?b.MIN_VALUE:b.ZERO;if(f.eq(b.MIN_VALUE))return this.isOdd()?b.MIN_VALUE:b.ZERO;if(this.isNegative())return f.isNegative()?this.neg().mul(f.neg()):this.neg().mul(f).neg();if(f.isNegative())return this.mul(f.neg()).neg();
if(this.lt(b.TWO_PWR_24)&&f.lt(b.TWO_PWR_24))return b.fromNumber(this.toNumber()*f.toNumber(),this.unsigned);var n=this.high>>>16,r=this.high&65535,q=this.low>>>16,e=this.low&65535,d=f.high>>>16,a=f.high&65535,c=f.low>>>16;f=f.low&65535;var k,m,t,g;g=0+e*f;t=0+(g>>>16)+q*f;m=0+(t>>>16);t=(t&65535)+e*c;m+=t>>>16;m+=r*f;k=0+(m>>>16);m=(m&65535)+q*c;k+=m>>>16;m=(m&65535)+e*a;k=k+(m>>>16)+(n*f+r*c+q*a+e*d)&65535;return b.fromBits((t&65535)<<16|g&65535,k<<16|m&65535,this.unsigned)};b.prototype.divide=
function(f){b.isLong(f)||(f=b.fromValue(f));if(f.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?b.UZERO:b.ZERO;var n,r,q;if(this.unsigned){f.unsigned||(f=f.toUnsigned());if(f.gt(this))return b.UZERO;if(f.gt(this.shru(1)))return b.UONE;q=b.UZERO}else{if(this.eq(b.MIN_VALUE)){if(f.eq(b.ONE)||f.eq(b.NEG_ONE))return b.MIN_VALUE;if(f.eq(b.MIN_VALUE))return b.ONE;n=this.shr(1).div(f).shl(1);if(n.eq(b.ZERO))return f.isNegative()?b.ONE:b.NEG_ONE;r=this.sub(f.mul(n));return q=
n.add(r.div(f))}if(f.eq(b.MIN_VALUE))return this.unsigned?b.UZERO:b.ZERO;if(this.isNegative())return f.isNegative()?this.neg().div(f.neg()):this.neg().div(f).neg();if(f.isNegative())return this.div(f.neg()).neg();q=b.ZERO}for(r=this;r.gte(f);){n=Math.max(1,Math.floor(r.toNumber()/f.toNumber()));for(var e=Math.ceil(Math.log(n)/Math.LN2),e=48>=e?1:b.pow_dbl(2,e-48),d=b.fromNumber(n),a=d.mul(f);a.isNegative()||a.gt(r);)n-=e,d=b.fromNumber(n,this.unsigned),a=d.mul(f);d.isZero()&&(d=b.ONE);q=q.add(d);
r=r.sub(a)}return q};b.prototype.modulo=function(f){b.isLong(f)||(f=b.fromValue(f));return this.sub(this.div(f).mul(f))};b.prototype.not=function(){return b.fromBits(~this.low,~this.high,this.unsigned)};b.prototype.and=function(f){b.isLong(f)||(f=b.fromValue(f));return b.fromBits(this.low&f.low,this.high&f.high,this.unsigned)};b.prototype.or=function(f){b.isLong(f)||(f=b.fromValue(f));return b.fromBits(this.low|f.low,this.high|f.high,this.unsigned)};b.prototype.xor=function(f){b.isLong(f)||(f=b.fromValue(f));
return b.fromBits(this.low^f.low,this.high^f.high,this.unsigned)};b.prototype.shiftLeft=function(f){b.isLong(f)&&(f=f.toInt());return 0===(f&=63)?this:32>f?b.fromBits(this.low<<f,this.high<<f|this.low>>>32-f,this.unsigned):b.fromBits(0,this.low<<f-32,this.unsigned)};b.prototype.shiftRight=function(f){b.isLong(f)&&(f=f.toInt());return 0===(f&=63)?this:32>f?b.fromBits(this.low>>>f|this.high<<32-f,this.high>>f,this.unsigned):b.fromBits(this.high>>f-32,0<=this.high?0:-1,this.unsigned)};b.prototype.shiftRightUnsigned=
function(f){b.isLong(f)&&(f=f.toInt());f&=63;if(0===f)return this;var n=this.high;return 32>f?b.fromBits(this.low>>>f|n<<32-f,n>>>f,this.unsigned):32===f?b.fromBits(n,0,this.unsigned):b.fromBits(n>>>f-32,0,this.unsigned)};b.prototype.toSigned=function(){return this.unsigned?b.fromBits(this.low,this.high,!1):this};b.prototype.toUnsigned=function(){return this.unsigned?this:b.fromBits(this.low,this.high,!0)};b.INT_CACHE={};b.UINT_CACHE={};b.pow_dbl=Math.pow;b.TWO_PWR_16_DBL=65536;b.TWO_PWR_24_DBL=16777216;
b.TWO_PWR_32_DBL=b.TWO_PWR_16_DBL*b.TWO_PWR_16_DBL;b.TWO_PWR_64_DBL=b.TWO_PWR_32_DBL*b.TWO_PWR_32_DBL;b.TWO_PWR_63_DBL=b.TWO_PWR_64_DBL/2;b.TWO_PWR_24=b.fromInt(b.TWO_PWR_24_DBL);b.ZERO=b.fromInt(0);b.UZERO=b.fromInt(0,!0);b.ONE=b.fromInt(1);b.UONE=b.fromInt(1,!0);b.NEG_ONE=b.fromInt(-1);b.MAX_VALUE=b.fromBits(2147483647,4294967295,!1);b.MAX_UNSIGNED_VALUE=b.fromBits(4294967295,4294967295,!0);b.MIN_VALUE=b.fromBits(2147483648,0,!1);return b}();
Object.defineProperty(Long.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1});var org;
(function(b){(function(f){var n=function(){function b(){}b.isDefined=function(b){return void 0!=b&&null!=b};b.equals=function(b,e){return b===e};b.longArrayEquals=function(b,e){if(b.length!=e.length)return!1;for(var d=0;d<b.length;d++)if(b[d]!=e[d])return!1;return!0};b.KEY_SIZE=4;b.LONG_SIZE=53;b.PREFIX_SIZE=16;b.BEGINNING_OF_TIME=-9007199254740990;b.END_OF_TIME=9007199254740990;b.NULL_LONG=9007199254740991;b.KEY_PREFIX_MASK=137438953471;b.CACHE_MISS_ERROR="Cache miss error";b.QUERY_SEP=",";b.QUERY_KV_SEP=
"=";b.TASK_SEP=".";b.TASK_PARAM_OPEN="(";b.TASK_PARAM_CLOSE=")";b.CHUNK_SEP=124;b.CHUNK_SUB_SEP=44;b.CHUNK_SUB_SUB_SEP=58;b.CHUNK_SUB_SUB_SUB_SEP=37;b.BUFFER_SEP=35;b.KEY_SEP=59;b.MAP_INITIAL_CAPACITY=8;b.MAP_LOAD_FACTOR=.75;b.BOOL_TRUE=49;b.BOOL_FALSE=48;return b}();f.Constants=n;n=function(){function f(){this._plugins=this._scheduler=this._storage=null;this._memorySize=-1;this._readOnly=!1}f.prototype.withStorage=function(b){this._storage=b;return this};f.prototype.withReadOnlyStorage=function(b){this._storage=
b;this._readOnly=!0;return this};f.prototype.withMemorySize=function(b){this._memorySize=b;return this};f.prototype.withScheduler=function(b){this._scheduler=b;return this};f.prototype.withPlugin=function(b){if(null==this._plugins)this._plugins=Array(1),this._plugins[0]=b;else{var e=Array(this._plugins.length+1);java.lang.System.arraycopy(this._plugins,0,e,0,this._plugins.length);e[this._plugins.length]=b;this._plugins=e}return this};f.prototype.build=function(){null==b.mwg.GraphBuilder._internalBuilder&&
(b.mwg.GraphBuilder._internalBuilder=new b.mwg.core.Builder);return b.mwg.GraphBuilder._internalBuilder.newGraph(this._storage,this._readOnly,this._scheduler,this._plugins,this._memorySize)};f._internalBuilder=null;return f}();f.GraphBuilder=n;n=function(){function f(){}f.typeName=function(f){switch(f){case b.mwg.Type.BOOL:return"boolean";case b.mwg.Type.STRING:return"string";case b.mwg.Type.LONG:return"long";case b.mwg.Type.INT:return"int";case b.mwg.Type.DOUBLE:return"double";case b.mwg.Type.DOUBLE_ARRAY:return"double[]";
case b.mwg.Type.LONG_ARRAY:return"long[]";case b.mwg.Type.INT_ARRAY:return"int[]";case b.mwg.Type.LONG_TO_LONG_MAP:return"map(long->long)";case b.mwg.Type.LONG_TO_LONG_ARRAY_MAP:return"map(long->long[])";case b.mwg.Type.STRING_TO_LONG_MAP:return"map(string->long)";case b.mwg.Type.RELATION:return"relation";default:return"unknown"}};f.BOOL=1;f.STRING=2;f.LONG=3;f.INT=4;f.DOUBLE=5;f.DOUBLE_ARRAY=6;f.LONG_ARRAY=7;f.INT_ARRAY=8;f.LONG_TO_LONG_MAP=9;f.LONG_TO_LONG_ARRAY_MAP=10;f.STRING_TO_LONG_MAP=11;f.RELATION=
12;return f}();f.Type=n;(function(b){var f=function(){function b(){}b.STATE_CHUNK=0;b.TIME_TREE_CHUNK=1;b.WORLD_ORDER_CHUNK=2;b.GEN_CHUNK=3;return b}();b.ChunkType=f})(f.chunk||(f.chunk={}));(function(f){var q=function(){function e(b,a,c,k){this._time_magic=this._super_time_magic=this._world_magic=this._index_stateChunk=this._index_timeTree=this._index_superTimeTree=this._index_worldOrder=-1;this._dead=!1;this._world=b;this._time=a;this._id=c;this._graph=k;this._resolver=k.resolver()}e.prototype.cacheLock=
function(){};e.prototype.cacheUnlock=function(){};e.prototype.init=function(){};e.prototype.nodeTypeName=function(){return this._resolver.typeName(this)};e.prototype.unphasedState=function(){return this._resolver.resolveState(this)};e.prototype.phasedState=function(){return this._resolver.alignState(this)};e.prototype.newState=function(b){return this._resolver.newState(this,this._world,b)};e.prototype.graph=function(){return this._graph};e.prototype.world=function(){return this._world};e.prototype.time=
function(){return this._time};e.prototype.id=function(){return this._id};e.prototype.get=function(b){var a=this._resolver.resolveState(this);return null!=a?a.get(this._resolver.stringToHash(b,!1)):null};e.prototype.set=function(d,a){if("string"===typeof a||a instanceof String)this.setProperty(d,b.mwg.Type.STRING,a);else if("number"===typeof a||a instanceof Number)0!=a%1?this.setProperty(d,b.mwg.Type.DOUBLE,a):this.setProperty(d,b.mwg.Type.LONG,a);else if("boolean"===typeof a||a instanceof Boolean)this.setProperty(d,
b.mwg.Type.BOOL,a);else if(a instanceof Int32Array)this.setProperty(d,b.mwg.Type.LONG_ARRAY,a);else if(a instanceof Float64Array)this.setProperty(d,b.mwg.Type.DOUBLE_ARRAY,a);else throw Error("Invalid property type: "+a+", please use a Type listed in org.mwg.Type");};e.prototype.setProperty=function(d,a,c){d=this._resolver.stringToHash(d,!0);var k=this._resolver.alignState(this);if(null!=k)k.set(d,a,c);else throw Error(b.mwg.Constants.CACHE_MISS_ERROR);};e.prototype.isEquals=function(d,a,c){switch(c){case b.mwg.Type.BOOL:return d==
a;case b.mwg.Type.DOUBLE:return d==a;case b.mwg.Type.INT:return d==a;case b.mwg.Type.LONG:return d==a;case b.mwg.Type.STRING:return d===a}return d.equals(a)};e.prototype.getOrCreate=function(d,a){var c=this._resolver.alignState(this);if(null!=c)return c.getOrCreate(this._resolver.stringToHash(d,!0),a);throw Error(b.mwg.Constants.CACHE_MISS_ERROR);};e.prototype.type=function(b){var a=this._resolver.resolveState(this);return null!=a?a.getType(this._resolver.stringToHash(b,!1)):-1};e.prototype.removeProperty=
function(d){this.setProperty(d,b.mwg.Type.INT,null)};e.prototype.rel=function(b,a){this.relByIndex(this._resolver.stringToHash(b,!1),a)};e.prototype.relByIndex=function(b,a){if(null!=a){var c=this._resolver.resolveState(this);if(null!=c)if(c=c.get(b),null==c||0==c.size())a([]);else{for(var k=c.size(),m=new Float64Array(k),e=0;e<k;e++)m[e]=c.get(e);this._resolver.lookupAll(this._world,this._time,m,function(c){a(c)})}else a([])}};e.prototype.add=function(d,a){if(null!=a){var c=this._resolver.alignState(this),
k=this._resolver.stringToHash(d,!0);if(null!=c)c.getOrCreate(k,b.mwg.Type.RELATION).add(a.id());else throw Error(b.mwg.Constants.CACHE_MISS_ERROR);}};e.prototype.remove=function(d,a){if(null!=a){var c=this._resolver.alignState(this),k=this._resolver.stringToHash(d,!1);if(null!=c)c=c.get(k),null!=c&&c.remove(a.id());else throw Error(b.mwg.Constants.CACHE_MISS_ERROR);}};e.prototype.free=function(){this._resolver.freeNode(this)};e.prototype.timeDephasing=function(){var d=this._resolver.resolveState(this);
if(null!=d)return this._time-d.time();throw Error(b.mwg.Constants.CACHE_MISS_ERROR);};e.prototype.lastModification=function(){var d=this._resolver.resolveState(this);if(null!=d)return d.time();throw Error(b.mwg.Constants.CACHE_MISS_ERROR);};e.prototype.rephase=function(){this._resolver.alignState(this)};e.prototype.timepoints=function(b,a,c){this._resolver.resolveTimepoints(this,b,a,c)};e.prototype.jump=function(b,a){this._resolver.lookup(this._world,b,this._id,a)};e.prototype.findByQuery=function(d,
a){var c=this._resolver.resolveState(this);if(null==c)throw Error(b.mwg.Constants.CACHE_MISS_ERROR);var k=d.indexName();if(null==k)throw Error("Please specify indexName in query before first use!");var m=d.world();m==b.mwg.Constants.NULL_LONG&&(m=this.world());var e=d.time();e==b.mwg.Constants.NULL_LONG&&(e=this.time());c=c.get(this._resolver.stringToHash(k,!1));if(null!=c){var g=this,l=c.get(d.hash());null==l?a([]):g._resolver.lookupAll(m,e,l,function(c){for(var k=Array(l.length),m=0,e=0;e<k.length;e++){var t=
c[e];if(null!=t){for(var f=g._resolver.resolveState(t),q=!0,n=0;n<d.attributes().length;n++){var r=f.get(d.attributes()[n]);if(null==d.values()[n]){if(null!=r){q=!1;break}}else if(null==r){q=!1;break}else if(r instanceof Float64Array)if(d.values()[n]instanceof Float64Array){if(!b.mwg.Constants.longArrayEquals(d.values()[n],r)){q=!1;break}}else{q=!1;break}else if(!b.mwg.Constants.equals(d.values()[n].toString(),r.toString())){q=!1;break}}q&&(k[m]=t,m++)}}k.length==m?a(k):(c=Array(m),java.lang.System.arraycopy(k,
0,c,0,m),a(c))})}else a([])};e.prototype.find=function(b,a,c){var k=this._graph.newQuery();k.setWorld(this.world());k.setTime(this.time());k.setIndexName(b);k.parse(a);this.findByQuery(k,c)};e.prototype.findAll=function(d,a){var c=this._resolver.resolveState(this);if(null==c)throw Error(b.mwg.Constants.CACHE_MISS_ERROR);c=c.get(this._resolver.stringToHash(d,!1));if(null!=c){var k=new Float64Array(c.size()),m=new Int32Array([0]);c.each(function(c,a){k[m[0]]=a;m[0]++});this._resolver.lookupAll(this.world(),
this.time(),k,function(c){a(c)})}else a([])};e.prototype.index=function(d,a,c,k){c=c.split(b.mwg.Constants.QUERY_SEP+"");var m=this._resolver.alignState(this);if(null==m)throw Error(b.mwg.Constants.CACHE_MISS_ERROR);d=m.getOrCreate(this._resolver.stringToHash(d,!0),b.mwg.Type.LONG_TO_LONG_ARRAY_MAP);for(var m=this._graph.newQuery(),e=this._resolver.resolveState(a),g=0;g<c.length;g++){var l=e.getFromKey(c[g]);null!=l?m.add(c[g],l.toString()):m.add(c[g],null)}d.put(m.hash(),a.id());b.mwg.Constants.isDefined(k)&&
k(!0)};e.prototype.unindex=function(d,a,c,k){c=c.split(b.mwg.Constants.QUERY_SEP+"");var m=this._resolver.alignState(this);if(null==m)throw Error(b.mwg.Constants.CACHE_MISS_ERROR);d=m.get(this._resolver.stringToHash(d,!1));if(null!=d){for(var m=this._graph.newQuery(),e=this._resolver.resolveState(a),g=0;g<c.length;g++){var l=c[g],h=e.getFromKey(l);null!=h?m.add(l,h.toString()):m.add(l,null)}d.remove(m.hash(),a.id())}b.mwg.Constants.isDefined(k)&&k(!0)};e.prototype.isNaN=function(b){return isNaN(b)};
e.prototype.toString=function(){var d=this,a=new java.lang.StringBuilder;a.append('{"world":');a.append(this.world());a.append(',"time":');a.append(this.time());a.append(',"id":');a.append(this.id());var c=this._resolver.resolveState(this);null!=c&&(c.each(function(c,m,e){if(null!=e)switch(m){case b.mwg.Type.BOOL:a.append(',"');a.append(d._resolver.hashToString(c));a.append('":');e?a.append("0"):a.append("1");break;case b.mwg.Type.STRING:a.append(',"');a.append(d._resolver.hashToString(c));a.append('":');
a.append('"');a.append(e);a.append('"');break;case b.mwg.Type.LONG:a.append(',"');a.append(d._resolver.hashToString(c));a.append('":');a.append(e);break;case b.mwg.Type.INT:a.append(',"');a.append(d._resolver.hashToString(c));a.append('":');a.append(e);break;case b.mwg.Type.DOUBLE:d.isNaN(e)||(a.append(',"'),a.append(d._resolver.hashToString(c)),a.append('":'),a.append(e));break;case b.mwg.Type.DOUBLE_ARRAY:a.append(',"');a.append(d._resolver.hashToString(c));a.append('":');a.append("[");for(c=0;c<
e.length;c++)0!=c&&a.append(","),a.append(e[c]);a.append("]");break;case b.mwg.Type.RELATION:a.append(',"');a.append(d._resolver.hashToString(c));a.append('":');a.append("[");for(c=0;c<e.size();c++)0!=c&&a.append(","),a.append(e.get(c));a.append("]");break;case b.mwg.Type.LONG_ARRAY:a.append(',"');a.append(d._resolver.hashToString(c));a.append('":');a.append("[");for(c=0;c<e.length;c++)0!=c&&a.append(","),a.append(e[c]);a.append("]");break;case b.mwg.Type.INT_ARRAY:a.append(',"');a.append(d._resolver.hashToString(c));
a.append('":');a.append("[");for(c=0;c<e.length;c++)0!=c&&a.append(","),a.append(e[c]);a.append("]");break;case b.mwg.Type.LONG_TO_LONG_MAP:a.append(',"');a.append(d._resolver.hashToString(c));a.append('":');a.append("{");var g=[!0];e.each(function(c,b){g[0]?g[0]=!1:a.append(",");a.append('"');a.append(c);a.append('":');a.append(b)});a.append("}");break;case b.mwg.Type.LONG_TO_LONG_ARRAY_MAP:a.append(',"');a.append(d._resolver.hashToString(c));a.append('":');a.append("{");var g=[!0],l=new java.util.HashSet;
e.each(function(c,a){l.add(c)});m=l.toArray(Array(l.size()));for(var h=0;h<m.length;h++){var f=e.get(m[h]);g[0]?g[0]=!1:a.append(",");a.append('"');a.append(m[h]);a.append('":[');for(c=0;c<f.length;c++)0!=c&&a.append(","),a.append(f[c]);a.append("]")}a.append("}");break;case b.mwg.Type.STRING_TO_LONG_MAP:a.append(',"'),a.append(d._resolver.hashToString(c)),a.append('":'),a.append("{"),g=[!0],e.each(function(c,b){g[0]?g[0]=!1:a.append(",");a.append('"');a.append(c);a.append('":');a.append(b)}),a.append("}")}}),
a.append("}"));return a.toString()};e.prototype.getOrCreateRel=function(d){return this.getOrCreate(d,b.mwg.Type.RELATION)};e.prototype.getByIndex=function(b){return this._resolver.resolveState(this).get(b)};e.prototype.setPropertyByIndex=function(b,a,c){this._resolver.alignState(this).set(b,a,c)};return e}();f.AbstractNode=q;q=function(){function b(){this._nodeTypes=new java.util.HashMap;this._taskActions=new java.util.HashMap}b.prototype.declareNodeType=function(b,a){this._nodeTypes.put(b,a);return this};
b.prototype.declareTaskAction=function(b,a){this._taskActions.put(b,a);return this};b.prototype.declareMemoryFactory=function(b){this._memoryFactory=b;return this};b.prototype.declareResolverFactory=function(b){this._resolverFactory=b;return this};b.prototype.hookFactory=function(){return this._hookFactory};b.prototype.declareTaskHookFactory=function(b){this._hookFactory=b;return this};b.prototype.nodeTypes=function(){return this._nodeTypes.keySet().toArray(Array(this._nodeTypes.size()))};b.prototype.nodeType=
function(b){return this._nodeTypes.get(b)};b.prototype.taskActionTypes=function(){return this._taskActions.keySet().toArray(Array(this._taskActions.size()))};b.prototype.taskActionType=function(b){return this._taskActions.get(b)};b.prototype.memoryFactory=function(){return this._memoryFactory};b.prototype.resolverFactory=function(){return this._resolverFactory};return b}();f.AbstractPlugin=q;q=function(){function b(){this._next=null}b.prototype.setNext=function(b){this._next=b};b.prototype.next=function(){return this._next};
return b}();f.AbstractTaskAction=q;q=function(){function b(){}b.SAME_THREAD=0;b.ANY_LOCAL_THREAD=1;b.OTHER_LOCAL_THREAD=2;b.ANY_REMOTE_THREAD=3;return b}();f.SchedulerAffinity=q})(f.plugin||(f.plugin={}));(function(f){var q=function(){function e(){}e.newTask=function(){null==b.mwg.task.Actions._internalBuilder&&(b.mwg.task.Actions._internalBuilder=new b.mwg.core.Builder);return b.mwg.task.Actions._internalBuilder.newTask()};e.setWorld=function(d){return b.mwg.task.Actions.newTask().setWorld(d)};e.setTime=
function(d){return b.mwg.task.Actions.newTask().setTime(d)};e.then=function(d){return b.mwg.task.Actions.newTask().then(d)};e.inject=function(d){return b.mwg.task.Actions.newTask().inject(d)};e.fromVar=function(d){return b.mwg.task.Actions.newTask().fromVar(d)};e.fromVarAt=function(d,a){return b.mwg.task.Actions.newTask().fromVarAt(d,a)};e.fromIndexAll=function(d){return b.mwg.task.Actions.newTask().fromIndexAll(d)};e.fromIndex=function(d,a){return b.mwg.task.Actions.newTask().fromIndex(d,a)};e.indexNode=
function(d,a){return b.mwg.task.Actions.newTask().indexNode(d,a)};e.unindexNode=function(d,a){return b.mwg.task.Actions.newTask().unindexNode(d,a)};e.localIndex=function(d,a,c){return b.mwg.task.Actions.newTask().localIndex(d,a,c)};e.localUnindex=function(d,a,c){return b.mwg.task.Actions.newTask().localUnindex(d,a,c)};e.parse=function(d){return b.mwg.task.Actions.newTask().parse(d)};e.asGlobalVar=function(d){return b.mwg.task.Actions.newTask().asGlobalVar(d)};e.addToGlobalVar=function(d){return b.mwg.task.Actions.newTask().addToGlobalVar(d)};
e.asVar=function(d){return b.mwg.task.Actions.newTask().asGlobalVar(d)};e.defineVar=function(d){return b.mwg.task.Actions.newTask().defineVar(d)};e.addToVar=function(d){return b.mwg.task.Actions.newTask().addToVar(d)};e.map=function(d){return b.mwg.task.Actions.newTask().map(d)};e.selectWith=function(d,a){return b.mwg.task.Actions.newTask().selectWith(d,a)};e.selectWithout=function(d,a){return b.mwg.task.Actions.newTask().selectWithout(d,a)};e.select=function(d){return b.mwg.task.Actions.newTask().select(d)};
e.selectObject=function(d){return b.mwg.task.Actions.newTask().selectObject(d)};e.traverse=function(d){return b.mwg.task.Actions.newTask().traverse(d)};e.get=function(d){return b.mwg.task.Actions.newTask().get(d)};e.traverseIndex=function(d,a){return b.mwg.task.Actions.newTask().traverseIndex(d,a)};e.traverseOrKeep=function(d){return b.mwg.task.Actions.newTask().traverseOrKeep(d)};e.traverseIndexAll=function(d){return b.mwg.task.Actions.newTask().traverseIndexAll(d)};e.loop=function(d,a,c){return b.mwg.task.Actions.newTask().loop(d,
a,c)};e.loopPar=function(d,a,c){return b.mwg.task.Actions.newTask().loopPar(d,a,c)};e.print=function(d){return b.mwg.task.Actions.newTask().print(d)};e.setProperty=function(d,a,c){return b.mwg.task.Actions.newTask().setProperty(d,a,c)};e.selectWhere=function(d){return b.mwg.task.Actions.newTask().selectWhere(d)};e.foreach=function(d){return b.mwg.task.Actions.newTask().foreach(d)};e.foreachPar=function(d){return b.mwg.task.Actions.newTask().foreachPar(d)};e.math=function(d){return b.mwg.task.Actions.newTask().math(d)};
e.action=function(d,a){return b.mwg.task.Actions.newTask().action(d,a)};e.remove=function(d,a){return b.mwg.task.Actions.newTask().remove(d,a)};e.add=function(d,a){return b.mwg.task.Actions.newTask().add(d,a)};e.properties=function(){return b.mwg.task.Actions.newTask().properties()};e.propertiesWithType=function(d){return b.mwg.task.Actions.newTask().propertiesWithType(d)};e.jump=function(d){return b.mwg.task.Actions.newTask().jump(d)};e.removeProperty=function(d){return b.mwg.task.Actions.newTask().removeProperty(d)};
e.newNode=function(){return b.mwg.task.Actions.newTask().newNode()};e.newTypedNode=function(d){return b.mwg.task.Actions.newTask().newTypedNode(d)};e.save=function(){return b.mwg.task.Actions.newTask().save()};e.ifThen=function(d,a){return b.mwg.task.Actions.newTask().ifThen(d,a)};e.ifThenElse=function(d,a,c){return b.mwg.task.Actions.newTask().ifThenElse(d,a,c)};e.whileDo=function(d,a){return b.mwg.task.Actions.newTask().whileDo(d,a)};e.doWhile=function(d,a){return b.mwg.task.Actions.newTask().doWhile(d,
a)};e.split=function(d){return b.mwg.task.Actions.newTask().split(d)};e.lookup=function(d){return b.mwg.task.Actions.newTask().lookup(d)};e.hook=function(d){return b.mwg.task.Actions.newTask().hook(d)};e.clear=function(){return b.mwg.task.Actions.newTask().clear()};e.subTask=function(d){return b.mwg.task.Actions.newTask().subTask(d)};e.isolate=function(d){return b.mwg.task.Actions.newTask().isolate(d)};e.subTasks=function(d){return b.mwg.task.Actions.newTask().subTasks(d)};e.subTasksPar=function(d){return b.mwg.task.Actions.newTask().subTasksPar(d)};
e.cond=function(d){return b.mwg.task.Actions.newTask().mathConditional(d)};e._internalBuilder=null;return e}();f.Actions=q})(f.task||(f.task={}));(function(f){var q=function(){function b(){}b.encodeLongToBuffer=function(d,a){var c=!0,k=d;0>d&&(k=-k);for(var m=47;5<=m;m-=6)c&&0==(k/b.powTwo[m]&63)||(c=!1,a.write(b.dictionary[k/b.powTwo[m]&63]));a.write(b.dictionary[2*(k&31)+(0>d?1:0)])};b.encodeIntToBuffer=function(d,a){var c=!0,k=d;0>d&&(k=-k);for(var m=29;5<=m;m-=6)c&&0==(k/b.powTwo[m]&63)||(c=!1,
a.write(b.dictionary[k/b.powTwo[m]&63]));a.write(b.dictionary[2*(k&31)+(0>d?1:0)])};b.decodeToLong=function(d){return b.decodeToLongWithBounds(d,0,d.length())};b.decodeToLongWithBounds=function(d,a,c){for(var k=Long.ZERO,k=k.add(b.longIndexes[b.dictionary.indexOf(d.read(c-1))&255].shiftRightUnsigned(1)),m=1;m<c-a;m++)k=k.add(b.longIndexes[b.dictionary.indexOf(d.read(c-1-m))&255].shiftLeft(6*m-1));0!=(b.dictionary.indexOf(d.read(c-1))&1)&&(k=k.mul(-1));return k.toNumber()};b.decodeToInt=function(d){return b.decodeToIntWithBounds(d,
0,d.length())};b.decodeToIntWithBounds=function(d,a,c){var k;k=0+(b.dictionary.indexOf(d.read(c-1))&255)/2;for(var m=1;m<c-a;m++)k+=(b.dictionary.indexOf(d.read(c-1-m))&255)*b.powTwo[6*m-1];0!=(b.dictionary.indexOf(d.read(c-1))&1)&&(k=-k);return k};b.encodeDoubleToBuffer=function(d,a){var c=[],k=new Float64Array(1),m=new Uint8Array(k.buffer);k[0]=d;k=2048*(m[7]/128&1)+((16*(m[7]&127)|m[6]/16)-1023+1023);c.push(b.dictionary[k/64&63]);c.push(b.dictionary[k&63]);c.push(b.dictionary[m[6]&15]);c.push(b.dictionary[m[5]/
4&63]);c.push(b.dictionary[16*(m[5]&3)|m[4]/16]);c.push(b.dictionary[4*(m[4]&15)|m[3]/64]);c.push(b.dictionary[m[3]&63]);c.push(b.dictionary[m[2]/4&63]);c.push(b.dictionary[16*(m[2]&3)|m[1]/16]);c.push(b.dictionary[4*(m[1]&15)|m[0]/64]);c.push(b.dictionary[m[0]&63]);for(m=c.length;3<=m&&65==c[t];)m--;for(var t=0;t<m;t++)a.write(c[t])};b.decodeToDouble=function(d){return b.decodeToDoubleWithBounds(d,0,d.length())};b.decodeToDoubleWithBounds=function(d,a,c){for(var k=64*(b.dictionary.indexOf(d.read(a))&
255)+(b.dictionary.indexOf(d.read(a+1))&255),m=0!=(k&2048)?-1:1,k=k&2047,t=0,g=2;g<c-a;g++)t+=(b.dictionary.indexOf(d.read(a+g))&255)*b.powTwo[48-6*(g-2)];return 0!=k?m*Math.pow(2,k-1023)*(1+t/Math.pow(2,52)):m*Math.pow(2,-1022)*(0+t/Math.pow(2,52))};b.encodeBoolArrayToBuffer=function(d,a){for(var c=0,k=0;k<d.length;k++)if(c|=(d[k]?1:0)*b.powTwo[k%6],5==k%6||k==d.length-1)a.write(b.dictionary[c]),c=0};b.decodeBoolArray=function(d,a){return b.decodeToBoolArrayWithBounds(d,0,d.length(),a)};b.decodeToBoolArrayWithBounds=
function(d,a,c,k){for(var m=[],t=0;t<c-a;t++)for(var g=b.dictionary.indexOf(d.read(a+t))&255,l=0;6>l;l++)if(6*t+l<k)m[6*t+l]=0!=(g&1*b.powTwo[l]);else break;return m};b.encodeStringToBuffer=function(d,a){for(var c=d.length,k,m=0,t=6,g=0;g<c;g++)k=d.charCodeAt(g),6==t?(a.write(b.dictionary[k/4&63]),m=16*(k&3),t=4):4==t?(a.write(b.dictionary[(m|k/16&15)&63]),m=4*(k&15),t=2):2==t&&(a.write(b.dictionary[(m|k/64&3)&63]),a.write(b.dictionary[k&63]),t=6);6!=t&&a.write(b.dictionary[m])};b.decodeString=function(d){return b.decodeToStringWithBounds(d,
0,d.length())};b.decodeToStringWithBounds=function(d,a,c){for(var k="",m=0,t=8,g=a;g<c;g++)a=b.dictionary.indexOf(d.read(g)),8==t?(m=4*a,t=2):2==t?(k+=String.fromCharCode(m|a/16),m=16*(a&15),t=4):4==t?(k+=String.fromCharCode(m|a/4),m=64*(a&3),t=6):6==t&&(k+=String.fromCharCode(m|a),t=8);return k};b.dictionary=[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,
52,53,54,55,56,57,43,47];b.powTwo={0:1,1:2,2:4,3:8,4:16,5:32,6:64,7:128,8:256,9:512,10:1024,11:2048,12:4096,13:8192,14:16384,15:32768,16:65536,17:131072,18:262144,19:524288,20:1048576,21:2097152,22:4194304,23:8388608,24:16777216,25:33554432,26:67108864,27:134217728,28:268435456,29:536870912,30:1073741824,31:2147483648,32:4294967296,33:8589934592,34:17179869184,35:34359738368,36:68719476736,37:137438953472,38:274877906944,39:549755813888,40:1099511627776,41:2199023255552,42:4398046511104,43:8796093022208,
44:17592186044416,45:35184372088832,46:70368744177664,47:0x800000000000,48:281474976710656,49:562949953421312,50:0x4000000000000,51:0x8000000000000,52:4503599627370496,53:9007199254740992};b.longIndexes=[Long.fromNumber(0),Long.fromNumber(1),Long.fromNumber(2),Long.fromNumber(3),Long.fromNumber(4),Long.fromNumber(5),Long.fromNumber(6),Long.fromNumber(7),Long.fromNumber(8),Long.fromNumber(9),Long.fromNumber(10),Long.fromNumber(11),Long.fromNumber(12),Long.fromNumber(13),Long.fromNumber(14),Long.fromNumber(15),
Long.fromNumber(16),Long.fromNumber(17),Long.fromNumber(18),Long.fromNumber(19),Long.fromNumber(20),Long.fromNumber(21),Long.fromNumber(22),Long.fromNumber(23),Long.fromNumber(24),Long.fromNumber(25),Long.fromNumber(26),Long.fromNumber(27),Long.fromNumber(28),Long.fromNumber(29),Long.fromNumber(30),Long.fromNumber(31),Long.fromNumber(32),Long.fromNumber(33),Long.fromNumber(34),Long.fromNumber(35),Long.fromNumber(36),Long.fromNumber(37),Long.fromNumber(38),Long.fromNumber(39),Long.fromNumber(40),Long.fromNumber(41),
Long.fromNumber(42),Long.fromNumber(43),Long.fromNumber(44),Long.fromNumber(45),Long.fromNumber(46),Long.fromNumber(47),Long.fromNumber(48),Long.fromNumber(49),Long.fromNumber(50),Long.fromNumber(51),Long.fromNumber(52),Long.fromNumber(53),Long.fromNumber(54),Long.fromNumber(55),Long.fromNumber(56),Long.fromNumber(57),Long.fromNumber(58),Long.fromNumber(59),Long.fromNumber(60),Long.fromNumber(61),Long.fromNumber(62),Long.fromNumber(63)];return b}();f.Base64=q;q=function(){function b(d,a,c){this._origin=
d;this._initPos=a;this._endPos=c}b.prototype.write=function(b){throw Error("Write operation forbidden during iteration");};b.prototype.writeAll=function(b){throw Error("Write operation forbidden during iteration");};b.prototype.read=function(b){if(this._initPos+b>this._endPos)throw Error(""+b);return this._origin.read(this._initPos+b)};b.prototype.data=function(){return this._origin.slice(this._initPos,this._endPos)};b.prototype.length=function(){return this._endPos-this._initPos+1};b.prototype.free=
function(){throw Error("Free operation forbidden during iteration");};b.prototype.iterator=function(){throw Error("iterator creation forbidden forbidden during iteration");};b.prototype.removeLast=function(){throw Error("Write operation forbidden during iteration");};b.prototype.slice=function(b,a){throw Error("Write operation forbidden during iteration");};return b}();f.BufferView=q;q=function(){function e(b){this._cursor=-1;this._origin=b;this._originSize=b.length()}e.prototype.hasNext=function(){return 0<
this._originSize&&this._cursor+1<this._originSize};e.prototype.next=function(){for(var d=this._cursor;this._cursor+1<this._originSize;)if(this._cursor++,this._origin.read(this._cursor)==b.mwg.Constants.BUFFER_SEP)return new b.mwg.utility.BufferView(this._origin,d+1,this._cursor-1);return d<this._originSize?new b.mwg.utility.BufferView(this._origin,d+1,this._cursor):null};return e}();f.DefaultBufferIterator=q;q=function(){function e(){this.checkers=new java.util.HashMap}e.prototype.asBool=function(d){return this.declare(d,
{check:function(a,c){if(null!=c&&a!=b.mwg.Type.BOOL)throw Error("Property "+d+" should be Boolean value, currently "+c);}})};e.prototype.asString=function(d){return this.declare(d,{check:function(a,c){if(null!=c&&a!=b.mwg.Type.STRING)throw Error("Property "+d+" should be String value, currently "+c);}})};e.prototype.asLong=function(d){return this.declare(d,{check:function(a,c){if(null!=c&&a!=b.mwg.Type.LONG&&a!=b.mwg.Type.INT)throw Error("Property "+d+" should be long value, currently "+c);}})};e.prototype.asLongWithin=
function(d,a,c){return this.declare(d,{check:function(k,m){if(null!=m&&(k!=b.mwg.Type.LONG&&k!=b.mwg.Type.INT||m<a||m>c))throw Error("Property "+d+" should be long value ["+a+","+c+"], currently "+m);}})};e.prototype.asDouble=function(d){return this.declare(d,{check:function(a,c){if(null!=c&&a!=b.mwg.Type.DOUBLE&&a!=b.mwg.Type.INT&&a!=b.mwg.Type.LONG)throw Error("Property "+d+" should be double value, currently "+c);}})};e.prototype.asDoubleWithin=function(d,a,c){return this.declare(d,{check:function(k,
m){if(null!=m&&(k!=b.mwg.Type.DOUBLE&&k!=b.mwg.Type.INT&&k!=b.mwg.Type.LONG||m<a||m>c))throw Error("Property "+d+" should be double value ["+a+","+c+"], currently "+m);}})};e.prototype.asInt=function(d){return this.declare(d,{check:function(a,c){if(null!=c&&a!=b.mwg.Type.INT&&a!=b.mwg.Type.LONG)throw Error("Property "+d+" should be integer value, currently "+c);}})};e.prototype.asIntWithin=function(d,a,c){return this.declare(d,{check:function(k,m){if(null!=m&&(k!=b.mwg.Type.INT&&k!=b.mwg.Type.LONG||
m<a||m>c))throw Error("Property "+d+" should be integer value ["+a+","+c+"], currently "+m);}})};e.prototype.asIntGreaterOrEquals=function(d,a){return this.declare(d,{check:function(c,k){if(null!=k&&(c!=b.mwg.Type.INT&&c!=b.mwg.Type.LONG||k<a))throw Error("Property "+d+" should be integer value >="+a+", currently "+k);}})};e.prototype.asDoubleArray=function(d){return this.declare(d,{check:function(a,c){if(null!=c&&a!=b.mwg.Type.DOUBLE_ARRAY)throw Error("Property "+d+" should be doubleArray value, currently "+
c);}})};e.prototype.asPositiveInt=function(d){return this.declare(d,{check:function(a,c){if(null!=c&&a!=b.mwg.Type.INT||0>=c)throw Error("Property "+d+" should be a positive integer, currently "+c);}})};e.prototype.asNonNegativeDouble=function(d){return this.declare(d,{check:function(a,c){if(null!=c&&(a!=b.mwg.Type.DOUBLE&&a!=b.mwg.Type.INT&&a!=b.mwg.Type.LONG||!(0<=c)))throw Error("Property "+d+" should be a non-negative double, currently "+c);}})};e.prototype.asPositiveDouble=function(d){return this.declare(d,
{check:function(a,c){if(null!=c&&(a!=b.mwg.Type.DOUBLE&&a!=b.mwg.Type.INT&&a!=b.mwg.Type.LONG||!(0<c)))throw Error("Property "+d+" should be a positive double, currently "+c);}})};e.prototype.asNonNegativeOrNanDouble=function(d){return this.declare(d,{check:function(a,c){if(null!=c&&(a!=b.mwg.Type.DOUBLE&&a!=b.mwg.Type.INT&&a!=b.mwg.Type.LONG||0>c))throw Error("Property "+d+" should be a positive double, currently "+c);}})};e.prototype.asPositiveLong=function(d){return this.declare(d,{check:function(a,
c){if(null!=c&&(a!=b.mwg.Type.LONG&&a!=b.mwg.Type.INT||0>=c))throw Error("Property "+d+" should be a positive long, currently "+c);}})};e.prototype.declare=function(b,a){this.checkers.put(b,a);return this};e.prototype.check=function(b,a,c){b=this.checkers.get(b);null!=b&&b.check(a,c)};return e}();f.Enforcer=q;q=function(){function e(){}e.longHash=function(d,a){if(0>=a)throw Error("Max must be > 0");var c=b.mwg.utility.HashHelper.PRIME5,c=c.add(d),c=c.add(c.shiftLeft(17)),c=c.mul(b.mwg.utility.HashHelper.PRIME4),
c=c.mul(b.mwg.utility.HashHelper.PRIME1),c=c.add(d),c=c.add(c.shiftLeft(17)),c=c.mul(b.mwg.utility.HashHelper.PRIME4),c=c.mul(b.mwg.utility.HashHelper.PRIME1),c=c.add(b.mwg.utility.HashHelper.len),c=c.xor(c.shiftRightUnsigned(15)),c=c.mul(b.mwg.utility.HashHelper.PRIME2),c=c.add(d),c=c.xor(c.shiftRightUnsigned(13)),c=c.mul(b.mwg.utility.HashHelper.PRIME3),c=c.xor(c.shiftRightUnsigned(16)),c=c.isNegative()?c.mul(-1):c,c=c.mod(a);return c.toNumber()};e.tripleHash=function(d,a,c,k,m){if(0>=m)throw Error("Max must be > 0");
var e=b.mwg.utility.HashHelper.PRIME5,g=e.mul(b.mwg.utility.HashHelper.PRIME2).add(b.mwg.utility.HashHelper.len),l=g.mul(b.mwg.utility.HashHelper.PRIME3),h=l.mul(b.mwg.utility.HashHelper.PRIME4),e=e.shiftLeft(13).or(e.shiftRightUnsigned(51)).add(Long.fromNumber(a,!1)),g=g.shiftLeft(11).or(g.shiftRightUnsigned(53)).add(Long.fromNumber(c,!1)),l=l.shiftLeft(17).or(l.shiftRightUnsigned(47)).add(Long.fromNumber(k,!1)),h=h.shiftLeft(19).or(h.shiftRightUnsigned(45)).add(Long.fromNumber(d,!1)),e=e.add(e.shiftLeft(17).or(e.shiftRightUnsigned(47))),
g=g.add(g.shiftLeft(19).or(g.shiftRightUnsigned(45))),l=l.add(l.shiftLeft(13).or(l.shiftRightUnsigned(51))),h=h.add(h.shiftLeft(11).or(h.shiftRightUnsigned(53))),e=e.mul(b.mwg.utility.HashHelper.PRIME1).add(Long.fromNumber(a,!1)),g=g.mul(b.mwg.utility.HashHelper.PRIME1).add(Long.fromNumber(c,!1)),l=l.mul(b.mwg.utility.HashHelper.PRIME1).add(Long.fromNumber(k,!1)),h=h.mul(b.mwg.utility.HashHelper.PRIME1).add(b.mwg.utility.HashHelper.PRIME5),e=e.mul(b.mwg.utility.HashHelper.PRIME2),g=g.mul(b.mwg.utility.HashHelper.PRIME2),
l=l.mul(b.mwg.utility.HashHelper.PRIME2),h=h.mul(b.mwg.utility.HashHelper.PRIME2),e=e.add(e.shiftLeft(11).or(e.shiftRightUnsigned(53))),g=g.add(g.shiftLeft(17).or(g.shiftRightUnsigned(47))),l=l.add(l.shiftLeft(19).or(l.shiftRightUnsigned(45))),h=h.add(h.shiftLeft(13).or(h.shiftRightUnsigned(51))),e=e.mul(b.mwg.utility.HashHelper.PRIME3),g=g.mul(b.mwg.utility.HashHelper.PRIME3),l=l.mul(b.mwg.utility.HashHelper.PRIME3),h=h.mul(b.mwg.utility.HashHelper.PRIME3);d=e.add(g.shiftLeft(3).or(g.shiftRightUnsigned(61)));
d=d.add(l.shiftLeft(6).or(l.shiftRightUnsigned(58)));d=d.add(h.shiftLeft(9).or(h.shiftRightUnsigned(55)));d=d.xor(d.shiftRightUnsigned(11));d=d.add(b.mwg.utility.HashHelper.PRIME4.add(b.mwg.utility.HashHelper.len).mul(b.mwg.utility.HashHelper.PRIME1));d=d.xor(d.shiftRightUnsigned(15));d=d.mul(b.mwg.utility.HashHelper.PRIME2);d=d.xor(d.shiftRightUnsigned(13));d=d.isNegative()?d.mul(-1):d;d=d.mod(m);return d.toNumber()};e.rand=function(){return 1E6*Math.random()};e.equals=function(b,a){return b===a};
e.DOUBLE_MIN_VALUE=function(){return Number.MIN_VALUE};e.DOUBLE_MAX_VALUE=function(){return Number.MAX_VALUE};e.isDefined=function(b){return void 0!=b&&null!=b};e.hash=function(d){for(var a=b.mwg.utility.HashHelper.HSTART,c=d.length,k=0;k<c;k++)a=a.mul(b.mwg.utility.HashHelper.HMULT).xor(b.mwg.utility.HashHelper.byteTable[d.charCodeAt(k)&255]);return a.mod(b.mwg.core.CoreConstants.END_OF_TIME).toNumber()};e.hashBytes=function(d){for(var a=b.mwg.utility.HashHelper.HSTART,c=d.length,k=0;k<c;k++)a=a.mul(b.mwg.utility.HashHelper.HMULT).xor(b.mwg.utility.HashHelper.byteTable[d[k]&
255]);return a.mod(b.mwg.core.CoreConstants.END_OF_TIME).toNumber()};e.PRIME1=Long.fromNumber(2654435761,!1);e.PRIME2=Long.fromNumber(2246822519,!1);e.PRIME3=Long.fromNumber(3266489917,!1);e.PRIME4=Long.fromNumber(668265263,!1);e.PRIME5=Long.fromNumber(374761393,!1);e.len=24;e.byteTable=function(){for(var b=[],a=Long.fromBits(3400472196,1414213562),c=0;256>c;c++){for(var k=0;31>k;k++)a=a.shiftRightUnsigned(7).xor(a),a=a.shiftLeft(11).xor(a),a=a.shiftRightUnsigned(10).xor(a);b[c]=a.toSigned()}return b}();
e.HSTART=Long.fromBits(2718281828,3141592653);e.HMULT=Long.fromBits(3776338029,1784494570);return e}();f.HashHelper=q;q=function(){function e(){}e.keyToBuffer=function(d,a,c,k,m){d.write(a);d.write(b.mwg.Constants.KEY_SEP);b.mwg.utility.Base64.encodeLongToBuffer(c,d);d.write(b.mwg.Constants.KEY_SEP);b.mwg.utility.Base64.encodeLongToBuffer(k,d);d.write(b.mwg.Constants.KEY_SEP);b.mwg.utility.Base64.encodeLongToBuffer(m,d)};return e}();f.KeyHelper=q;q=function(){function b(){this.ctxIdents=new java.util.HashMap}
b.prototype.start=function(b){this.ctxIdents.put(b,0);console.log("StartTask:"+b)};b.prototype.beforeAction=function(b,a){for(var c=this.ctxIdents.get(a),k=0;k<c;k++)console.log("\t");console.log(a.template(b.toString()))};b.prototype.afterAction=function(b,a){};b.prototype.beforeTask=function(b,a){var c=this.ctxIdents.get(b);this.ctxIdents.put(a,c+1)};b.prototype.afterTask=function(b){this.ctxIdents.remove(b)};b.prototype.end=function(b){console.log("EndTask:"+b.toString())};return b}();f.VerboseHook=
q;q=function(){function e(){}e.prototype.newHook=function(){return new b.mwg.utility.VerboseHook};return e}();f.VerboseHookFactory=q;q=function(e){function d(){e.call(this);this.declareTaskHookFactory(new b.mwg.utility.VerboseHookFactory)}__extends(d,e);return d}(b.mwg.plugin.AbstractPlugin);f.VerbosePlugin=q})(f.utility||(f.utility={}))})(b.mwg||(b.mwg={}))})(org||(org={}));
(function(b){(function(f){(function(f){var r=function(){function f(){this.prefix=0}f.prototype.get=function(e,d){for(var a=this._graph.newBuffer(),c=e.iterator(),k=!0;c.hasNext();)c.next(),k?k=!1:a.write(b.mwg.core.CoreConstants.BUFFER_SEP);d(a)};f.prototype.put=function(b,d){null!=d&&d(!0)};f.prototype.remove=function(b,d){d(!0)};f.prototype.connect=function(b,d){this._graph=b;d(!0)};f.prototype.lock=function(e){var d=this._graph.newBuffer();b.mwg.utility.Base64.encodeIntToBuffer(this.prefix,d);
this.prefix++;e(d)};f.prototype.unlock=function(b,d){d(!0)};f.prototype.disconnect=function(b){this._graph=null;b(!0)};return f}();f.BlackHoleStorage=r;r=function(){function f(){}f.prototype.newGraph=function(e,d,a,c,k){null==e&&(e=new b.mwg.core.BlackHoleStorage);d&&(e=new b.mwg.core.utility.ReadOnlyStorage(e));d=a;null==d&&(d=new b.mwg.core.scheduler.TrampolineScheduler);-1==k&&(k=1E5);return new b.mwg.core.CoreGraph(e,k,d,c)};f.prototype.newTask=function(){return new b.mwg.core.task.CoreTask};
return f}();f.Builder=r;r=function(f){function e(){f.apply(this,arguments)}__extends(e,f);e.PREFIX_TO_SAVE_SIZE=2;e.NULL_KEY=new Float64Array([b.mwg.Constants.END_OF_TIME,b.mwg.Constants.END_OF_TIME,b.mwg.Constants.END_OF_TIME]);e.GLOBAL_UNIVERSE_KEY=new Float64Array([b.mwg.Constants.NULL_LONG,b.mwg.Constants.NULL_LONG,b.mwg.Constants.NULL_LONG]);e.GLOBAL_DICTIONARY_KEY=new Float64Array([b.mwg.Constants.NULL_LONG,0,0]);e.GLOBAL_INDEX_KEY=new Float64Array([b.mwg.Constants.NULL_LONG,1,0]);e.INDEX_ATTRIBUTE=
"index";e.DISCONNECTED_ERROR="Please connect your graph, prior to any usage of it";e.SCALE_1=1E3;e.SCALE_2=1E4;e.SCALE_3=1E5;e.SCALE_4=1E6;e.DEAD_NODE_ERROR="This Node has been tagged destroyed, please don't use it anymore!";return e}(b.mwg.Constants);f.CoreConstants=r;r=function(){function f(e,d,a,c){this._worldKeyCalculator=this._nodeKeyCalculator=this._prefix=null;var k=this,m=null,t=null,g=null;if(null!=c)for(var l=0;l<c.length;l++){var h=c[l],q=h.memoryFactory(),C=h.hookFactory();null!=q&&(m=
q);h=h.resolverFactory();null!=h&&(t=h);null!=C&&(g=C)}null==m&&(m=new b.mwg.core.memory.HeapMemoryFactory);null==t&&(t={newResolver:function(c,a){return new b.mwg.core.MWGResolver(c,a,k)}});this._hookFactory=g;this._storage=e;this._memoryFactory=m;this._space=m.newSpace(d,k);this._resolver=t.newResolver(this._storage,this._space);this._scheduler=a;this._taskActions=new java.util.HashMap;b.mwg.core.task.CoreTask.fillDefault(this._taskActions);if(null!=c)for(this._nodeTypes=new java.util.HashMap,l=
0;l<c.length;l++){h=c[l];d=h.nodeTypes();for(e=0;e<d.length;e++)a=d[e],this._nodeTypes.put(this._resolver.stringToHash(a,!1),h.nodeType(a));d=h.taskActionTypes();for(e=0;e<d.length;e++)a=d[e],this._taskActions.put(a,h.taskActionType(a))}else this._nodeTypes=null;this._isConnected=new java.util.concurrent.atomic.AtomicBoolean(!1);this._lock=new java.util.concurrent.atomic.AtomicBoolean(!1);this._plugins=c}f.prototype.fork=function(b){var d=this._worldKeyCalculator.newKey();this._resolver.initWorld(b,
d);return d};f.prototype.newNode=function(e,d){if(!this._isConnected.get())throw Error(b.mwg.core.CoreConstants.DISCONNECTED_ERROR);var a=new b.mwg.core.CoreNode(e,d,this._nodeKeyCalculator.newKey(),this);this._resolver.initNode(a,b.mwg.Constants.NULL_LONG);return a};f.prototype.newTypedNode=function(e,d,a){if(null==a)throw Error("nodeType should not be null");if(!this._isConnected.get())throw Error(b.mwg.core.CoreConstants.DISCONNECTED_ERROR);var c=this._resolver.stringToHash(a,!1),k=this.factoryByCode(c);
null==k?(console.log("WARNING: UnKnow NodeType "+a+", missing plugin configuration in the builder ? Using generic node as a fallback"),e=new b.mwg.core.CoreNode(e,d,this._nodeKeyCalculator.newKey(),this)):e=k(e,d,this._nodeKeyCalculator.newKey(),this);this._resolver.initNode(e,c);return e};f.prototype.cloneNode=function(e){if(null==e)throw Error("origin node should not be null");if(!this._isConnected.get())throw Error(b.mwg.core.CoreConstants.DISCONNECTED_ERROR);e.cacheLock();if(e._dead)throw e.cacheUnlock(),
Error(b.mwg.core.CoreConstants.DEAD_NODE_ERROR+" node id: "+e.id());this._space.mark(e._index_stateChunk);this._space.mark(e._index_superTimeTree);this._space.mark(e._index_timeTree);this._space.mark(e._index_worldOrder);var d=this._space.get(e._index_worldOrder),d=this.factoryByCode(d.extra()),d=null==d?new b.mwg.core.CoreNode(e.world(),e.time(),e.id(),this):d(e.world(),e.time(),e.id(),this);d._index_stateChunk=e._index_stateChunk;d._index_timeTree=e._index_timeTree;d._index_superTimeTree=e._index_superTimeTree;
d._index_worldOrder=e._index_worldOrder;d._world_magic=e._world_magic;d._super_time_magic=e._super_time_magic;d._time_magic=e._time_magic;e.cacheUnlock();return d};f.prototype.factoryByCode=function(e){return null!=this._nodeTypes&&e!=b.mwg.Constants.NULL_LONG?this._nodeTypes.get(e):null};f.prototype.taskAction=function(b){return null!=this._taskActions&&null!=b?this._taskActions.get(b):null};f.prototype.taskHookFactory=function(){return this._hookFactory};f.prototype.lookup=function(e,d,a,c){if(!this._isConnected.get())throw Error(b.mwg.core.CoreConstants.DISCONNECTED_ERROR);
this._resolver.lookup(e,d,a,c)};f.prototype.lookupAll=function(e,d,a,c){if(!this._isConnected.get())throw Error(b.mwg.core.CoreConstants.DISCONNECTED_ERROR);this._resolver.lookupAll(e,d,a,c)};f.prototype.save=function(b){this._space.save(b)};f.prototype.connect=function(e){for(var d=this,a=this;a._lock.compareAndSet(!1,!0););this._isConnected.compareAndSet(!1,!0)?(a._scheduler.start(),a._storage.connect(a,function(c){a._storage.lock(function(c){d._prefix=b.mwg.utility.Base64.decodeToIntWithBounds(c,
0,c.length());c.free();var m=a.newBuffer();b.mwg.utility.KeyHelper.keyToBuffer(m,b.mwg.chunk.ChunkType.GEN_CHUNK,b.mwg.Constants.BEGINNING_OF_TIME,b.mwg.Constants.NULL_LONG,d._prefix);m.write(b.mwg.core.CoreConstants.BUFFER_SEP);b.mwg.utility.KeyHelper.keyToBuffer(m,b.mwg.chunk.ChunkType.GEN_CHUNK,b.mwg.Constants.END_OF_TIME,b.mwg.Constants.NULL_LONG,d._prefix);m.write(b.mwg.core.CoreConstants.BUFFER_SEP);b.mwg.utility.KeyHelper.keyToBuffer(m,b.mwg.chunk.ChunkType.WORLD_ORDER_CHUNK,0,0,b.mwg.Constants.NULL_LONG);
m.write(b.mwg.core.CoreConstants.BUFFER_SEP);b.mwg.utility.KeyHelper.keyToBuffer(m,b.mwg.chunk.ChunkType.STATE_CHUNK,b.mwg.core.CoreConstants.GLOBAL_DICTIONARY_KEY[0],b.mwg.core.CoreConstants.GLOBAL_DICTIONARY_KEY[1],b.mwg.core.CoreConstants.GLOBAL_DICTIONARY_KEY[2]);m.write(b.mwg.core.CoreConstants.BUFFER_SEP);a._storage.get(m,function(c){m.free();if(null!=c){var k=c.iterator(),f=k.next(),h=k.next(),q=k.next(),C=k.next(),k=!0;try{var v=a._space.createAndMark(b.mwg.chunk.ChunkType.WORLD_ORDER_CHUNK,
0,0,b.mwg.Constants.NULL_LONG);0<q.length()&&v.load(q);var w=a._space.createAndMark(b.mwg.chunk.ChunkType.STATE_CHUNK,b.mwg.core.CoreConstants.GLOBAL_DICTIONARY_KEY[0],b.mwg.core.CoreConstants.GLOBAL_DICTIONARY_KEY[1],b.mwg.core.CoreConstants.GLOBAL_DICTIONARY_KEY[2]);0<C.length()&&w.load(C);a._worldKeyCalculator=a._space.createAndMark(b.mwg.chunk.ChunkType.GEN_CHUNK,b.mwg.Constants.END_OF_TIME,b.mwg.Constants.NULL_LONG,d._prefix);0<h.length()&&a._worldKeyCalculator.load(h);a._nodeKeyCalculator=a._space.createAndMark(b.mwg.chunk.ChunkType.GEN_CHUNK,
b.mwg.Constants.BEGINNING_OF_TIME,b.mwg.Constants.NULL_LONG,d._prefix);0<f.length()&&a._nodeKeyCalculator.load(f);a._resolver.init();if(null!=d._plugins)for(f=0;f<d._plugins.length;f++){var n=d._plugins[f].nodeTypes();if(null!=n)for(h=0;h<n.length;h++)a._resolver.stringToHash(n[h],!0)}}catch(r){if(r instanceof Error)console.error(r),k=!1;else throw r;}c.free();a._lock.set(!0);b.mwg.utility.HashHelper.isDefined(e)&&e(k)}else a._lock.set(!0),b.mwg.utility.HashHelper.isDefined(e)&&e(!1)})})})):(a._lock.set(!0),
b.mwg.utility.HashHelper.isDefined(e)&&e(null))};f.prototype.disconnect=function(e){for(;this._lock.compareAndSet(!1,!0););if(this._isConnected.compareAndSet(!0,!1)){var d=this;d._scheduler.stop();this.save(function(a){d._space.freeAll();if(null!=d._storage){var c=d.newBuffer();b.mwg.utility.Base64.encodeIntToBuffer(d._prefix,c);d._storage.unlock(c,function(a){c.free();d._storage.disconnect(function(c){d._lock.set(!0);b.mwg.utility.HashHelper.isDefined(e)&&e(c)})})}else d._lock.set(!0),b.mwg.utility.HashHelper.isDefined(e)&&
e(a)})}else this._lock.set(!0),b.mwg.utility.HashHelper.isDefined(e)&&e(null)};f.prototype.newBuffer=function(){return this._memoryFactory.newBuffer()};f.prototype.newQuery=function(){return new b.mwg.core.CoreQuery(this,this._resolver)};f.prototype.index=function(e,d,a,c){if(null==e)throw Error("indexName should not be null");if(null==d)throw Error("toIndexNode should not be null");if(null==a)throw Error("flatKeyAttributes should not be null");this.getIndexOrCreate(0,0,e,!0,function(k){if(null==
k)throw Error("Index creation failed, cache is probably full !!!");k.index(b.mwg.core.CoreConstants.INDEX_ATTRIBUTE,d,a,function(a){k.free();b.mwg.utility.HashHelper.isDefined(c)&&c(a)})})};f.prototype.unindex=function(e,d,a,c){if(null==e)throw Error("indexName should not be null");if(null==d)throw Error("toIndexNode should not be null");if(null==a)throw Error("flatKeyAttributes should not be null");this.getIndexOrCreate(d.world(),d.time(),e,!1,function(k){null!=k?k.unindex(b.mwg.core.CoreConstants.INDEX_ATTRIBUTE,
d,a,function(a){k.free();b.mwg.utility.HashHelper.isDefined(c)&&c(a)}):b.mwg.utility.HashHelper.isDefined(c)&&c(!1)})};f.prototype.indexes=function(e,d,a){var c=this;this._resolver.lookup(e,d,b.mwg.core.CoreConstants.END_OF_TIME,function(k){if(null==k)a([]);else{var d=k.get(b.mwg.core.CoreConstants.INDEX_ATTRIBUTE);if(null==d)k.free(),a([]);else{var e=Array(d.size()),g=new Int32Array([0]);d.each(function(a,b){e[g[0]]=c._resolver.hashToString(a);g[0]++});k.free();a(e)}}})};f.prototype.find=function(e,
d,a,c,k){if(null==a)throw Error("indexName should not be null");if(null==c)throw Error("query should not be null");this.getIndexOrCreate(e,d,a,!1,function(a){null==a?b.mwg.utility.HashHelper.isDefined(k)&&k([]):a.find(b.mwg.core.CoreConstants.INDEX_ATTRIBUTE,c,function(c){a.free();b.mwg.utility.HashHelper.isDefined(k)&&k(c)})})};f.prototype.findByQuery=function(e,d){if(null==e)throw Error("query should not be null");if(e.world()==b.mwg.Constants.NULL_LONG)throw Error("Please fill world parameter in query before first usage!");
if(e.time()==b.mwg.Constants.NULL_LONG)throw Error("Please fill time parameter in query before first usage!");if(null==e.indexName())throw Error("Please fill indexName parameter in query before first usage!");this.getIndexOrCreate(e.world(),e.time(),e.indexName(),!1,function(a){null==a?b.mwg.utility.HashHelper.isDefined(d)&&d([]):(e.setIndexName(b.mwg.core.CoreConstants.INDEX_ATTRIBUTE),a.findByQuery(e,function(c){a.free();b.mwg.utility.HashHelper.isDefined(d)&&d(c)}))})};f.prototype.findAll=function(e,
d,a,c){if(null==a)throw Error("indexName should not be null");this.getIndexOrCreate(e,d,a,!1,function(a){null==a?b.mwg.utility.HashHelper.isDefined(c)&&c([]):a.findAll(b.mwg.core.CoreConstants.INDEX_ATTRIBUTE,function(d){a.free();b.mwg.utility.HashHelper.isDefined(c)&&c(d)})})};f.prototype.getIndexNode=function(b,d,a,c){if(null==a)throw Error("indexName should not be null");this.getIndexOrCreate(b,d,a,!1,c)};f.prototype.getIndexOrCreate=function(e,d,a,c,k){var m=this,t=this._resolver.stringToHash(a,
c);this._resolver.lookup(e,d,b.mwg.core.CoreConstants.END_OF_TIME,function(a){if(null!=a||c){var f;null==a?(a=new b.mwg.core.CoreNode(e,d,b.mwg.core.CoreConstants.END_OF_TIME,m),m._resolver.initNode(a,b.mwg.core.CoreConstants.NULL_LONG),f=a.getOrCreate(b.mwg.core.CoreConstants.INDEX_ATTRIBUTE,b.mwg.Type.LONG_TO_LONG_MAP)):f=a.get(b.mwg.core.CoreConstants.INDEX_ATTRIBUTE);var h=f.get(t);a.free();h==b.mwg.core.CoreConstants.NULL_LONG?c?(a=m.newNode(e,d),a.getOrCreate(b.mwg.core.CoreConstants.INDEX_ATTRIBUTE,
b.mwg.Type.LONG_TO_LONG_ARRAY_MAP),h=a.id(),f.put(t,h),k(a)):k(null):m._resolver.lookup(e,d,h,k)}else k(null)})};f.prototype.newCounter=function(e){return new b.mwg.core.utility.CoreDeferCounter(e)};f.prototype.newSyncCounter=function(e){return new b.mwg.core.utility.CoreDeferCounterSync(e)};f.prototype.resolver=function(){return this._resolver};f.prototype.scheduler=function(){return this._scheduler};f.prototype.space=function(){return this._space};f.prototype.storage=function(){return this._storage};
f.prototype.freeNodes=function(b){if(null!=b)for(var d=0;d<b.length;d++)null!=b[d]&&b[d].free()};return f}();f.CoreGraph=r;r=function(b){function e(d,a,c,k){b.call(this,d,a,c,k)}__extends(e,b);return e}(b.mwg.plugin.AbstractNode);f.CoreNode=r;r=function(){function f(e,d){this.capacity=1;this._attributes=new Float64Array(this.capacity);this._values=Array(this.capacity);this.size=0;this._time=this._world=b.mwg.Constants.NULL_LONG;this._indexName=null;this._graph=e;this._resolver=d;this._hash=null}f.prototype.parse=
function(e){for(var d=0,a=b.mwg.Constants.NULL_LONG,c=0;d<e.length;)e.charAt(d)==b.mwg.Constants.QUERY_KV_SEP?(-1!=c&&(a=this._resolver.stringToHash(e.substring(c,d).trim(),!1)),c=d+1):e.charAt(d)==b.mwg.Constants.QUERY_SEP&&(a!=b.mwg.Constants.NULL_LONG&&this.internal_add(a,e.substring(c,d).trim()),a=b.mwg.Constants.NULL_LONG,c=d+1),d++;a!=b.mwg.Constants.NULL_LONG&&this.internal_add(a,e.substring(c,d).trim());return this};f.prototype.add=function(b,d){this.internal_add(this._resolver.stringToHash(b.trim(),
!1),d);return this};f.prototype.setWorld=function(b){this._world=b;return this};f.prototype.world=function(){return this._world};f.prototype.setTime=function(b){this._time=b;return this};f.prototype.time=function(){return this._time};f.prototype.setIndexName=function(b){this._indexName=b;return this};f.prototype.indexName=function(){return this._indexName};f.prototype.hash=function(){null==this._hash&&this.compute();return this._hash};f.prototype.attributes=function(){return this._attributes};f.prototype.values=
function(){return this._values};f.prototype.internal_add=function(b,d){if(this.size==this.capacity){var a=2*this.capacity,c=new Float64Array(a),k=Array(a);java.lang.System.arraycopy(this._attributes,0,c,0,this.capacity);java.lang.System.arraycopy(this._values,0,k,0,this.capacity);this._attributes=c;this._values=k;this.capacity=a}this._attributes[this.size]=b;this._values[this.size]=d;this.size++};f.prototype.compute=function(){for(var e=this.size-1;0<=e;e--)for(var d=1;d<=e;d++)if(this._attributes[d-
1]>this._attributes[d]){var a=this._attributes[d-1],c=this._values[d-1];this._attributes[d-1]=this._attributes[d];this._values[d-1]=this._values[d];this._attributes[d]=a;this._values[d]=c}d=this._graph.newBuffer();for(e=0;e<this.size;e++)b.mwg.utility.Base64.encodeLongToBuffer(this._attributes[e],d),null!=this._values[e]&&b.mwg.utility.Base64.encodeStringToBuffer(this._values[e],d);this._hash=b.mwg.utility.HashHelper.hashBytes(d.data());d.free()};return f}();f.CoreQuery=r;r=function(){function f(b,
d,a){this._space=d;this._storage=b;this._graph=a}f.prototype.init=function(){this.dictionary=this._space.getAndMark(b.mwg.chunk.ChunkType.STATE_CHUNK,b.mwg.core.CoreConstants.GLOBAL_DICTIONARY_KEY[0],b.mwg.core.CoreConstants.GLOBAL_DICTIONARY_KEY[1],b.mwg.core.CoreConstants.GLOBAL_DICTIONARY_KEY[2]);this.globalWorldOrderChunk=this._space.getAndMark(b.mwg.chunk.ChunkType.WORLD_ORDER_CHUNK,0,0,b.mwg.Constants.NULL_LONG)};f.prototype.typeName=function(b){return this.hashToString(this.typeCode(b))};f.prototype.typeCode=
function(e){e=this._space.get(e._index_worldOrder);return null==e?b.mwg.Constants.NULL_LONG:e.extra()};f.prototype.initNode=function(e,d){var a=this._space.createAndMark(b.mwg.chunk.ChunkType.STATE_CHUNK,e.world(),e.time(),e.id());this._space.notifyUpdate(a.index());var c=this._space.createAndMark(b.mwg.chunk.ChunkType.TIME_TREE_CHUNK,e.world(),b.mwg.Constants.NULL_LONG,e.id());c.insert(e.time());var k=this._space.createAndMark(b.mwg.chunk.ChunkType.TIME_TREE_CHUNK,e.world(),e.time(),e.id());k.insert(e.time());
var m=this._space.createAndMark(b.mwg.chunk.ChunkType.WORLD_ORDER_CHUNK,0,0,e.id());m.put(e.world(),e.time());d!=b.mwg.Constants.NULL_LONG&&m.setExtra(d);e._index_stateChunk=a.index();e._index_timeTree=k.index();e._index_superTimeTree=c.index();e._index_worldOrder=m.index();e._world_magic=-1;e._super_time_magic=-1;e._time_magic=-1;e.init()};f.prototype.initWorld=function(b,d){this.globalWorldOrderChunk.put(d,b)};f.prototype.freeNode=function(b){b.cacheLock();b._dead||(this._space.unmark(b._index_stateChunk),
this._space.unmark(b._index_timeTree),this._space.unmark(b._index_superTimeTree),this._space.unmark(b._index_worldOrder),b._dead=!0);b.cacheUnlock()};f.prototype.lookup=function(e,d,a,c){var k=this,m=this;try{m._space.getOrLoadAndMark(b.mwg.chunk.ChunkType.WORLD_ORDER_CHUNK,0,0,a,function(t){if(null==t)c(null);else{var g=m.resolve_world(k.globalWorldOrderChunk,t,d,e);m._space.getOrLoadAndMark(b.mwg.chunk.ChunkType.TIME_TREE_CHUNK,g,b.mwg.Constants.NULL_LONG,a,function(k){if(null==k)m._space.unmark(t.index()),
c(null);else{var f=k.previousOrEqual(d);f==b.mwg.Constants.NULL_LONG?(m._space.unmark(k.index()),m._space.unmark(t.index()),c(null)):m._space.getOrLoadAndMark(b.mwg.chunk.ChunkType.TIME_TREE_CHUNK,g,f,a,function(f){if(null==f)m._space.unmark(k.index()),m._space.unmark(t.index()),c(null);else{var h=f.previousOrEqual(d);h==b.mwg.Constants.NULL_LONG?(m._space.unmark(f.index()),m._space.unmark(k.index()),m._space.unmark(t.index()),c(null)):m._space.getOrLoadAndMark(b.mwg.chunk.ChunkType.STATE_CHUNK,g,
h,a,function(q){if(null==q)m._space.unmark(f.index()),m._space.unmark(k.index()),m._space.unmark(t.index()),c(null);else{var w=t.extra(),n=null;w!=b.mwg.Constants.NULL_LONG&&(n=m._graph.factoryByCode(w));w=null==n?new b.mwg.core.CoreNode(e,d,a,m._graph):n(e,d,a,m._graph);w._dead=!1;w._index_stateChunk=q.index();w._index_superTimeTree=k.index();w._index_timeTree=f.index();w._index_worldOrder=t.index();g==e&&h==d?(w._world_magic=-1,w._super_time_magic=-1,w._time_magic=-1):(w._world_magic=t.magic(),
w._super_time_magic=k.magic(),w._time_magic=f.magic());null!=c&&c(w)}})}})}})}})}catch(t){if(t instanceof Error)console.error(t);else throw t;}};f.prototype.lookupAll_end=function(b,d,a,c,k,m,t){if(null!=c||null!=k||null!=m||null!=t)for(var g=0;g<a;g++)null==b[g]&&(null!=c&&null!=c[g]&&this._space.unmark(c[g].index()),null!=k&&null!=k[g]&&this._space.unmark(k[g].index()),null!=k&&null!=k[g]&&this._space.unmark(k[g].index()),null!=m&&null!=m[g]&&this._space.unmark(m[g].index()),null!=t&&null!=t[g]&&
this._space.unmark(t[g].index()));d(b)};f.prototype.lookupAll=function(e,d,a,c){for(var k=this,m=this,t=a.length,g=Array(t),f=0;f<t;f++)g[f]=null;for(var h=[!0],p=new Float64Array(t*b.mwg.Constants.KEY_SIZE),f=0;f<t;f++)h[0]=!1,p[f*b.mwg.Constants.KEY_SIZE]=b.mwg.chunk.ChunkType.WORLD_ORDER_CHUNK,p[f*b.mwg.Constants.KEY_SIZE+1]=0,p[f*b.mwg.Constants.KEY_SIZE+2]=0,p[f*b.mwg.Constants.KEY_SIZE+3]=a[f];h[0]?this.lookupAll_end(g,c,t,null,null,null,null):m._space.getOrLoadAndMarkAll(p,function(f){if(null==
f)k.lookupAll_end(g,c,t,null,null,null,null);else{h[0]=!0;for(var l=0;l<t;l++)null!=f[l]?(h[0]=!1,p[l*b.mwg.Constants.KEY_SIZE]=b.mwg.chunk.ChunkType.TIME_TREE_CHUNK,p[l*b.mwg.Constants.KEY_SIZE+1]=m.resolve_world(k.globalWorldOrderChunk,f[l],d,e),p[l*b.mwg.Constants.KEY_SIZE+2]=b.mwg.Constants.NULL_LONG):p[l*b.mwg.Constants.KEY_SIZE]=-1;h[0]?k.lookupAll_end(g,c,t,f,null,null,null):m._space.getOrLoadAndMarkAll(p,function(l){if(null==l)k.lookupAll_end(g,c,t,f,null,null,null);else{h[0]=!0;for(var q=
0;q<t;q++)if(null!=l[q]){var v=l[q].previousOrEqual(d);v==b.mwg.Constants.NULL_LONG?p[q*b.mwg.Constants.KEY_SIZE]=-1:(h[0]=!1,p[q*b.mwg.Constants.KEY_SIZE+2]=v)}else p[q*b.mwg.Constants.KEY_SIZE]=-1;h[0]?k.lookupAll_end(g,c,t,f,l,null,null):m._space.getOrLoadAndMarkAll(p,function(q){if(null==q)k.lookupAll_end(g,c,t,f,l,null,null);else{h[0]=!0;for(var v=0;v<t;v++)if(null!=q[v]){var n=q[v].previousOrEqual(d);n==b.mwg.Constants.NULL_LONG?p[v*b.mwg.Constants.KEY_SIZE]=-1:(h[0]=!1,p[v*b.mwg.Constants.KEY_SIZE]=
b.mwg.chunk.ChunkType.STATE_CHUNK,p[v*b.mwg.Constants.KEY_SIZE+2]=n)}else p[v*b.mwg.Constants.KEY_SIZE]=-1;h[0]?k.lookupAll_end(g,c,t,f,l,q,null):m._space.getOrLoadAndMarkAll(p,function(h){if(null==h)k.lookupAll_end(g,c,t,f,l,q,null);else{for(var p=0;p<t;p++)if(null!=h[p]){var v=f[p].extra(),n=null;v!=b.mwg.Constants.NULL_LONG&&(n=m._graph.factoryByCode(v));v=null==n?new b.mwg.core.CoreNode(e,d,a[p],m._graph):n(e,d,a[p],m._graph);v._dead=!1;v._index_stateChunk=h[p].index();v._index_superTimeTree=
l[p].index();v._index_timeTree=q[p].index();v._index_worldOrder=f[p].index();h[p].world()==e&&h[p].time()==d?(v._world_magic=-1,v._super_time_magic=-1,v._time_magic=-1):(v._world_magic=f[p].magic(),v._super_time_magic=l[p].magic(),v._time_magic=q[p].magic());g[p]=v}k.lookupAll_end(g,c,t,f,l,q,h)}})}})}})}})};f.prototype.resolve_world=function(e,d,a,c){if(null==e||null==d)return c;for(var k=c,m=b.mwg.Constants.NULL_LONG,t=d.get(k);k!=m;){if(t!=b.mwg.Constants.NULL_LONG&&t<=a)return k;m=k;k=e.get(k);
t=d.get(k)}return c};f.prototype.getOrLoadAndMarkAll=function(e,d,a){for(var c=d.length/f.KEY_SIZE,k=[],m=0,t=Array(c),g=0;g<c;g++)d[g*f.KEY_SIZE]==b.mwg.core.CoreConstants.NULL_KEY[0]&&d[g*f.KEY_SIZE+1]==b.mwg.core.CoreConstants.NULL_KEY[1]&&d[g*f.KEY_SIZE+2]==b.mwg.core.CoreConstants.NULL_KEY[2]?(k[g]=!1,t[g]=null):(t[g]=this._space.getAndMark(e[g],d[g*f.KEY_SIZE],d[g*f.KEY_SIZE+1],d[g*f.KEY_SIZE+2]),null==t[g]?(k[g]=!0,m++):k[g]=!1);if(0==m)a(t);else{for(var l=this._graph.newBuffer(),h=new Int32Array(m),
g=m=0;g<c;g++)k[g]&&(h[m]=g,0!=m&&l.write(b.mwg.core.CoreConstants.BUFFER_SEP),b.mwg.utility.KeyHelper.keyToBuffer(l,e[g],d[g*f.KEY_SIZE],d[g*f.KEY_SIZE+1],d[g*f.KEY_SIZE+2]),m+=1);var p=this;this._storage.get(l,function(c){l.free();for(var k=c.iterator(),m=0;k.hasNext();){var g=h[m],f=k.next();0<f.length()?(t[g]=p._space.createAndMark(e[g],d[g*b.mwg.core.MWGResolver.KEY_SIZE],d[g*b.mwg.core.MWGResolver.KEY_SIZE+1],d[g*b.mwg.core.MWGResolver.KEY_SIZE+2]),t[g].load(f)):t[g]=null;m++}c.free();a(t)})}};
f.prototype.resolveState=function(b){return this.internal_resolveState(b,!0)};f.prototype.internal_resolveState=function(e,d){var a=null;d&&e.cacheLock();if(e._dead)throw d&&e.cacheUnlock(),Error(b.mwg.core.CoreConstants.DEAD_NODE_ERROR+" node id: "+e.id());if(-1==e._world_magic&&-1==e._time_magic&&-1==e._super_time_magic)a=this._space.get(e._index_stateChunk);else{var c=this._space.get(e._index_worldOrder),k=this._space.get(e._index_superTimeTree),m=this._space.get(e._index_timeTree);if(null!=c&&
null!=k&&null!=m)if(e._world_magic==c.magic()&&e._super_time_magic==k.magic()&&e._time_magic==m.magic())a=this._space.get(e._index_stateChunk);else{d&&c.lock();var a=e.time(),t=e.id(),g=e.world(),f=this.resolve_world(this.globalWorldOrderChunk,c,a,g);if(f!=k.world()){var h=this._space.getAndMark(b.mwg.chunk.ChunkType.TIME_TREE_CHUNK,f,b.mwg.core.CoreConstants.NULL_LONG,t);null!=h&&(this._space.unmark(k.index()),k=h)}h=k.previousOrEqual(a);h!=m.time()&&(h=this._space.getAndMark(b.mwg.chunk.ChunkType.TIME_TREE_CHUNK,
f,h,t),null!=h&&(this._space.unmark(m.index()),m=h));h=m.previousOrEqual(a);f==g&&h==a?(e._world_magic=-1,e._time_magic=-1,e._super_time_magic=-1):(e._world_magic=c.magic(),e._time_magic=m.magic(),e._super_time_magic=k.magic(),e._index_superTimeTree=k.index(),e._index_timeTree=m.index());a=this._space.get(e._index_stateChunk);if(f!=a.world()||h!=a.time())k=this._space.getAndMark(b.mwg.chunk.ChunkType.STATE_CHUNK,f,h,t),null!=k&&(this._space.unmark(a.index()),a=k);e._index_stateChunk=a.index();d&&
c.unlock()}}d&&e.cacheUnlock();return a};f.prototype.alignState=function(e){e.cacheLock();if(e._dead)throw e.cacheUnlock(),Error(b.mwg.core.CoreConstants.DEAD_NODE_ERROR+" node id: "+e.id());if(-1==e._world_magic&&-1==e._time_magic&&-1==e._super_time_magic){var d=this._space.get(e._index_stateChunk);if(null!=d)return e.cacheUnlock(),d}d=this._space.get(e._index_worldOrder);if(null==d)return e.cacheUnlock(),null;d.lock();var a=e.world(),c=e.time(),k=e.id(),m=this.internal_resolveState(e,!1);if(-1==
e._world_magic&&-1==e._time_magic&&-1==e._super_time_magic)return d.unlock(),e.cacheUnlock(),m;var t=this._space.createAndMark(b.mwg.chunk.ChunkType.STATE_CHUNK,a,c,k);t.loadFrom(m);e._world_magic=-1;e._super_time_magic=-1;e._time_magic=-1;e._index_stateChunk=t.index();this._space.unmark(m.index());if(m.world()==a||d.get(a)!=b.mwg.core.CoreConstants.NULL_LONG){var m=this._space.get(e._index_superTimeTree),g=this._space.get(e._index_timeTree),f=m.size(),h=2*b.mwg.core.CoreConstants.SCALE_1;f>h&&(h=
2*b.mwg.core.CoreConstants.SCALE_2);f>h&&(h=2*b.mwg.core.CoreConstants.SCALE_3);f>h&&(h=2*b.mwg.core.CoreConstants.SCALE_4);g.insert(c);if(g.size()==h){var p=new Float64Array([-1]);g.range(b.mwg.core.CoreConstants.BEGINNING_OF_TIME,b.mwg.core.CoreConstants.END_OF_TIME,g.size()/2,function(c){p[0]=c});var q=this._space.createAndMark(b.mwg.chunk.ChunkType.TIME_TREE_CHUNK,a,p[0],k);g.range(b.mwg.core.CoreConstants.BEGINNING_OF_TIME,b.mwg.core.CoreConstants.END_OF_TIME,g.size()/2,function(c){q.unsafe_insert(c)});
this._space.notifyUpdate(q.index());m.insert(p[0]);g.clearAt(p[0]);c<p[0]?this._space.unmark(q.index()):(e._index_timeTree=q.index(),this._space.unmark(g.index()))}}else m=this._space.createAndMark(b.mwg.chunk.ChunkType.TIME_TREE_CHUNK,a,b.mwg.core.CoreConstants.NULL_LONG,k),m.insert(c),k=this._space.createAndMark(b.mwg.chunk.ChunkType.TIME_TREE_CHUNK,a,c,k),k.insert(c),d.put(a,c),this._space.unmark(e._index_timeTree),this._space.unmark(e._index_superTimeTree),e._index_timeTree=k.index(),e._index_superTimeTree=
m.index();d.unlock();e.cacheUnlock();return t};f.prototype.newState=function(e,d,a){e.cacheLock();a=new b.mwg.core.CoreNode(d,a,e.id(),e.graph());a._index_worldOrder=e._index_worldOrder;a._index_superTimeTree=e._index_superTimeTree;a._index_timeTree=e._index_timeTree;a._index_stateChunk=e._index_stateChunk;a._time_magic=e._time_magic;a._super_time_magic=e._super_time_magic;a._world_magic=e._world_magic;d=this.alignState(a);e._index_worldOrder=a._index_worldOrder;e._index_superTimeTree=a._index_superTimeTree;
e._index_timeTree=a._index_timeTree;e._index_stateChunk=a._index_stateChunk;e._time_magic=a._time_magic;e._super_time_magic=a._super_time_magic;e._world_magic=a._world_magic;e.cacheUnlock();return d};f.prototype.resolveTimepoints=function(e,d,a,c){var k=this;this._space.getOrLoadAndMark(b.mwg.chunk.ChunkType.WORLD_ORDER_CHUNK,0,0,e.id(),function(m){if(null==m)c(new Float64Array(0));else{for(var t=new Int32Array([b.mwg.core.CoreConstants.MAP_INITIAL_CAPACITY]),g=[new Float64Array(t[0])],f=0,h=e.world();h!=
b.mwg.core.CoreConstants.NULL_LONG;){var p=m.get(h);if(p!=b.mwg.core.CoreConstants.NULL_LONG)if(p<=d){g[0][f]=h;f++;break}else p>a||(g[0][f]=h,f++,f==t[0]&&(p=new Float64Array(2*t[0]),java.lang.System.arraycopy(g[0],0,p,0,t[0]),g[0]=p,t[0]*=2)),h=k.globalWorldOrderChunk.get(h);else h=k.globalWorldOrderChunk.get(h)}k.resolveTimepointsFromWorlds(k.globalWorldOrderChunk,m,e,d,a,g[0],f,c)}})};f.prototype.resolveTimepointsFromWorlds=function(e,d,a,c,k,m,t,g){var f=this;e=new Float64Array(3*t);for(var h=
new Int8Array(t),p=0;p<t;p++)e[3*p]=m[p],e[3*p+1]=b.mwg.core.CoreConstants.NULL_LONG,e[3*p+2]=a.id(),h[p]=b.mwg.chunk.ChunkType.TIME_TREE_CHUNK;this.getOrLoadAndMarkAll(h,e,function(e){if(null==e)f._space.unmark(d.index()),g(new Float64Array(0));else{for(var h=new Int32Array([b.mwg.core.CoreConstants.MAP_INITIAL_CAPACITY]),p=[new Float64Array(h[0])],q=[new Float64Array(h[0])],n=new Int32Array([0]),r=k,D=0;D<t;D++){var u=e[D];if(null!=u){var A=d.get(m[D]),x=r;u.range(A,r,b.mwg.core.CoreConstants.END_OF_TIME,
function(c){if(c!=x&&(p[0][n[0]]=c,q[0][n[0]]=u.world(),n[0]++,h[0]==n[0])){c=new Float64Array(2*h[0]);var b=new Float64Array(2*h[0]);java.lang.System.arraycopy(p[0],0,c,0,h[0]);java.lang.System.arraycopy(q[0],0,b,0,h[0]);p[0]=c;q[0]=b;h[0]*=2}});r=A}f._space.unmark(u.index())}f.resolveTimepointsFromSuperTimes(d,a,c,k,q[0],p[0],n[0],g)}})};f.prototype.resolveTimepointsFromSuperTimes=function(e,d,a,c,k,m,t,g){for(var f=this,h=new Float64Array(3*t),p=new Int8Array(t),q=0;q<t;q++)h[3*q]=k[q],h[3*q+1]=
m[q],h[3*q+2]=d.id(),p[q]=b.mwg.chunk.ChunkType.TIME_TREE_CHUNK;this.getOrLoadAndMarkAll(p,h,function(d){if(null==d)f._space.unmark(e.index()),g(new Float64Array(0));else{for(var m=new Int32Array([b.mwg.core.CoreConstants.MAP_INITIAL_CAPACITY]),h=[new Float64Array(m[0])],p=new Int32Array([0]),q=c,C=0;C<t;C++){var n=d[C];if(null!=n){var r=e.get(k[C]);r<a&&(r=a);var x=q;n.range(r,q,b.mwg.core.CoreConstants.END_OF_TIME,function(c){c!=x&&(h[0][p[0]]=c,p[0]++,m[0]==p[0]&&(c=new Float64Array(2*m[0]),java.lang.System.arraycopy(h[0],
0,c,0,m[0]),h[0]=c,m[0]*=2))});C<t-1&&k[C+1]!=k[C]&&(q=r)}f._space.unmark(n.index())}p[0]!=m[0]&&(d=new Float64Array(p[0]),java.lang.System.arraycopy(h[0],0,d,0,p[0]),h[0]=d);f._space.unmark(e.index());g(h[0])}})};f.prototype.stringToHash=function(e,d){var a=b.mwg.utility.HashHelper.hash(e);if(d){var c=this.dictionary.get(0);null==c&&(c=this.dictionary.getOrCreate(0,b.mwg.Type.STRING_TO_LONG_MAP));c.containsHash(a)||c.put(e,a)}return a};f.prototype.hashToString=function(b){var d=this.dictionary.get(0);
return null!=d?d.getByHash(b):null};f.KEY_SIZE=3;return f}();f.MWGResolver=r;(function(f){(function(e){var d=function(){function b(c){this._back=new Int8Array(c)}b.prototype.get=function(c){return this._back[c]};b.prototype.set=function(c,b){this._back[c]=b};return b}();e.HeapAtomicByteArray=d;d=function(){function a(c,k){this._graph=k;this._maxEntries=c;this._hashEntries=c*a.HASH_LOAD_FACTOR;this._lru=new b.mwg.core.chunk.heap.HeapFixedStack(c,!0);this._dirtiesStack=new b.mwg.core.chunk.heap.HeapFixedStack(c,
!1);this._hashNext=new java.util.concurrent.atomic.AtomicIntegerArray(c);this._hash=new java.util.concurrent.atomic.AtomicIntegerArray(this._hashEntries);for(var d=0;d<c;d++)this._hashNext.set(d,-1);for(d=0;d<this._hashEntries;d++)this._hash.set(d,-1);this._chunkValues=new java.util.concurrent.atomic.AtomicReferenceArray(c);this._chunkWorlds=new java.util.concurrent.atomic.AtomicLongArray(this._maxEntries);this._chunkTimes=new java.util.concurrent.atomic.AtomicLongArray(this._maxEntries);this._chunkIds=
new java.util.concurrent.atomic.AtomicLongArray(this._maxEntries);this._chunkTypes=new b.mwg.core.chunk.heap.HeapAtomicByteArray(this._maxEntries);this._chunkMarks=new java.util.concurrent.atomic.AtomicLongArray(this._maxEntries);for(d=0;d<this._maxEntries;d++)this._chunkMarks.set(d,0)}a.prototype.graph=function(){return this._graph};a.prototype.worldByIndex=function(c){return this._chunkWorlds.get(c)};a.prototype.timeByIndex=function(c){return this._chunkTimes.get(c)};a.prototype.idByIndex=function(c){return this._chunkIds.get(c)};
a.prototype.getAndMark=function(c,a,d,e){for(var g=b.mwg.utility.HashHelper.tripleHash(c,a,d,e,this._hashEntries),g=this._hash.get(g),f=-1;-1!=g;)if(this._chunkTypes.get(g)==c&&this._chunkWorlds.get(g)==a&&this._chunkTimes.get(g)==d&&this._chunkIds.get(g)==e){0<this.mark(g)&&(f=g);break}else g=this._hashNext.get(g);return-1!=f?this._chunkValues.get(f):null};a.prototype.get=function(c){return this._chunkValues.get(c)};a.prototype.getOrLoadAndMark=function(c,a,d,e,g){var f=this,h=this.getAndMark(c,
a,d,e);if(null!=h)g(h);else{var p=this.graph().newBuffer();b.mwg.utility.KeyHelper.keyToBuffer(p,c,a,d,e);this.graph().storage().get(p,function(b){if(null!=b&&0<b.length()){var h=f.createAndMark(c,a,d,e);h.load(b);b.free();g(h)}else p.free(),g(null)})}};a.prototype.getOrLoadAndMarkAll=function(c,a){for(var d=this,e=c.length/b.mwg.Constants.KEY_SIZE,g=Array(e),f=null,h=0,p=null,q=0;q<e;q++){var n=q*b.mwg.Constants.KEY_SIZE;if(-1!=c[n]){var r=this.getAndMark(c[n],c[n+1],c[n+2],c[n+3]);null!=r?g[q]=
r:(null==f&&(f=new Int32Array(e),p=this.graph().newBuffer()),f[q]=h,0!=h&&p.write(b.mwg.Constants.BUFFER_SEP),b.mwg.utility.KeyHelper.keyToBuffer(p,c[n],c[n+1],c[n+2],c[n+3]),h++)}else g[q]=null}if(null!=f){var y=f;this.graph().storage().get(p,function(e){for(var t=e.iterator(),f=0;t.hasNext();){var h=t.next(),l=y[f],p=l*b.mwg.Constants.KEY_SIZE;0<h.length()?(p=d.createAndMark(c[p],c[p+1],c[p+2],c[p+3]),p.load(h),g[l]=p):g[l]=null;f++}e.free();a(g)})}else a(g)};a.prototype.mark=function(c){var b,
a;do b=this._chunkMarks.get(c),a=-1!=b?b+1:b;while(!this._chunkMarks.compareAndSet(c,b,a));0==b&&1==a&&this._lru.dequeue(c);return a};a.prototype.unmark=function(c){var b,a;do b=this._chunkMarks.get(c),0<b?a=b-1:(console.error("WARNING: DOUBLE UNMARK"),a=b);while(!this._chunkMarks.compareAndSet(c,b,a));1==b&&0==a&&this._lru.enqueue(c)};a.prototype.free=function(c){};a.prototype.createAndMark=function(c,a,d,e){for(var g=-1,f=b.mwg.utility.HashHelper.tripleHash(c,a,d,e,this._hashEntries),h=this._hash.get(f);0<=
h;){if(c==this._chunkTypes.get(h)&&a==this._chunkWorlds.get(h)&&d==this._chunkTimes.get(h)&&e==this._chunkIds.get(h)){g=h;break}h=this._hashNext.get(h)}if(-1!=g){var p;do h=this._chunkMarks.get(g),p=-1!=h?h+1:h;while(!this._chunkMarks.compareAndSet(g,h,p));if(p==h+1)return this._chunkValues.get(g)}for(g=-1;-1==g&&(h=this._lru.dequeueTail(),-1!=h);)this._chunkMarks.compareAndSet(h,0,-1)&&(g=h);if(-1==g)throw Error("mwDB crashed, cache is full, please avoid to much retention of nodes or augment cache capacity! available:"+
this.available());p=null;switch(c){case b.mwg.chunk.ChunkType.STATE_CHUNK:p=new b.mwg.core.chunk.heap.HeapStateChunk(this,g);break;case b.mwg.chunk.ChunkType.WORLD_ORDER_CHUNK:p=new b.mwg.core.chunk.heap.HeapWorldOrderChunk(this,g);break;case b.mwg.chunk.ChunkType.TIME_TREE_CHUNK:p=new b.mwg.core.chunk.heap.HeapTimeTreeChunk(this,g);break;case b.mwg.chunk.ChunkType.GEN_CHUNK:p=new b.mwg.core.chunk.heap.HeapGenChunk(this,e,g)}if(null!=this._chunkValues.get(g)){for(var q=this._chunkWorlds.get(g),n=
this._chunkTimes.get(g),r=this._chunkIds.get(g),y=this._chunkTypes.get(g),B=b.mwg.utility.HashHelper.tripleHash(y,q,n,r,this._hashEntries),h=this._hash.get(B),z=-1;0<=h&&(y!=this._chunkTypes.get(h)||q!=this._chunkWorlds.get(h)||n!=this._chunkTimes.get(h)||r!=this._chunkIds.get(h));)z=h,h=this._hashNext.get(h);-1==z?(q=this._hashNext.get(h),this._hash.set(B,q)):-1==h?this._hashNext.set(z,-1):this._hashNext.set(z,this._hashNext.get(h));this._hashNext.set(h,-1)}this._chunkValues.set(g,p);this._chunkMarks.set(g,
1);this._chunkTypes.set(g,c);this._chunkWorlds.set(g,a);this._chunkTimes.set(g,d);this._chunkIds.set(g,e);this._hashNext.set(g,this._hash.get(f));this._hash.set(f,g);return p};a.prototype.notifyUpdate=function(c){this._dirtiesStack.enqueue(c)&&this.mark(c)};a.prototype.save=function(c){for(var a=this._graph.newBuffer(),d=!0;0!=this._dirtiesStack.size();){var e=this._dirtiesStack.dequeueTail(),g=this._chunkValues.get(e);d?d=!1:a.write(b.mwg.Constants.BUFFER_SEP);b.mwg.utility.KeyHelper.keyToBuffer(a,
this._chunkTypes.get(e),this._chunkWorlds.get(e),this._chunkTimes.get(e),this._chunkIds.get(e));a.write(b.mwg.Constants.BUFFER_SEP);try{g.save(a),this.unmark(e)}catch(f){if(f instanceof Error)console.error(f);else throw f;}}this.graph().storage().put(a,function(b){a.free();null!=c&&c(b)})};a.prototype.clear=function(){};a.prototype.freeAll=function(){};a.prototype.available=function(){return this._lru.size()};a.prototype.printMarked=function(){for(var c=0;c<this._chunkValues.length();c++)if(null!=
this._chunkValues.get(c)&&0!=this._chunkMarks.get(c))switch(this._chunkTypes.get(c)){case b.mwg.chunk.ChunkType.STATE_CHUNK:console.log("STATE("+this._chunkWorlds.get(c)+","+this._chunkTimes.get(c)+","+this._chunkIds.get(c)+")->marks->"+this._chunkMarks.get(c));break;case b.mwg.chunk.ChunkType.TIME_TREE_CHUNK:console.log("TIME_TREE("+this._chunkWorlds.get(c)+","+this._chunkTimes.get(c)+","+this._chunkIds.get(c)+")->marks->"+this._chunkMarks.get(c));break;case b.mwg.chunk.ChunkType.WORLD_ORDER_CHUNK:console.log("WORLD_ORDER("+
this._chunkWorlds.get(c)+","+this._chunkTimes.get(c)+","+this._chunkIds.get(c)+")->marks->"+this._chunkMarks.get(c));break;case b.mwg.chunk.ChunkType.GEN_CHUNK:console.log("GENERATOR("+this._chunkWorlds.get(c)+","+this._chunkTimes.get(c)+","+this._chunkIds.get(c)+")->marks->"+this._chunkMarks.get(c))}};a.HASH_LOAD_FACTOR=4;return a}();e.HeapChunkSpace=d;d=function(){function b(c,a){this._capacity=c;this._next=new Int32Array(c);this._prev=new Int32Array(c);this._last=this._first=-1;java.util.Arrays.fill(this._next,
0,c,-1);java.util.Arrays.fill(this._prev,0,c,-1);if(a){for(var d=0;d<c;d++){var e=this._last;this._prev[d]=e;this._last=d;-1==this._first?this._first=d:this._next[e]=d}this._count=c}else this._count=0}b.prototype.enqueue=function(c){if(this._count>=this._capacity||this._first==c||this._last==c||-1!=this._prev[c]||-1!=this._next[c])return!1;var b=this._last;this._prev[c]=b;this._last=c;-1==this._first?this._first=c:this._next[b]=c;this._count++;return!0};b.prototype.dequeueTail=function(){var c=this._first;
if(-1==c)return-1;var b=this._next[c];this._next[c]=-1;this._prev[c]=-1;this._first=b;-1==b?this._last=-1:this._prev[b]=-1;this._count--;return c};b.prototype.dequeue=function(c){var b=this._prev[c],a=this._next[c];if(-1==b&&-1==a)return!1;if(-1==b){c=this._first;if(-1==c)return!1;b=this._next[c];this._next[c]=-1;this._prev[c]=-1;this._first=b;-1==b?this._last=-1:this._prev[b]=-1;--this._count}else if(-1==a){c=this._last;if(-1==c)return!1;b=this._prev[c];this._prev[c]=-1;this._next[c]=-1;this._last=
b;-1==b?this._first=-1:this._next[b]=-1;--this._count}else this._next[b]=a,this._prev[a]=b,this._prev[c]=-1,this._next[c]=-1,this._count--;return!0};b.prototype.free=function(){};b.prototype.size=function(){return this._count};return b}();e.HeapFixedStack=d;d=function(){function a(c,a,d){this._index=d;this._space=c;this._prefix=Long.fromNumber(a).shiftLeft(b.mwg.Constants.LONG_SIZE-b.mwg.Constants.PREFIX_SIZE);this._seed=-1}a.prototype.save=function(c){b.mwg.utility.Base64.encodeLongToBuffer(this._seed,
c);this._dirty=!1};a.prototype.load=function(c){if(null!=c&&0!=c.length()){c=b.mwg.utility.Base64.decodeToLongWithBounds(c,0,c.length());var a=this._seed;this._seed=c;-1==a||a==this._seed||null==this._space||this._dirty||(this._dirty=!0,this._space.notifyUpdate(this._index))}};a.prototype.newKey=function(){if(this._seed==b.mwg.Constants.KEY_PREFIX_MASK)throw Error("Object Index could not be created because it exceeded the capacity of the current prefix. Ask for a new prefix.");-1==this._seed&&(this._seed=
0);this._seed++;this._space&&this._space.notifyUpdate(this._index);var c=this._prefix.add(this._seed).toNumber();if(c>=b.mwg.Constants.NULL_LONG)throw Error("Object Index exceeds the maximum JavaScript number capacity. (2^"+b.mwg.Constants.LONG_SIZE+")");return c};a.prototype.index=function(){return this._index};a.prototype.world=function(){return this._space.worldByIndex(this._index)};a.prototype.time=function(){return this._space.timeByIndex(this._index)};a.prototype.id=function(){return this._space.idByIndex(this._index)};
a.prototype.chunkType=function(){return b.mwg.chunk.ChunkType.GEN_CHUNK};return a}();e.HeapGenChunk=d;d=function(){function a(c){this.capacity=this.mapSize=0;this.hashs=this.nexts=this.values=this.keys=null;this.parent=c}a.prototype.key=function(c){return this.keys[c]};a.prototype.setKey=function(c,b){this.keys[c]=b};a.prototype.value=function(c){return this.values[c]};a.prototype.setValue=function(c,b){this.values[c]=b};a.prototype.next=function(c){return this.nexts[c]};a.prototype.setNext=function(c,
b){this.nexts[c]=b};a.prototype.hash=function(c){return this.hashs[c]};a.prototype.setHash=function(c,b){this.hashs[c]=b};a.prototype.reallocate=function(c){if(c>this.capacity){var a=new Float64Array(c);null!=this.keys&&java.lang.System.arraycopy(this.keys,0,a,0,this.capacity);this.keys=a;a=new Float64Array(c);null!=this.values&&java.lang.System.arraycopy(this.values,0,a,0,this.capacity);this.values=a;var a=new Int32Array(c),d=new Int32Array(2*c);java.util.Arrays.fill(a,0,c,-1);java.util.Arrays.fill(d,
0,2*c,-1);this.hashs=d;this.nexts=a;for(a=0;a<this.mapSize;a++)d=b.mwg.utility.HashHelper.longHash(this.key(a),2*c),this.setNext(a,this.hash(d)),this.setHash(d,a);this.capacity=c}};a.prototype.cloneFor=function(c){c=new b.mwg.core.chunk.heap.HeapLongLongArrayMap(c);c.mapSize=this.mapSize;c.capacity=this.capacity;if(null!=this.keys){var a=new Float64Array(this.capacity);java.lang.System.arraycopy(this.keys,0,a,0,this.capacity);c.keys=a}null!=this.values&&(a=new Float64Array(this.capacity),java.lang.System.arraycopy(this.values,
0,a,0,this.capacity),c.values=a);null!=this.nexts&&(a=new Int32Array(this.capacity),java.lang.System.arraycopy(this.nexts,0,a,0,this.capacity),c.nexts=a);null!=this.hashs&&(a=new Int32Array(2*this.capacity),java.lang.System.arraycopy(this.hashs,0,a,0,2*this.capacity),c.hashs=a);return c};a.prototype.get=function(c){var a=new Float64Array(0);if(null!=this.keys){for(var d=b.mwg.utility.HashHelper.longHash(c,2*this.capacity),e=0,g=0,d=this.hash(d);0<=d;){if(c==this.key(d)){if(g==e){var e=0==e?1:2*e,
f=new Float64Array(e);java.lang.System.arraycopy(a,0,f,0,a.length);a=f}a[g]=this.value(d);g++}d=this.next(d)}g!=e&&(c=new Float64Array(g),java.lang.System.arraycopy(a,0,c,0,g),a=c)}return a};a.prototype.each=function(c){this.unsafe_each(c)};a.prototype.unsafe_each=function(c){for(var b=0;b<this.mapSize;b++)c(this.key(b),this.value(b))};a.prototype.size=function(){return this.mapSize};a.prototype.remove=function(c,a){if(null!=this.keys&&0!=this.mapSize){for(var d=2*this.capacity,e=b.mwg.utility.HashHelper.longHash(c,
d),g=this.hash(e),e=-1;0<=g;){if(c==this.key(g)&&a==this.value(g)){e=g;break}g=this.next(g)}if(-1!=e){var f=b.mwg.utility.HashHelper.longHash(c,d),g=this.hash(f);if(g==e)this.setHash(f,this.next(g));else for(;-1!=g;){var h=this.next(g);if(h==e){this.setNext(g,this.next(h));break}g=h}f=this.mapSize-1;if(f!=e)if(g=this.key(f),this.setKey(e,g),this.setValue(e,this.value(f)),this.setNext(e,this.next(f)),d=b.mwg.utility.HashHelper.longHash(g,d),g=this.hash(d),g==f)this.setHash(d,e);else for(;-1!=g;){h=
this.next(g);if(h==f){this.setNext(g,e);break}g=h}this.mapSize--;this.parent.declareDirty()}}};a.prototype.put=function(c,a){if(null==this.keys)this.reallocate(b.mwg.Constants.MAP_INITIAL_CAPACITY),this.setKey(0,c),this.setValue(0,a),this.setHash(b.mwg.utility.HashHelper.longHash(c,2*this.capacity),0),this.setNext(0,-1),this.mapSize++,this.parent.declareDirty();else{for(var d=b.mwg.utility.HashHelper.longHash(c,2*this.capacity),e=d=this.hash(d),g=-1;0<=e;){if(c==this.key(e)&&a==this.value(e)){g=e;
break}e=this.next(e)}-1==g&&(e=this.mapSize,e==this.capacity&&this.reallocate(2*this.capacity),this.setKey(e,c),this.setValue(e,a),this.setHash(b.mwg.utility.HashHelper.longHash(c,2*this.capacity),e),this.setNext(e,d),this.mapSize++,this.parent.declareDirty())}};return a}();e.HeapLongLongArrayMap=d;d=function(){function a(c){this.capacity=this.mapSize=0;this.hashs=this.nexts=this.values=this.keys=null;this.parent=c}a.prototype.key=function(c){return this.keys[c]};a.prototype.setKey=function(c,a){this.keys[c]=
a};a.prototype.value=function(c){return this.values[c]};a.prototype.setValue=function(c,a){this.values[c]=a};a.prototype.next=function(c){return this.nexts[c]};a.prototype.setNext=function(c,a){this.nexts[c]=a};a.prototype.hash=function(c){return this.hashs[c]};a.prototype.setHash=function(c,a){this.hashs[c]=a};a.prototype.reallocate=function(c){if(c>this.capacity){var a=new Float64Array(c);null!=this.keys&&java.lang.System.arraycopy(this.keys,0,a,0,this.capacity);this.keys=a;a=new Float64Array(c);
null!=this.values&&java.lang.System.arraycopy(this.values,0,a,0,this.capacity);this.values=a;var a=new Int32Array(c),d=new Int32Array(2*c);java.util.Arrays.fill(a,0,c,-1);java.util.Arrays.fill(d,0,2*c,-1);this.hashs=d;this.nexts=a;for(a=0;a<this.mapSize;a++)d=b.mwg.utility.HashHelper.longHash(this.key(a),2*c),this.setNext(a,this.hash(d)),this.setHash(d,a);this.capacity=c}};a.prototype.cloneFor=function(c){c=new b.mwg.core.chunk.heap.HeapLongLongMap(c);c.mapSize=this.mapSize;c.capacity=this.capacity;
if(null!=this.keys){var a=new Float64Array(this.capacity);java.lang.System.arraycopy(this.keys,0,a,0,this.capacity);c.keys=a}null!=this.values&&(a=new Float64Array(this.capacity),java.lang.System.arraycopy(this.values,0,a,0,this.capacity),c.values=a);null!=this.nexts&&(a=new Int32Array(this.capacity),java.lang.System.arraycopy(this.nexts,0,a,0,this.capacity),c.nexts=a);null!=this.hashs&&(a=new Int32Array(2*this.capacity),java.lang.System.arraycopy(this.hashs,0,a,0,2*this.capacity),c.hashs=a);return c};
a.prototype.get=function(c){var a=b.mwg.Constants.NULL_LONG;if(null!=this.keys)for(var d=b.mwg.utility.HashHelper.longHash(c,2*this.capacity),d=this.hash(d);0<=d;){if(c==this.key(d)){a=this.value(d);break}d=this.next(d)}return a};a.prototype.each=function(c){this.unsafe_each(c)};a.prototype.unsafe_each=function(c){for(var a=0;a<this.mapSize;a++)c(this.key(a),this.value(a))};a.prototype.size=function(){return this.mapSize};a.prototype.remove=function(c){if(null!=this.keys&&0!=this.mapSize){for(var a=
2*this.capacity,d=b.mwg.utility.HashHelper.longHash(c,a),e=this.hash(d),d=-1;0<=e;){if(c==this.key(e)){d=e;break}e=this.next(e)}if(-1!=d){c=b.mwg.utility.HashHelper.longHash(c,a);e=this.hash(c);if(e==d)this.setHash(c,this.next(e));else for(;-1!=e;){var g=this.next(e);if(g==d){this.setNext(e,this.next(g));break}e=g}c=this.mapSize-1;if(c!=d)if(e=this.key(c),this.setKey(d,e),this.setValue(d,this.value(c)),this.setNext(d,this.next(c)),a=b.mwg.utility.HashHelper.longHash(e,a),e=this.hash(a),e==c)this.setHash(a,
d);else for(;-1!=e;){g=this.next(e);if(g==c){this.setNext(e,d);break}e=g}this.mapSize--;this.parent.declareDirty()}}};a.prototype.put=function(c,a){if(null==this.keys)this.reallocate(b.mwg.Constants.MAP_INITIAL_CAPACITY),this.setKey(0,c),this.setValue(0,a),this.setHash(b.mwg.utility.HashHelper.longHash(c,2*this.capacity),0),this.setNext(0,-1),this.mapSize++;else{for(var d=b.mwg.utility.HashHelper.longHash(c,2*this.capacity),e=d=this.hash(d),g=-1;0<=e;){if(c==this.key(e)){g=e;break}e=this.next(e)}-1==
g?(e=this.mapSize,e==this.capacity&&this.reallocate(2*this.capacity),this.setKey(e,c),this.setValue(e,a),this.setHash(b.mwg.utility.HashHelper.longHash(c,2*this.capacity),e),this.setNext(e,d),this.mapSize++,this.parent.declareDirty()):this.value(g)!=a&&(this.setValue(g,a),this.parent.declareDirty())}};return a}();e.HeapLongLongMap=d;d=function(){function a(c,a){this.aligned=!0;this.parent=c;null!=a?(this.aligned=!1,this._back=a._back,this._size=a._size):(this._back=null,this._size=0)}a.prototype.allocate=
function(c){c=new Float64Array(c);null!=this._back&&java.lang.System.arraycopy(this._back,0,c,0,this._back.length);this._back=c};a.prototype.size=function(){return this._size};a.prototype.get=function(c){return this._back[c]};a.prototype.unsafe_get=function(c){return this._back[c]};a.prototype.add=function(c){if(!this.aligned){var a=new Float64Array(this._back.length);java.lang.System.arraycopy(this._back,0,a,0,this._back.length);this._back=a;this.aligned=!0}null==this._back?(this._back=new Float64Array(b.mwg.Constants.MAP_INITIAL_CAPACITY),
this._back[0]=c,this._size=1):(this._size==this._back.length&&(a=new Float64Array(2*this._back.length),java.lang.System.arraycopy(this._back,0,a,0,this._size),this._back=a),this._back[this._size]=c,this._size++);this.parent.declareDirty();return this};a.prototype.remove=function(c){if(!this.aligned){var a=new Float64Array(this._back.length);java.lang.System.arraycopy(this._back,0,a,0,this._back.length);this._back=a;this.aligned=!0}for(var a=-1,b=0;b<this._size;b++)if(this._back[b]==c){a=b;break}-1!=
a&&(0==this._size-1?(this._back=null,this._size=0):(c=new Float64Array(this._size-1),java.lang.System.arraycopy(this._back,0,c,0,a),java.lang.System.arraycopy(this._back,a+1,c,a,this._size-a-1),this._back=c,this._size--));return this};a.prototype.clear=function(){this._size=0;this.aligned?null!=this._back&&java.util.Arrays.fill(this._back,0,this._back.length,-1):(this._back=null,this.aligned=!0);return this};a.prototype.toString=function(){var c=new java.lang.StringBuilder;c.append("[");for(var a=
0;a<this._size;a++)0!=a&&c.append(","),c.append(this._back[a]);c.append("]");return c.toString()};return a}();e.HeapRelationship=d;d=function(){function a(c,a){this._space=c;this._index=a;this._type=this._hash=this._next=null;this._capacity=this._size=0;this._dirty=!1}a.prototype.world=function(){return this._space.worldByIndex(this._index)};a.prototype.time=function(){return this._space.timeByIndex(this._index)};a.prototype.id=function(){return this._space.idByIndex(this._index)};a.prototype.chunkType=
function(){return b.mwg.chunk.ChunkType.STATE_CHUNK};a.prototype.index=function(){return this._index};a.prototype.get=function(c){return this.internal_get(c)};a.prototype.internal_find=function(c){if(0!=this._size)if(null==this._hash)for(var a=0;a<this._size;a++){if(this._k[a]==c)return a}else for(a=b.mwg.utility.HashHelper.longHash(c,2*this._capacity),a=this._hash[a];0<=a;){if(c==this._k[a])return a;a=this._next[a]}return-1};a.prototype.internal_get=function(c){if(0==this._size)return null;var a=
this.internal_find(c);if(-1!=a&&(c=this._v[a],null!=c))switch(this._type[a]){case b.mwg.Type.DOUBLE_ARRAY:return a=new Float64Array(c.length),java.lang.System.arraycopy(c,0,a,0,c.length),a;case b.mwg.Type.LONG_ARRAY:return a=new Float64Array(c.length),java.lang.System.arraycopy(c,0,a,0,c.length),a;case b.mwg.Type.INT_ARRAY:return a=new Int32Array(c.length),java.lang.System.arraycopy(c,0,a,0,c.length),a;default:return c}return null};a.prototype.set=function(c,a,d){if(null!=d){if(a==b.mwg.Type.STRING&&
"string"!==typeof d)throw Error("mwDB usage error, set method called with type "+b.mwg.Type.typeName(a)+" while param object is "+d);if(a==b.mwg.Type.BOOL&&"boolean"!==typeof d)throw Error("mwDB usage error, set method called with type "+b.mwg.Type.typeName(a)+" while param object is "+d);if((a==b.mwg.Type.DOUBLE||a==b.mwg.Type.LONG||a==b.mwg.Type.INT)&&"number"!==typeof d)throw Error("mwDB usage error, set method called with type "+b.mwg.Type.typeName(a)+" while param object is "+d);if(a==b.mwg.Type.DOUBLE_ARRAY&&
!(d instanceof Float64Array))throw Error("mwDB usage error, set method called with type "+b.mwg.Type.typeName(a)+" while param object is "+d);if(a==b.mwg.Type.LONG_ARRAY&&!(d instanceof Float64Array))throw Error("mwDB usage error, set method called with type "+b.mwg.Type.typeName(a)+" while param object is "+d);if(a==b.mwg.Type.INT_ARRAY&&!(d instanceof Int32Array))throw Error("mwDB usage error, set method called with type "+b.mwg.Type.typeName(a)+" while param object is "+d);if(a==b.mwg.Type.STRING_TO_LONG_MAP&&
"object"!==typeof d)throw Error("mwDB usage error, set method called with type "+b.mwg.Type.typeName(a)+" while param object is "+d);if(a==b.mwg.Type.LONG_TO_LONG_MAP&&"boolean"!==typeof d)throw Error("mwDB usage error, set method called with type "+b.mwg.Type.typeName(a)+" while param object is "+d);if(a==b.mwg.Type.LONG_TO_LONG_ARRAY_MAP&&"boolean"!==typeof d)throw Error("mwDB usage error, set method called with type "+b.mwg.Type.typeName(a)+" while param object is "+d);}this.internal_set(c,a,d,
!0,!1)};a.prototype.setFromKey=function(c,a,b){this.internal_set(this._space.graph().resolver().stringToHash(c,!0),a,b,!0,!1)};a.prototype.getFromKey=function(c){return this.internal_get(this._space.graph().resolver().stringToHash(c,!1))};a.prototype.getFromKeyWithDefault=function(c,a){var b=this.getFromKey(c);return null==b?a:b};a.prototype.getWithDefault=function(c,a){var b=this.get(c);return null==b?a:b};a.prototype.getType=function(c){if(0==this._size)return-1;if(null==this._hash)for(var a=0;a<
this._capacity;a++){if(this._k[a]==c)return this._type[a]}else for(a=b.mwg.utility.HashHelper.longHash(c,2*this._capacity),a=this._hash[a];0<=a;){if(c==this._k[a])return this._type[a];a=this._next[a]}return-1};a.prototype.getTypeFromKey=function(c){return this.getType(this._space.graph().resolver().stringToHash(c,!1))};a.prototype.getOrCreate=function(c,a){var d=this.internal_find(c);if(-1!=d&&this._type[d]==a)return this._v[d];d=null;switch(a){case b.mwg.Type.RELATION:d=new b.mwg.core.chunk.heap.HeapRelationship(this,
null);break;case b.mwg.Type.STRING_TO_LONG_MAP:d=new b.mwg.core.chunk.heap.HeapStringLongMap(this);break;case b.mwg.Type.LONG_TO_LONG_MAP:d=new b.mwg.core.chunk.heap.HeapLongLongMap(this);break;case b.mwg.Type.LONG_TO_LONG_ARRAY_MAP:d=new b.mwg.core.chunk.heap.HeapLongLongArrayMap(this)}this.internal_set(c,a,d,!0,!1);return d};a.prototype.getOrCreateFromKey=function(c,a){return this.getOrCreate(this._space.graph().resolver().stringToHash(c,!0),a)};a.prototype.declareDirty=function(){null==this._space||
this._dirty||(this._dirty=!0,this._space.notifyUpdate(this._index))};a.prototype.save=function(c){b.mwg.utility.Base64.encodeIntToBuffer(this._size,c);for(var a=0;a<this._size;a++)if(null!=this._v[a]){var d=this._v[a];if(null!=d)switch(c.write(b.mwg.core.CoreConstants.CHUNK_SEP),b.mwg.utility.Base64.encodeLongToBuffer(this._k[a],c),c.write(b.mwg.core.CoreConstants.CHUNK_SUB_SEP),b.mwg.utility.Base64.encodeIntToBuffer(this._type[a],c),c.write(b.mwg.core.CoreConstants.CHUNK_SUB_SEP),this._type[a]){case b.mwg.Type.STRING:b.mwg.utility.Base64.encodeStringToBuffer(d,
c);break;case b.mwg.Type.BOOL:this._v[a]?c.write(b.mwg.core.CoreConstants.BOOL_TRUE):c.write(b.mwg.core.CoreConstants.BOOL_FALSE);break;case b.mwg.Type.LONG:b.mwg.utility.Base64.encodeLongToBuffer(d,c);break;case b.mwg.Type.DOUBLE:b.mwg.utility.Base64.encodeDoubleToBuffer(d,c);break;case b.mwg.Type.INT:b.mwg.utility.Base64.encodeIntToBuffer(d,c);break;case b.mwg.Type.DOUBLE_ARRAY:var e=d;b.mwg.utility.Base64.encodeIntToBuffer(e.length,c);for(d=0;d<e.length;d++)c.write(b.mwg.core.CoreConstants.CHUNK_SUB_SUB_SEP),
b.mwg.utility.Base64.encodeDoubleToBuffer(e[d],c);break;case b.mwg.Type.RELATION:e=d;b.mwg.utility.Base64.encodeIntToBuffer(e.size(),c);for(d=0;d<e.size();d++)c.write(b.mwg.core.CoreConstants.CHUNK_SUB_SUB_SEP),b.mwg.utility.Base64.encodeLongToBuffer(e.unsafe_get(d),c);break;case b.mwg.Type.LONG_ARRAY:e=d;b.mwg.utility.Base64.encodeIntToBuffer(e.length,c);for(d=0;d<e.length;d++)c.write(b.mwg.core.CoreConstants.CHUNK_SUB_SUB_SEP),b.mwg.utility.Base64.encodeLongToBuffer(e[d],c);break;case b.mwg.Type.INT_ARRAY:e=
d;b.mwg.utility.Base64.encodeIntToBuffer(e.length,c);for(d=0;d<e.length;d++)c.write(b.mwg.core.CoreConstants.CHUNK_SUB_SUB_SEP),b.mwg.utility.Base64.encodeIntToBuffer(e[d],c);break;case b.mwg.Type.STRING_TO_LONG_MAP:b.mwg.utility.Base64.encodeLongToBuffer(d.size(),c);d.unsafe_each(function(a,d){c.write(b.mwg.core.CoreConstants.CHUNK_SUB_SUB_SEP);b.mwg.utility.Base64.encodeStringToBuffer(a,c);c.write(b.mwg.core.CoreConstants.CHUNK_SUB_SUB_SUB_SEP);b.mwg.utility.Base64.encodeLongToBuffer(d,c)});break;
case b.mwg.Type.LONG_TO_LONG_MAP:b.mwg.utility.Base64.encodeLongToBuffer(d.size(),c);d.unsafe_each(function(a,d){c.write(b.mwg.core.CoreConstants.CHUNK_SUB_SUB_SEP);b.mwg.utility.Base64.encodeLongToBuffer(a,c);c.write(b.mwg.core.CoreConstants.CHUNK_SUB_SUB_SUB_SEP);b.mwg.utility.Base64.encodeLongToBuffer(d,c)});break;case b.mwg.Type.LONG_TO_LONG_ARRAY_MAP:b.mwg.utility.Base64.encodeLongToBuffer(d.size(),c),d.unsafe_each(function(a,d){c.write(b.mwg.core.CoreConstants.CHUNK_SUB_SUB_SEP);b.mwg.utility.Base64.encodeLongToBuffer(a,
c);c.write(b.mwg.core.CoreConstants.CHUNK_SUB_SUB_SUB_SEP);b.mwg.utility.Base64.encodeLongToBuffer(d,c)})}}this._dirty=!1};a.prototype.each=function(c){for(var a=0;a<this._size;a++)null!=this._v[a]&&c(this._k[a],this._type[a],this._v[a])};a.prototype.loadFrom=function(c){if(null!=c){this._capacity=c._capacity;this._size=c._size;if(null!=c._k){var a=new Float64Array(this._capacity);java.lang.System.arraycopy(c._k,0,a,0,this._capacity);this._k=a}null!=c._type&&(a=new Int8Array(this._capacity),java.lang.System.arraycopy(c._type,
0,a,0,this._capacity),this._type=a);null!=c._next&&(a=new Int32Array(this._capacity),java.lang.System.arraycopy(c._next,0,a,0,this._capacity),this._next=a);null!=c._hash&&(a=new Int32Array(2*this._capacity),java.lang.System.arraycopy(c._hash,0,a,0,2*this._capacity),this._hash=a);if(null!=c._v)for(this._v=Array(this._capacity),a=0;a<this._size;a++)switch(c._type[a]){case b.mwg.Type.LONG_TO_LONG_MAP:null!=c._v[a]&&(this._v[a]=c._v[a].cloneFor(this));break;case b.mwg.Type.LONG_TO_LONG_ARRAY_MAP:null!=
c._v[a]&&(this._v[a]=c._v[a].cloneFor(this));break;case b.mwg.Type.STRING_TO_LONG_MAP:null!=c._v[a]&&(this._v[a]=c._v[a].cloneFor(this));break;case b.mwg.Type.RELATION:null!=c._v[a]&&(this._v[a]=new b.mwg.core.chunk.heap.HeapRelationship(this,c._v[a]));break;default:this._v[a]=c._v[a]}}};a.prototype.internal_set=function(c,a,d,e,g){var f=null;if(null!=d)try{switch(a){case b.mwg.Type.BOOL:f=d;break;case b.mwg.Type.DOUBLE:f=d;break;case b.mwg.Type.LONG:f=d;break;case b.mwg.Type.INT:f=d;break;case b.mwg.Type.STRING:f=
d;break;case b.mwg.Type.RELATION:f=d;break;case b.mwg.Type.DOUBLE_ARRAY:var h=new Float64Array(d.length);java.lang.System.arraycopy(d,0,h,0,d.length);f=h;break;case b.mwg.Type.LONG_ARRAY:var p=new Float64Array(d.length);java.lang.System.arraycopy(d,0,p,0,d.length);f=p;break;case b.mwg.Type.INT_ARRAY:var q=new Int32Array(d.length);java.lang.System.arraycopy(d,0,q,0,d.length);f=q;break;case b.mwg.Type.STRING_TO_LONG_MAP:f=d;break;case b.mwg.Type.LONG_TO_LONG_MAP:f=d;break;case b.mwg.Type.LONG_TO_LONG_ARRAY_MAP:f=
d;break;default:throw Error("Internal Exception, unknown type");}}catch(n){if(n instanceof Error)throw Error("mwDB usage error, set method called with type "+b.mwg.Type.typeName(a)+" while param object is "+d);throw n;}if(null==this._k)null!=f&&(this._capacity=b.mwg.Constants.MAP_INITIAL_CAPACITY,this._k=new Float64Array(this._capacity),this._v=Array(this._capacity),this._type=new Int8Array(this._capacity),this._k[0]=c,this._v[0]=f,this._type[0]=a,this._size=1);else{q=p=d=-1;if(null==this._hash)for(h=
0;h<this._size;h++){if(this._k[h]==c){d=h;break}}else for(q=b.mwg.utility.HashHelper.longHash(c,2*this._capacity),h=this._hash[q];-1!=h;){if(this._k[h]==c){d=h;break}p=h;h=this._next[h]}if(-1!=d){if(e||a!=this._type[d])if(null==f){null!=this._hash&&(-1!=p?this._next[p]=this._next[d]:this._hash[q]=-1);c=this._size-1;if(d==c)this._k[d]=-1,this._v[d]=null,this._type[d]=-1;else if(this._k[d]=this._k[c],this._v[d]=this._v[c],this._type[d]=this._type[c],null!=this._hash)if(this._next[d]=this._next[c],a=
b.mwg.utility.HashHelper.longHash(this._k[d],2*this._capacity),h=this._hash[a],h==c)this._hash[a]=d;else for(;-1!=h;){if(this._next[h]==c){this._next[h]=d;break}h=this._next[h]}this._size--}else this._v[d]=f,this._type[d]!=a&&(this._type[d]=a);g||this.declareDirty()}else if(this._size<this._capacity)this._k[this._size]=c,this._v[this._size]=f,this._type[this._size]=a,null!=this._hash&&(this._next[this._size]=this._hash[q],this._hash[q]=this._size),this._size++,this.declareDirty();else{e=2*this._capacity;
d=new Float64Array(e);java.lang.System.arraycopy(this._k,0,d,0,this._capacity);this._k=d;d=Array(e);java.lang.System.arraycopy(this._v,0,d,0,this._capacity);this._v=d;d=new Int8Array(e);java.lang.System.arraycopy(this._type,0,d,0,this._capacity);this._type=d;this._capacity=e;this._k[this._size]=c;this._v[this._size]=f;this._type[this._size]=a;this._size++;this._hash=new Int32Array(2*this._capacity);java.util.Arrays.fill(this._hash,0,2*this._capacity,-1);this._next=new Int32Array(this._capacity);java.util.Arrays.fill(this._next,
0,this._capacity,-1);for(h=0;h<this._size;h++)c=b.mwg.utility.HashHelper.longHash(this._k[h],2*this._capacity),this._next[h]=this._hash[c],this._hash[c]=h;g||this.declareDirty()}}};a.prototype.allocate=function(c){if(!(c<=this._capacity)){var a=new Float64Array(c);null!=this._k&&java.lang.System.arraycopy(this._k,0,a,0,this._capacity);this._k=a;a=Array(c);null!=this._v&&java.lang.System.arraycopy(this._v,0,a,0,this._capacity);this._v=a;a=new Int8Array(c);null!=this._type&&java.lang.System.arraycopy(this._type,
0,a,0,this._capacity);this._type=a;this._capacity=c;this._hash=new Int32Array(2*this._capacity);java.util.Arrays.fill(this._hash,0,2*this._capacity,-1);this._next=new Int32Array(this._capacity);java.util.Arrays.fill(this._next,0,this._capacity,-1);for(c=0;c<this._size;c++)a=b.mwg.utility.HashHelper.longHash(this._k[c],2*this._capacity),this._next[c]=this._hash[a],this._hash[a]=c}};a.prototype.load=function(c){if(null!=c&&0!=c.length()){for(var a=null==this._k,d=0,e=c.length(),f=-1,l=b.mwg.core.CoreConstants.NULL_LONG,
h=-1,q=!0,n=null,r=null,w=null,y=null,B=null,z=null,D=null,u=-1,A=0,x=b.mwg.core.CoreConstants.NULL_LONG,E=null;d<e;){var F=c.read(d);if(F==b.mwg.core.CoreConstants.CHUNK_SEP)if(q)q=!1,f=b.mwg.utility.Base64.decodeToIntWithBounds(c,0,d),this.allocate(Math.pow(2,Math.ceil(Math.log(f)/Math.log(2)))),f=d+1;else{if(-1!=h){u=null;switch(h){case b.mwg.Type.BOOL:c.read(f)==b.mwg.core.CoreConstants.BOOL_FALSE?u=!1:c.read(f)==b.mwg.core.CoreConstants.BOOL_TRUE&&(u=!0);break;case b.mwg.Type.STRING:u=b.mwg.utility.Base64.decodeToStringWithBounds(c,
f,d);break;case b.mwg.Type.DOUBLE:u=b.mwg.utility.Base64.decodeToDoubleWithBounds(c,f,d);break;case b.mwg.Type.LONG:u=b.mwg.utility.Base64.decodeToLongWithBounds(c,f,d);break;case b.mwg.Type.INT:u=b.mwg.utility.Base64.decodeToIntWithBounds(c,f,d);break;case b.mwg.Type.DOUBLE_ARRAY:null==n?n=new Float64Array(b.mwg.utility.Base64.decodeToIntWithBounds(c,f,d)):n[A]=b.mwg.utility.Base64.decodeToDoubleWithBounds(c,f,d);u=n;break;case b.mwg.Type.LONG_ARRAY:null==r?r=new Float64Array(b.mwg.utility.Base64.decodeToIntWithBounds(c,
f,d)):r[A]=b.mwg.utility.Base64.decodeToLongWithBounds(c,f,d);u=r;break;case b.mwg.Type.INT_ARRAY:null==w?w=new Int32Array(b.mwg.utility.Base64.decodeToIntWithBounds(c,f,d)):w[A]=b.mwg.utility.Base64.decodeToIntWithBounds(c,f,d);u=w;break;case b.mwg.Type.RELATION:null==y?(y=new b.mwg.core.chunk.heap.HeapRelationship(this,null),y.allocate(b.mwg.utility.Base64.decodeToIntWithBounds(c,f,d))):y.add(b.mwg.utility.Base64.decodeToLongWithBounds(c,f,d));u=y;break;case b.mwg.Type.STRING_TO_LONG_MAP:null!=
E&&B.put(E,b.mwg.utility.Base64.decodeToLongWithBounds(c,f,d));u=B;break;case b.mwg.Type.LONG_TO_LONG_MAP:x!=b.mwg.core.CoreConstants.NULL_LONG&&z.put(x,b.mwg.utility.Base64.decodeToLongWithBounds(c,f,d));u=z;break;case b.mwg.Type.LONG_TO_LONG_ARRAY_MAP:x!=b.mwg.core.CoreConstants.NULL_LONG&&D.put(x,b.mwg.utility.Base64.decodeToLongWithBounds(c,f,d)),u=D}null!=u&&this.internal_set(l,h,u,!0,a)}f=d+1;l=b.mwg.core.CoreConstants.NULL_LONG;u=h=-1;A=0;x=b.mwg.core.CoreConstants.NULL_LONG;E=null}else if(F==
b.mwg.core.CoreConstants.CHUNK_SUB_SEP)l==b.mwg.core.CoreConstants.NULL_LONG?(l=b.mwg.utility.Base64.decodeToLongWithBounds(c,f,d),f=d+1):-1==h&&(h=b.mwg.utility.Base64.decodeToIntWithBounds(c,f,d),f=d+1);else if(F==b.mwg.core.CoreConstants.CHUNK_SUB_SUB_SEP){if(-1==u)switch(u=b.mwg.utility.Base64.decodeToLongWithBounds(c,f,d),h){case b.mwg.Type.DOUBLE_ARRAY:n=new Float64Array(u);break;case b.mwg.Type.LONG_ARRAY:r=new Float64Array(u);break;case b.mwg.Type.INT_ARRAY:w=new Int32Array(u);break;case b.mwg.Type.RELATION:y=
new b.mwg.core.chunk.heap.HeapRelationship(this,null);y.allocate(u);break;case b.mwg.Type.STRING_TO_LONG_MAP:B=new b.mwg.core.chunk.heap.HeapStringLongMap(this);B.reallocate(u);break;case b.mwg.Type.LONG_TO_LONG_MAP:z=new b.mwg.core.chunk.heap.HeapLongLongMap(this);z.reallocate(u);break;case b.mwg.Type.LONG_TO_LONG_ARRAY_MAP:D=new b.mwg.core.chunk.heap.HeapLongLongArrayMap(this),D.reallocate(u)}else switch(h){case b.mwg.Type.DOUBLE_ARRAY:n[A]=b.mwg.utility.Base64.decodeToDoubleWithBounds(c,f,d);A++;
break;case b.mwg.Type.RELATION:y.add(b.mwg.utility.Base64.decodeToLongWithBounds(c,f,d));break;case b.mwg.Type.LONG_ARRAY:r[A]=b.mwg.utility.Base64.decodeToLongWithBounds(c,f,d);A++;break;case b.mwg.Type.INT_ARRAY:w[A]=b.mwg.utility.Base64.decodeToIntWithBounds(c,f,d);A++;break;case b.mwg.Type.STRING_TO_LONG_MAP:null!=E&&(B.put(E,b.mwg.utility.Base64.decodeToLongWithBounds(c,f,d)),E=null);break;case b.mwg.Type.LONG_TO_LONG_MAP:x!=b.mwg.core.CoreConstants.NULL_LONG&&(z.put(x,b.mwg.utility.Base64.decodeToLongWithBounds(c,
f,d)),x=b.mwg.core.CoreConstants.NULL_LONG);break;case b.mwg.Type.LONG_TO_LONG_ARRAY_MAP:x!=b.mwg.core.CoreConstants.NULL_LONG&&(D.put(x,b.mwg.utility.Base64.decodeToLongWithBounds(c,f,d)),x=b.mwg.core.CoreConstants.NULL_LONG)}f=d+1}else if(F==b.mwg.core.CoreConstants.CHUNK_SUB_SUB_SUB_SEP){switch(h){case b.mwg.Type.STRING_TO_LONG_MAP:null==E?E=b.mwg.utility.Base64.decodeToStringWithBounds(c,f,d):(B.put(E,b.mwg.utility.Base64.decodeToLongWithBounds(c,f,d)),E=null);break;case b.mwg.Type.LONG_TO_LONG_MAP:x==
b.mwg.core.CoreConstants.NULL_LONG?x=b.mwg.utility.Base64.decodeToLongWithBounds(c,f,d):(z.put(x,b.mwg.utility.Base64.decodeToLongWithBounds(c,f,d)),x=b.mwg.core.CoreConstants.NULL_LONG);break;case b.mwg.Type.LONG_TO_LONG_ARRAY_MAP:x==b.mwg.core.CoreConstants.NULL_LONG?x=b.mwg.utility.Base64.decodeToLongWithBounds(c,f,d):(D.put(x,b.mwg.utility.Base64.decodeToLongWithBounds(c,f,d)),x=b.mwg.core.CoreConstants.NULL_LONG)}f=d+1}d++}if(-1!=h){u=null;switch(h){case b.mwg.Type.BOOL:c.read(f)==b.mwg.core.CoreConstants.BOOL_FALSE?
u=!1:c.read(f)==b.mwg.core.CoreConstants.BOOL_TRUE&&(u=!0);break;case b.mwg.Type.STRING:u=b.mwg.utility.Base64.decodeToStringWithBounds(c,f,d);break;case b.mwg.Type.DOUBLE:u=b.mwg.utility.Base64.decodeToDoubleWithBounds(c,f,d);break;case b.mwg.Type.LONG:u=b.mwg.utility.Base64.decodeToLongWithBounds(c,f,d);break;case b.mwg.Type.INT:u=b.mwg.utility.Base64.decodeToIntWithBounds(c,f,d);break;case b.mwg.Type.DOUBLE_ARRAY:null==n?n=new Float64Array(b.mwg.utility.Base64.decodeToIntWithBounds(c,f,d)):n[A]=
b.mwg.utility.Base64.decodeToDoubleWithBounds(c,f,d);u=n;break;case b.mwg.Type.LONG_ARRAY:null==r?r=new Float64Array(b.mwg.utility.Base64.decodeToIntWithBounds(c,f,d)):r[A]=b.mwg.utility.Base64.decodeToLongWithBounds(c,f,d);u=r;break;case b.mwg.Type.INT_ARRAY:null==w?w=new Int32Array(b.mwg.utility.Base64.decodeToIntWithBounds(c,f,d)):w[A]=b.mwg.utility.Base64.decodeToIntWithBounds(c,f,d);u=w;break;case b.mwg.Type.RELATION:null!=y&&y.add(b.mwg.utility.Base64.decodeToIntWithBounds(c,f,d));u=y;break;
case b.mwg.Type.STRING_TO_LONG_MAP:null!=E&&B.put(E,b.mwg.utility.Base64.decodeToLongWithBounds(c,f,d));u=B;break;case b.mwg.Type.LONG_TO_LONG_MAP:x!=b.mwg.core.CoreConstants.NULL_LONG&&z.put(x,b.mwg.utility.Base64.decodeToLongWithBounds(c,f,d));u=z;break;case b.mwg.Type.LONG_TO_LONG_ARRAY_MAP:x!=b.mwg.core.CoreConstants.NULL_LONG&&D.put(x,b.mwg.utility.Base64.decodeToLongWithBounds(c,f,d)),u=D}null!=u&&this.internal_set(l,h,u,!0,a)}}};return a}();e.HeapStateChunk=d;d=function(){function a(c){this.capacity=
this.mapSize=0;this.hashs=this.nexts=this.values=this.keysH=this.keys=null;this.parent=c}a.prototype.key=function(c){return this.keys[c]};a.prototype.setKey=function(c,a){this.keys[c]=a};a.prototype.keyH=function(c){return this.keysH[c]};a.prototype.setKeyH=function(c,a){this.keysH[c]=a};a.prototype.value=function(c){return this.values[c]};a.prototype.setValue=function(c,a){this.values[c]=a};a.prototype.next=function(c){return this.nexts[c]};a.prototype.setNext=function(c,a){this.nexts[c]=a};a.prototype.hash=
function(c){return this.hashs[c]};a.prototype.setHash=function(c,a){this.hashs[c]=a};a.prototype.reallocate=function(c){if(c>this.capacity){var a=Array(c);null!=this.keys&&java.lang.System.arraycopy(this.keys,0,a,0,this.capacity);this.keys=a;a=new Float64Array(c);null!=this.keysH&&java.lang.System.arraycopy(this.keysH,0,a,0,this.capacity);this.keysH=a;a=new Float64Array(c);null!=this.values&&java.lang.System.arraycopy(this.values,0,a,0,this.capacity);this.values=a;var a=new Int32Array(c),d=new Int32Array(2*
c);java.util.Arrays.fill(a,0,c,-1);java.util.Arrays.fill(d,0,2*c,-1);this.hashs=d;this.nexts=a;for(a=0;a<this.mapSize;a++)d=b.mwg.utility.HashHelper.longHash(this.keyH(a),2*c),this.setNext(a,this.hash(d)),this.setHash(d,a);this.capacity=c}};a.prototype.cloneFor=function(c){c=new b.mwg.core.chunk.heap.HeapStringLongMap(c);c.mapSize=this.mapSize;c.capacity=this.capacity;if(null!=this.keys){var a=Array(this.capacity);java.lang.System.arraycopy(this.keys,0,a,0,this.capacity);c.keys=a}null!=this.keysH&&
(a=new Float64Array(this.capacity),java.lang.System.arraycopy(this.keysH,0,a,0,this.capacity),c.keysH=a);null!=this.values&&(a=new Float64Array(this.capacity),java.lang.System.arraycopy(this.values,0,a,0,this.capacity),c.values=a);null!=this.nexts&&(a=new Int32Array(this.capacity),java.lang.System.arraycopy(this.nexts,0,a,0,this.capacity),c.nexts=a);null!=this.hashs&&(a=new Int32Array(2*this.capacity),java.lang.System.arraycopy(this.hashs,0,a,0,2*this.capacity),c.hashs=a);return c};a.prototype.getValue=
function(c){var a=b.mwg.Constants.NULL_LONG;if(null!=this.keys){c=b.mwg.utility.HashHelper.hash(c);for(var d=b.mwg.utility.HashHelper.longHash(c,2*this.capacity),d=this.hash(d);0<=d;){if(c==this.keyH(d)){a=this.value(d);break}d=this.next(d)}}return a};a.prototype.getByHash=function(c){var a=null;if(null!=this.keys)for(var d=b.mwg.utility.HashHelper.longHash(c,2*this.capacity),d=this.hash(d);0<=d;){if(c==this.keyH(d)){a=this.key(d);break}d=this.next(d)}return a};a.prototype.containsHash=function(c){var a=
!1;if(null!=this.keys)for(var d=b.mwg.utility.HashHelper.longHash(c,2*this.capacity),d=this.hash(d);0<=d;){if(c==this.keyH(d)){a=!0;break}d=this.next(d)}return a};a.prototype.each=function(c){this.unsafe_each(c)};a.prototype.unsafe_each=function(c){for(var a=0;a<this.mapSize;a++)c(this.key(a),this.value(a))};a.prototype.size=function(){return this.mapSize};a.prototype.remove=function(c){if(null!=this.keys&&0!=this.mapSize){for(var a=b.mwg.utility.HashHelper.hash(c),d=2*this.capacity,e=b.mwg.utility.HashHelper.longHash(a,
d),f=this.hash(e),e=-1;0<=f;){if(c==this.key(f)){e=f;break}f=this.next(f)}if(-1!=e){c=b.mwg.utility.HashHelper.longHash(a,d);f=this.hash(c);if(f==e)this.setHash(c,this.next(f));else for(;-1!=f;){a=this.next(f);if(a==e){this.setNext(f,this.next(a));break}f=a}c=this.mapSize-1;if(c!=e)if(f=this.key(c),a=this.keyH(c),this.setKey(e,f),this.setKeyH(e,a),this.setValue(e,this.value(c)),this.setNext(e,this.next(c)),d=b.mwg.utility.HashHelper.longHash(a,d),f=this.hash(d),f==c)this.setHash(d,e);else for(;-1!=
f;){a=this.next(f);if(a==c){this.setNext(f,e);break}f=a}this.mapSize--;this.parent.declareDirty()}}};a.prototype.put=function(c,a){var d=b.mwg.utility.HashHelper.hash(c);if(null==this.keys)this.reallocate(b.mwg.Constants.MAP_INITIAL_CAPACITY),this.setKey(0,c),this.setKeyH(0,d),this.setValue(0,a),this.setHash(b.mwg.utility.HashHelper.longHash(d,2*this.capacity),0),this.setNext(0,-1),this.mapSize++;else{for(var e=b.mwg.utility.HashHelper.longHash(d,2*this.capacity),f=e=this.hash(e),l=-1;0<=f;){if(c==
this.key(f)){l=f;break}f=this.next(f)}-1==l?(f=this.mapSize,f==this.capacity&&this.reallocate(2*this.capacity),this.setKey(f,c),this.setKeyH(f,d),this.setValue(f,a),this.setHash(b.mwg.utility.HashHelper.longHash(d,2*this.capacity),f),this.setNext(f,e),this.mapSize++,this.parent.declareDirty()):this.value(l)!=a&&(this.setValue(l,a),this.parent.declareDirty())}};return a}();e.HeapStringLongMap=d;d=function(){function a(c,a){this._root=-1;this._size=0;this._space=c;this._index=a;this._magic=0;this._dirty=
!1}a.prototype.world=function(){return this._space.worldByIndex(this._index)};a.prototype.time=function(){return this._space.timeByIndex(this._index)};a.prototype.id=function(){return this._space.idByIndex(this._index)};a.prototype.size=function(){return this._size};a.prototype.range=function(c,a,b,d){var e=0;for(a=this.internal_previousOrEqual_index(a);-1!=a&&this.key(a)>=c&&e<b;)d(this.key(a)),e++,a=this.previous(a)};a.prototype.save=function(c){b.mwg.utility.Base64.encodeLongToBuffer(this._size,
c);c.write(b.mwg.core.CoreConstants.CHUNK_SEP);for(var a=!0,d=0;d<this._size;d++)a?a=!1:c.write(b.mwg.core.CoreConstants.CHUNK_SUB_SEP),b.mwg.utility.Base64.encodeLongToBuffer(this._k[d],c);this._dirty=!1};a.prototype.load=function(c){if(null!=c&&0!=c.length()){for(var a=null==this._k,d=!1,e=0,f=0,l=c.length();e<l;){var h=c.read(e);h==b.mwg.core.CoreConstants.CHUNK_SUB_SEP?(d=d||this.internal_insert(b.mwg.utility.Base64.decodeToLongWithBounds(c,f,e)),f=e+1):h==b.mwg.core.CoreConstants.CHUNK_SEP&&
(this.reallocate(b.mwg.utility.Base64.decodeToLongWithBounds(c,f,e)),f=e+1);e++}!(d=d||this.internal_insert(b.mwg.utility.Base64.decodeToLongWithBounds(c,f,e)))||a||this._dirty||(this._dirty=!0,null!=this._space&&this._space.notifyUpdate(this._index))}};a.prototype.index=function(){return this._index};a.prototype.previousOrEqual=function(c){c=this.internal_previousOrEqual_index(c);return-1!=c?this.key(c):b.mwg.core.CoreConstants.NULL_LONG};a.prototype.magic=function(){return this._magic};a.prototype.insert=
function(c){this.internal_insert(c)&&this.internal_set_dirty()};a.prototype.unsafe_insert=function(c){this.internal_insert(c)};a.prototype.chunkType=function(){return b.mwg.chunk.ChunkType.TIME_TREE_CHUNK};a.prototype.clearAt=function(c){var d=this._k;this._k=new Float64Array(this._k.length);this._back_meta=new Int32Array(this._k.length*a.META_SIZE);this._colors=[];this._root=-1;for(var e=this._size,f=this._size=0;f<e;f++)d[f]!=b.mwg.core.CoreConstants.NULL_LONG&&d[f]<c&&this.internal_insert(d[f]);
this.internal_set_dirty()};a.prototype.reallocate=function(c){var b=new Float64Array(c);null!=this._k&&java.lang.System.arraycopy(this._k,0,b,0,this._size);var d=[];if(null!=this._colors){java.lang.System.arraycopy(this._colors,0,d,0,this._size);for(var e=this._size;e<c;e++)d[e]=!1}var f=new Int32Array(c*a.META_SIZE);if(null!=this._back_meta)for(java.lang.System.arraycopy(this._back_meta,0,f,0,this._size*a.META_SIZE),e=this._size*a.META_SIZE;e<c*a.META_SIZE;e++)f[e]=-1;this._back_meta=f;this._k=b;
this._colors=d};a.prototype.key=function(c){return-1==c?-1:this._k[c]};a.prototype.setKey=function(c,a){this._k[c]=a};a.prototype.left=function(c){return-1==c?-1:this._back_meta[c*a.META_SIZE]};a.prototype.setLeft=function(c,b){this._back_meta[c*a.META_SIZE]=b};a.prototype.right=function(c){return-1==c?-1:this._back_meta[c*a.META_SIZE+1]};a.prototype.setRight=function(c,b){this._back_meta[c*a.META_SIZE+1]=b};a.prototype.parent=function(c){return-1==c?-1:this._back_meta[c*a.META_SIZE+2]};a.prototype.setParent=
function(c,b){this._back_meta[c*a.META_SIZE+2]=b};a.prototype.color=function(c){return-1==c?!0:this._colors[c]};a.prototype.setColor=function(c,a){this._colors[c]=a};a.prototype.grandParent=function(c){return-1==c?-1:-1!=this.parent(c)?this.parent(this.parent(c)):-1};a.prototype.sibling=function(c){return-1==this.parent(c)?-1:c==this.left(this.parent(c))?this.right(this.parent(c)):this.left(this.parent(c))};a.prototype.uncle=function(c){return-1!=this.parent(c)?this.sibling(this.parent(c)):-1};a.prototype.previous=
function(c){if(-1!=this.left(c)){for(c=this.left(c);-1!=this.right(c);)c=this.right(c);return c}if(-1!=this.parent(c)){if(c!=this.right(this.parent(c)))for(;-1!=this.parent(c)&&c==this.left(this.parent(c));)c=this.parent(c);return this.parent(c)}return-1};a.prototype.internal_previousOrEqual_index=function(c){var a=this._root;if(-1==a)return a;for(;-1!=a;){if(c==this.key(a))return a;if(c>this.key(a))if(-1!=this.right(a))a=this.right(a);else return a;else if(-1!=this.left(a))a=this.left(a);else{for(c=
this.parent(a);-1!=c&&a==this.left(c);)a=c,c=this.parent(c);return c}}return-1};a.prototype.rotateLeft=function(c){var a=this.right(c);this.replaceNode(c,a);this.setRight(c,this.left(a));-1!=this.left(a)&&this.setParent(this.left(a),c);this.setLeft(a,c);this.setParent(c,a)};a.prototype.rotateRight=function(c){var a=this.left(c);this.replaceNode(c,a);this.setLeft(c,this.right(a));-1!=this.right(a)&&this.setParent(this.right(a),c);this.setRight(a,c);this.setParent(c,a)};a.prototype.replaceNode=function(c,
a){-1==this.parent(c)?this._root=a:c==this.left(this.parent(c))?this.setLeft(this.parent(c),a):this.setRight(this.parent(c),a);-1!=a&&this.setParent(a,this.parent(c))};a.prototype.insertCase1=function(c){-1==this.parent(c)?this.setColor(c,!0):this.insertCase2(c)};a.prototype.insertCase2=function(c){this.color(this.parent(c))||this.insertCase3(c)};a.prototype.insertCase3=function(c){this.color(this.uncle(c))?this.insertCase4(c):(this.setColor(this.parent(c),!0),this.setColor(this.uncle(c),!0),this.setColor(this.grandParent(c),
!1),this.insertCase1(this.grandParent(c)))};a.prototype.insertCase4=function(c){c==this.right(this.parent(c))&&this.parent(c)==this.left(this.grandParent(c))?(this.rotateLeft(this.parent(c)),c=this.left(c)):c==this.left(this.parent(c))&&this.parent(c)==this.right(this.grandParent(c))&&(this.rotateRight(this.parent(c)),c=this.right(c));this.insertCase5(c)};a.prototype.insertCase5=function(c){this.setColor(this.parent(c),!0);this.setColor(this.grandParent(c),!1);c==this.left(this.parent(c))&&this.parent(c)==
this.left(this.grandParent(c))?this.rotateRight(this.grandParent(c)):this.rotateLeft(this.grandParent(c))};a.prototype.internal_insert=function(c){if(null==this._k||this._k.length==this._size){var a=this._size,a=0==a?b.mwg.Constants.MAP_INITIAL_CAPACITY:2*a;this.reallocate(a)}a=this._size;if(0==a)this.setKey(a,c),this.setColor(a,!1),this.setLeft(a,-1),this.setRight(a,-1),this.setParent(a,-1),this._root=a,this._size=1;else{for(var d=this._root;;){if(c==this.key(d))return!1;if(c<this.key(d))if(-1==
this.left(d)){this.setKey(a,c);this.setColor(a,!1);this.setLeft(a,-1);this.setRight(a,-1);this.setParent(a,-1);this.setLeft(d,a);this._size++;break}else d=this.left(d);else if(-1==this.right(d)){this.setKey(a,c);this.setColor(a,!1);this.setLeft(a,-1);this.setRight(a,-1);this.setParent(a,-1);this.setRight(d,a);this._size++;break}else d=this.right(d)}this.setParent(a,d)}this.insertCase1(a);return!0};a.prototype.internal_set_dirty=function(){this._magic+=1;null==this._space||this._dirty||(this._dirty=
!0,this._space.notifyUpdate(this._index))};a.META_SIZE=3;return a}();e.HeapTimeTreeChunk=d;d=function(){function a(c,a){this._index=a;this._space=c;this._magic=this._lock=0;this._extra=b.mwg.core.CoreConstants.NULL_LONG;this._capacity=this._size=0;this._hash=this._next=this._kv=null;this._dirty=!1}a.prototype.world=function(){return this._space.worldByIndex(this._index)};a.prototype.time=function(){return this._space.timeByIndex(this._index)};a.prototype.id=function(){return this._space.idByIndex(this._index)};
a.prototype.extra=function(){return this._extra};a.prototype.setExtra=function(c){this._extra=c};a.prototype.lock=function(){};a.prototype.unlock=function(){};a.prototype.magic=function(){return this._magic};a.prototype.each=function(c){for(var a=0;a<this._size;a++)c(this._kv[2*a],this._kv[2*a+1])};a.prototype.get=function(a){if(0<this._size)for(var d=b.mwg.utility.HashHelper.longHash(a,2*this._capacity),d=this._hash[d];0<=d;){if(a==this._kv[2*d])return this._kv[2*d+1];d=this._next[d]}return b.mwg.core.CoreConstants.NULL_LONG};
a.prototype.put=function(a,b){this.internal_put(a,b,!0)};a.prototype.internal_put=function(a,d,e){if(0<this._capacity){for(var f=b.mwg.utility.HashHelper.longHash(a,2*this._capacity),g=this._hash[f],l=-1;0<=g;){if(a==this._kv[2*g]){l=g;break}g=this._next[g]}-1==l?(this._capacity==this._size&&(this.resize(2*this._capacity),f=b.mwg.utility.HashHelper.longHash(a,2*this._capacity)),this._kv[2*this._size]=a,this._kv[2*this._size+1]=d,this._next[this._size]=this._hash[f],this._hash[f]=this._size,this._size++,
this._magic+=1,e&&!this._dirty&&(this._dirty=!0,null!=this._space&&this._space.notifyUpdate(this._index))):this._kv[2*l+1]!=d&&(this._kv[2*l+1]=d,this._magic+=1,e&&!this._dirty&&(this._dirty=!0,null!=this._space&&this._space.notifyUpdate(this._index)))}else this._capacity=b.mwg.Constants.MAP_INITIAL_CAPACITY,this._next=new Int32Array(this._capacity),java.util.Arrays.fill(this._next,0,this._capacity,-1),this._hash=new Int32Array(2*this._capacity),java.util.Arrays.fill(this._hash,0,2*this._capacity,
-1),this._kv=new Float64Array(2*this._capacity),this._size=1,this._kv[0]=a,this._kv[1]=d,this._hash[b.mwg.utility.HashHelper.longHash(a,2*this._capacity)]=0,e&&!this._dirty&&(this._dirty=!0,null!=this._space&&this._space.notifyUpdate(this._index))};a.prototype.resize=function(a){if(a>this._capacity){if(null==this._kv)this._kv=new Float64Array(2*a),this._hash=new Int32Array(2*a),this._next=new Int32Array(a),this._capacity=a,java.util.Arrays.fill(this._next,0,a,-1),java.util.Arrays.fill(this._hash,
0,2*a,-1);else{var d=new Float64Array(2*a);java.lang.System.arraycopy(this._kv,0,d,0,2*this._size);var e=new Int32Array(a),f=new Int32Array(2*a);java.util.Arrays.fill(e,0,a,-1);java.util.Arrays.fill(f,0,2*a,-1);for(var g=0;g<this._size;g++){var l=b.mwg.utility.HashHelper.longHash(d[2*g],2*a);e[g]=f[l];f[l]=g}this._capacity=a;this._hash=f;this._next=e;this._kv=d}return!0}return!1};a.prototype.load=function(a){if(null!=a&&0!=a.length()){for(var d=null==this._kv,e=0,f=a.length(),g=!1,l=0,h=b.mwg.core.CoreConstants.NULL_LONG;e<
f;)a.read(e)==b.mwg.core.CoreConstants.CHUNK_SEP?(g?this._extra=b.mwg.utility.Base64.decodeToLongWithBounds(a,l,e):(this.resize(b.mwg.utility.Base64.decodeToLongWithBounds(a,0,e)),g=!0),l=e+1):a.read(e)==b.mwg.core.CoreConstants.CHUNK_SUB_SEP?(h!=b.mwg.core.CoreConstants.NULL_LONG&&(l=b.mwg.utility.Base64.decodeToLongWithBounds(a,l,e),this.internal_put(h,l,!d),h=b.mwg.core.CoreConstants.NULL_LONG),l=e+1):a.read(e)==b.mwg.core.CoreConstants.CHUNK_SUB_SUB_SEP&&(h=b.mwg.utility.Base64.decodeToLongWithBounds(a,
l,e),l=e+1),e++;h!=b.mwg.core.CoreConstants.NULL_LONG&&(l=b.mwg.utility.Base64.decodeToLongWithBounds(a,l,e),this.internal_put(h,l,!d))}};a.prototype.index=function(){return this._index};a.prototype.remove=function(a){throw Error("Not implemented yet!!!");};a.prototype.size=function(){return this._size};a.prototype.chunkType=function(){return b.mwg.chunk.ChunkType.WORLD_ORDER_CHUNK};a.prototype.save=function(a){b.mwg.utility.Base64.encodeLongToBuffer(this._size,a);a.write(b.mwg.core.CoreConstants.CHUNK_SEP);
this._extra!=b.mwg.core.CoreConstants.NULL_LONG&&(b.mwg.utility.Base64.encodeLongToBuffer(this._extra,a),a.write(b.mwg.core.CoreConstants.CHUNK_SEP));for(var d=!0,e=0;e<this._size;e++)d||a.write(b.mwg.core.CoreConstants.CHUNK_SUB_SEP),d=!1,b.mwg.utility.Base64.encodeLongToBuffer(this._kv[2*e],a),a.write(b.mwg.core.CoreConstants.CHUNK_SUB_SUB_SEP),b.mwg.utility.Base64.encodeLongToBuffer(this._kv[2*e+1],a);this._dirty=!1};return a}();e.HeapWorldOrderChunk=d})(f.heap||(f.heap={}))})(f.chunk||(f.chunk=
{}));(function(f){var e=function(){function d(){}d.prototype.slice=function(a,c){var b=c-a+1,d=new Int8Array(b);java.lang.System.arraycopy(this.buffer,a,d,0,b);return d};d.prototype.write=function(a){if(null==this.buffer)this.buffer=new Int8Array(b.mwg.core.CoreConstants.MAP_INITIAL_CAPACITY),this.buffer[0]=a,this.writeCursor=1;else if(this.writeCursor==this.buffer.length){var c=new Int8Array(2*this.buffer.length);java.lang.System.arraycopy(this.buffer,0,c,0,this.buffer.length);c[this.writeCursor]=
a;this.writeCursor++;this.buffer=c}else this.buffer[this.writeCursor]=a,this.writeCursor++};d.prototype.getNewSize=function(a,c){for(;a<c;)a*=2;return a};d.prototype.writeAll=function(a){if(null==this.buffer){var c=this.getNewSize(b.mwg.core.CoreConstants.MAP_INITIAL_CAPACITY,a.length);this.buffer=new Int8Array(c);java.lang.System.arraycopy(a,0,this.buffer,0,a.length);this.writeCursor=a.length}else this.writeCursor+a.length>this.buffer.length?(c=this.getNewSize(this.buffer.length,this.buffer.length+
a.length),c=new Int8Array(c),java.lang.System.arraycopy(this.buffer,0,c,0,this.buffer.length),java.lang.System.arraycopy(a,0,c,this.writeCursor,a.length),this.buffer=c):java.lang.System.arraycopy(a,0,this.buffer,this.writeCursor,a.length),this.writeCursor+=a.length};d.prototype.read=function(a){return this.buffer[a]};d.prototype.data=function(){var a=new Int8Array(this.writeCursor);null!=this.buffer&&java.lang.System.arraycopy(this.buffer,0,a,0,this.writeCursor);return a};d.prototype.length=function(){return this.writeCursor};
d.prototype.free=function(){this.buffer=null};d.prototype.iterator=function(){return new b.mwg.utility.DefaultBufferIterator(this)};d.prototype.removeLast=function(){this.writeCursor--};d.prototype.toString=function(){return String.fromCharCode.apply(null,this.data())};return d}();f.HeapBuffer=e;e=function(){function d(){}d.prototype.newSpace=function(a,c){return new b.mwg.core.chunk.heap.HeapChunkSpace(a,c)};d.prototype.newBuffer=function(){return new b.mwg.core.memory.HeapBuffer};return d}();f.HeapMemoryFactory=
e})(f.memory||(f.memory={}));(function(f){var e=function(){function d(){this.last=this.first=null}d.prototype.add=function(a){a=new b.mwg.core.scheduler.JobQueue.JobQueueElem(a,null);null==this.first?this.first=a:this.last._next=a;this.last=a};d.prototype.poll=function(){var a=this.first;this.first=this.first._next;return a._ptr};return d}();f.JobQueue=e;(function(b){var a=function(){return function(a,b){this._ptr=a;this._next=b}}();b.JobQueueElem=a})(e=f.JobQueue||(f.JobQueue={}));e=function(){function b(){}
b.prototype.dispatch=function(a,c){c()};b.prototype.start=function(){};b.prototype.stop=function(){};return b}();f.NoopScheduler=e;e=function(){function d(){this.queue=new b.mwg.core.scheduler.JobQueue;this.wip=new java.util.concurrent.atomic.AtomicInteger(0)}d.prototype.dispatch=function(a,c){this.queue.add(c);if(0==this.wip.getAndIncrement()){do{var b=this.queue.poll();null!=b&&b()}while(0<this.wip.decrementAndGet())}};d.prototype.start=function(){};d.prototype.stop=function(){};return d}();f.TrampolineScheduler=
e})(f.scheduler||(f.scheduler={}));(function(f){var e=function(d){function a(a,b){d.call(this);this._relationName=a;this._variableNameToAdd=b}__extends(a,d);a.prototype.eval=function(a){var d=a.result(),e=a.variable(a.template(this._variableNameToAdd));if(null!=d&&null!=e)for(var f=a.template(this._relationName),d=d.iterator(),g=d.next();null!=g;){if(g instanceof b.mwg.plugin.AbstractNode)for(var l=e.iterator(),h=l.next();null!=h;)h instanceof b.mwg.plugin.AbstractNode&&g.add(f,h),h=l.next();g=d.next()}a.continueTask()};
a.prototype.toString=function(){return"add('"+this._relationName+"'"+b.mwg.Constants.QUERY_SEP+"'"+this._variableNameToAdd+"')"};return a}(b.mwg.plugin.AbstractTaskAction);f.ActionAdd=e;e=function(d){function a(a,b){d.call(this);this._relationName=a;this._variableNameTarget=b}__extends(a,d);a.prototype.eval=function(a){var d=a.result(),e=a.variable(a.template(this._variableNameTarget));if(null!=d&&null!=e)for(var f=a.template(this._relationName),d=d.iterator(),g=d.next();null!=g;){if(g instanceof
b.mwg.plugin.AbstractNode)for(var l=e.iterator(),h=l.next();null!=h;)h instanceof b.mwg.plugin.AbstractNode&&h.add(f,g),h=l.next();g=d.next()}a.continueTask()};a.prototype.toString=function(){return"addTo('"+this._relationName+"'"+b.mwg.Constants.QUERY_SEP+"'"+this._variableNameTarget+"')"};return a}(b.mwg.plugin.AbstractTaskAction);f.ActionAddTo=e;e=function(b){function a(a,e){b.call(this);this._name=a;this._global=e}__extends(a,b);a.prototype.eval=function(a){var b=a.result();this._global?a.addToGlobalVariable(a.template(this._name),
b):a.addToVariable(a.template(this._name),b);a.continueTask()};a.prototype.toString=function(){return this._global?"addToGlobalVar('"+this._name+"')":"addToVar('"+this._name+"')"};return a}(b.mwg.plugin.AbstractTaskAction);f.ActionAddToVar=e;e=function(b){function a(a,e){b.call(this);this._name=a;this._global=e}__extends(a,b);a.prototype.eval=function(a){var b=a.result();this._global?a.setGlobalVariable(a.template(this._name),b):a.setVariable(a.template(this._name),b);a.continueTask()};a.prototype.toString=
function(){return this._global?"asGlobalVar('"+this._name+"')":"asVar('"+this._name+"')"};return a}(b.mwg.plugin.AbstractTaskAction);f.ActionAsVar=e;e=function(b){function a(){b.apply(this,arguments)}__extends(a,b);a.prototype.eval=function(a){a.continueWith(a.newResult())};a.prototype.toString=function(){return"clear()"};return a}(b.mwg.plugin.AbstractTaskAction);f.ActionClear=e;e=function(b){function a(a){b.call(this);this._name=a}__extends(a,b);a.prototype.eval=function(a){var b=a.result();a.defineVariable(a.template(this._name),
b);a.continueTask()};a.prototype.toString=function(){return"defineVar('"+this._name+"')"};return a}(b.mwg.plugin.AbstractTaskAction);f.ActionDefineVar=e;e=function(d){function a(a,b){d.call(this);this._cond=b;this._then=a}__extends(a,d);a.prototype.eval=function(a){var d=this,e=this,f=Array(1);f[0]=function(g){var l=a._result;a._result=g;d._cond(a)?(null!=l&&l.free(),e._then.executeFrom(a,a._result,b.mwg.plugin.SchedulerAffinity.SAME_THREAD,f[0])):(null!=l&&l.free(),a.continueWith(g))};this._then.executeFrom(a,
a._result,b.mwg.plugin.SchedulerAffinity.SAME_THREAD,f[0])};a.prototype.toString=function(){return"doWhile()"};return a}(b.mwg.plugin.AbstractTaskAction);f.ActionDoWhile=e;e=function(d){function a(a){d.call(this);this._subTask=a}__extends(a,d);a.prototype.eval=function(a){var d=this,e=this,f=a.result();if(null==f)a.continueTask();else{var g=f.iterator(),l=a.newResult();l.allocate(f.size());var h=Array(1),p=Array(1);h[0]=function(d){if(null!=d)for(var f=0;f<d.size();f++)l.add(d.get(f));p[0].free();
d=g.next();p[0]=null!=d?a.wrap(d):null;null==d?a.continueWith(l):e._subTask.executeFrom(a,p[0],b.mwg.plugin.SchedulerAffinity.SAME_THREAD,h[0])};f=g.next();p[0]=a.wrap(f);null!=f?a.graph().scheduler().dispatch(b.mwg.plugin.SchedulerAffinity.SAME_THREAD,function(){d._subTask.executeFrom(a,a.wrap(p[0]),b.mwg.plugin.SchedulerAffinity.SAME_THREAD,h[0])}):a.continueWith(l)}};a.prototype.toString=function(){return"foreach()"};return a}(b.mwg.plugin.AbstractTaskAction);f.ActionForeach=e;e=function(d){function a(a){d.call(this);
this._subTask=a}__extends(a,d);a.prototype.eval=function(a){var d=a.result(),e=a.wrap(null),f=d.iterator(),d=d.size();if(-1==d)throw Error("Foreach on non array structure are not supported yet!");e.allocate(d);for(var g=a.graph().newCounter(d),d=f.next(),l=0;null!=d;){var h=l,p=a.wrap(d);this._subTask.executeFrom(a,p,b.mwg.plugin.SchedulerAffinity.ANY_LOCAL_THREAD,function(a){p.free();null!=a&&1==a.size()?e.set(h,a.get(0)):e.set(h,a);g.count()});l++;d=f.next()}g.then(function(){a.continueWith(e)})};
a.prototype.toString=function(){return"foreachPar()"};return a}(b.mwg.plugin.AbstractTaskAction);f.ActionForeachPar=e;e=function(d){function a(a,b){d.call(this);this._indexName=a;this._query=b}__extends(a,d);a.prototype.eval=function(a){var b=a.template(this._indexName),d=a.template(this._query);a.graph().find(a.world(),a.time(),b,d,function(b){a.continueWith(a.wrap(b))})};a.prototype.toString=function(){return"fromIndex('"+this._indexName+"'"+b.mwg.Constants.QUERY_SEP+"'"+this._query+"')"};return a}(b.mwg.plugin.AbstractTaskAction);
f.ActionFromIndex=e;e=function(b){function a(a){b.call(this);this._indexName=a}__extends(a,b);a.prototype.eval=function(a){a.graph().findAll(a.world(),a.time(),this._indexName,function(b){a.continueWith(a.wrap(b))})};a.prototype.toString=function(){return"fromIndexAll('"+this._indexName+"')"};return a}(b.mwg.plugin.AbstractTaskAction);f.ActionFromIndexAll=e;e=function(b){function a(a,e){b.call(this);this._name=a;this._index=e}__extends(a,b);a.prototype.eval=function(a){var b=a.template(this._name),
b=-1!=this._index?a.wrap(a.variable(b).get(this._index)):a.variable(b);null!=b&&(b=b.clone());a.continueWith(b)};a.prototype.toString=function(){return"fromVar('"+this._name+"')"};return a}(b.mwg.plugin.AbstractTaskAction);f.ActionFromVar=e;e=function(d){function a(a){d.call(this);this._name=a}__extends(a,d);a.prototype.eval=function(a){var d=a.newResult(),e=a.template(this._name),f=a.result();if(null!=f){for(var g=f.size(),l=a.graph().newCounter(g),h=0;h<g;h++){var p=f.get(h);if(p instanceof b.mwg.plugin.AbstractNode){var n=
p;n.type(e)==b.mwg.Type.RELATION?n.rel(e,function(a){if(null!=a)for(var c=0;c<a.length;c++)d.add(a[c]);n.free();l.count()}):(p=n.get(e),null!=p&&d.add(p),n.free(),l.count())}else d.add(p),l.count()}l.then(function(){f.clear();a.continueWith(d)})}else a.continueTask()};a.prototype.toString=function(){return"get('"+this._name+"')"};return a}(b.mwg.plugin.AbstractTaskAction);f.ActionGet=e;e=function(d){function a(a,b){d.call(this);this._condition=a;this._action=b}__extends(a,d);a.prototype.eval=function(a){this._condition(a)?
this._action.executeFrom(a,a.result(),b.mwg.plugin.SchedulerAffinity.SAME_THREAD,function(b){a.continueWith(b)}):a.continueTask()};a.prototype.toString=function(){return"ifThen()"};return a}(b.mwg.plugin.AbstractTaskAction);f.ActionIfThen=e;e=function(d){function a(a,b,e){d.call(this);this._condition=a;this._thenSub=b;this._elseSub=e}__extends(a,d);a.prototype.eval=function(a){this._condition(a)?this._thenSub.executeFrom(a,a.result(),b.mwg.plugin.SchedulerAffinity.SAME_THREAD,function(b){a.continueWith(b)}):
this._elseSub.executeFrom(a,a.result(),b.mwg.plugin.SchedulerAffinity.SAME_THREAD,function(b){a.continueWith(b)})};a.prototype.toString=function(){return"ifThen()"};return a}(b.mwg.plugin.AbstractTaskAction);f.ActionIfThenElse=e;e=function(d){function a(a,b,e){d.call(this);this._indexName=a;this._flatKeyAttributes=b;this._isIndexation=e}__extends(a,d);a.prototype.eval=function(a){for(var d=a.result(),e=a.template(this._indexName),f=a.template(this._flatKeyAttributes),g=new b.mwg.core.utility.CoreDeferCounter(d.size()),
l=function(a){if(a)g.count();else throw Error("Error during indexation of node with id "+d.get(0).id());},h=0;h<d.size();h++){var p=d.get(h);p instanceof b.mwg.plugin.AbstractNode?this._isIndexation?a.graph().index(e,p,f,l):a.graph().unindex(e,p,f,l):g.count()}g.then(function(){a.continueTask()})};a.prototype.toString=function(){return this._isIndexation?"indexNode('"+this._indexName+"','"+this._flatKeyAttributes+"')":"unindexNode('"+this._indexName+"','"+this._flatKeyAttributes+"')"};return a}(b.mwg.plugin.AbstractTaskAction);
f.ActionIndexOrUnindexNode=e;e=function(b){function a(a){b.call(this);this._value=a}__extends(a,b);a.prototype.eval=function(a){a.continueWith(a.wrap(this._value).clone())};a.prototype.toString=function(){return"inject()"};return a}(b.mwg.plugin.AbstractTaskAction);f.ActionInject=e;e=function(d){function a(a){d.call(this);this._subTask=a}__extends(a,d);a.prototype.eval=function(a){var d=a.result();this._subTask.executeFrom(a,d,b.mwg.plugin.SchedulerAffinity.SAME_THREAD,function(b){null!=b&&b.free();
a.continueWith(d)})};a.prototype.toString=function(){return"subTask()"};return a}(b.mwg.plugin.AbstractTaskAction);f.ActionIsolate=e;e=function(d){function a(a){d.call(this);this._time=a}__extends(a,d);a.prototype.eval=function(a){for(var d=a.template(this._time),d=java.lang.Long.parseLong(d),e=a.result(),f=new b.mwg.core.utility.CoreDeferCounter(e.size()),g=e.size(),l=0;l<g;l++){var h=e.get(l);if(h instanceof b.mwg.plugin.AbstractNode){var p=h,n=l;p.jump(d,function(a){p.free();e.set(n,a);f.count()})}else f.count()}f.then(function(){a.continueTask()})};
a.prototype.toString=function(){return"jump('"+this._time+"')"};return a}(b.mwg.plugin.AbstractTaskAction);f.ActionJump=e;e=function(d){function a(a,b,e,f){d.call(this);this._indexedRelation=a;this._flatKeyAttributes=b;this._isIndexation=f;this._varNodeToAdd=e}__extends(a,d);a.prototype.eval=function(a){var d=a.result(),e=a.template(this._indexedRelation),f=a.template(this._flatKeyAttributes),g=a.variable(this._varNodeToAdd);if(0==g.size())throw Error("Error while adding a new node in a local index: '"+
this._varNodeToAdd+"' does not contain any element.");for(var l=new b.mwg.core.utility.CoreDeferCounter(d.size()*g.size()),h=function(a){if(a)l.count();else throw Error("Error during indexation of node with id "+d.get(0).id());},p=0;p<d.size();p++)for(var n=d.get(p),q=0;q<g.size();q++){var r=g.get(q);r instanceof b.mwg.plugin.AbstractNode&&n instanceof b.mwg.plugin.AbstractNode?this._isIndexation?n.index(e,r,f,h):n.unindex(e,r,f,h):l.count()}l.then(function(){a.continueTask()})};return a}(b.mwg.plugin.AbstractTaskAction);
f.ActionLocalIndexOrUnindex=e;e=function(b){function a(a){b.call(this);this._id=a}__extends(a,b);a.prototype.eval=function(a){var b=java.lang.Long.parseLong(a.template(this._id));a.graph().lookup(a.world(),a.time(),b,function(b){a.continueWith(a.wrap(b))})};a.prototype.toString=function(){return"lookup('"+this._id+'")'};return a}(b.mwg.plugin.AbstractTaskAction);f.ActionLookup=e;e=function(d){function a(a,b,e){d.call(this);this._subTask=e;this._lower=a;this._upper=b}__extends(a,d);a.prototype.eval=
function(a){var d=b.mwg.core.task.TaskHelper.parseInt(a.template(this._lower)),e=b.mwg.core.task.TaskHelper.parseInt(a.template(this._upper)),f=a.result(),g=this,l=new java.util.concurrent.atomic.AtomicInteger(d);if(0<=e-d){var h=Array(1);h[0]=function(d){var k=l.getAndIncrement();null!=d&&d.free();k>e?a.continueTask():g._subTask.executeFromUsing(a,f,b.mwg.plugin.SchedulerAffinity.SAME_THREAD,function(a){a.defineVariable("i",k)},h[0])};this._subTask.executeFromUsing(a,f,b.mwg.plugin.SchedulerAffinity.SAME_THREAD,
function(a){a.defineVariable("i",l.getAndIncrement())},h[0])}else a.continueTask()};a.prototype.toString=function(){return"loop('"+this._lower+"','"+this._upper+"')"};return a}(b.mwg.plugin.AbstractTaskAction);f.ActionLoop=e;e=function(d){function a(a,b,e){d.call(this);this._subTask=e;this._lower=a;this._upper=b}__extends(a,d);a.prototype.eval=function(a){var d=b.mwg.core.task.TaskHelper.parseInt(a.template(this._lower)),e=b.mwg.core.task.TaskHelper.parseInt(a.template(this._upper)),f=a.result(),
g=a.newResult();if(0<e-d){for(var l=a.graph().newCounter(e-d+1);d<=e;d++){var h=d;this._subTask.executeFromUsing(a,f,b.mwg.plugin.SchedulerAffinity.ANY_LOCAL_THREAD,function(a){a.defineVariable("i",h)},function(a){if(null!=a&&0<a.size())for(var c=0;c<a.size();c++)g.add(a.get(c));l.count()})}l.then(function(){a.continueWith(g)})}else a.continueWith(g)};a.prototype.toString=function(){return"loopPar('"+this._lower+"','"+this._upper+"')"};return a}(b.mwg.plugin.AbstractTaskAction);f.ActionLoopPar=e;
e=function(d){function a(a){d.call(this);this._map=a}__extends(a,d);a.prototype.eval=function(a){for(var d=a.result(),e=a.wrap(null),f=d.size(),g=0;g<f;g++){var l=d.get(g);l instanceof b.mwg.plugin.AbstractNode?e.add(this._map(l)):e.add(l)}a.continueWith(e)};a.prototype.toString=function(){return"map()"};return a}(b.mwg.plugin.AbstractTaskAction);f.ActionMap=e;e=function(d){function a(a){d.call(this);this._expression=a;this._engine=b.mwg.core.task.math.CoreMathExpressionEngine.parse(a)}__extends(a,
d);a.prototype.eval=function(a){for(var d=a.result(),e=a.newResult(),f=d.size(),g=0;g<f;g++){var l=d.get(g),h=new java.util.HashMap;h.put("PI",Math.PI);h.put("TRUE",1);h.put("FALSE",0);l instanceof b.mwg.plugin.AbstractNode?(e.add(this._engine.eval(l,a,h)),l.free()):e.add(this._engine.eval(null,a,h))}d.clear();a.continueWith(e)};a.prototype.toString=function(){return"math('"+this._expression+"')"};return a}(b.mwg.plugin.AbstractTaskAction);f.ActionMath=e;e=function(b){function a(a){b.call(this);this._typeNode=
a}__extends(a,b);a.prototype.eval=function(a){var b;null==this._typeNode?b=a.graph().newNode(a.world(),a.time()):(b=a.template(this._typeNode),b=a.graph().newTypedNode(a.world(),a.time(),b));a.continueWith(a.wrap(b))};a.prototype.toString=function(){return null!=this._typeNode?"newTypedNode('"+this._typeNode+"')":"newNode()"};return a}(b.mwg.plugin.AbstractTaskAction);f.ActionNewNode=e;e=function(d){function a(a,b){d.call(this);this.subAction=null;this._actionName=a;this._flatParams=b}__extends(a,
d);a.prototype.eval=function(a){var d=a.template(this._actionName),e=a.template(this._flatParams),f=a.graph().taskAction(d);if(null==f)throw Error("Unknown task action: "+d);for(var g=b.mwg.core.CoreConstants.MAP_INITIAL_CAPACITY,d=Array(g),l=0,h=0,p=e.length,n=0;h<p;){if(e.charAt(h)==b.mwg.Constants.QUERY_SEP){n=e.substring(n,h);if(0<n.length){if(l>=g){var q=2*g,r=Array(q);java.lang.System.arraycopy(d,0,r,0,g);d=r;g=q}d[l]=n;l++}n=h+1}h++}n=e.substring(n,h);0<n.length&&(l>=g&&(r=Array(2*g),java.lang.System.arraycopy(d,
0,r,0,g),d=r),d[l]=n,l++);l<d.length&&(e=Array(l),java.lang.System.arraycopy(d,0,e,0,l),d=e);this.subAction=f(d);null!=this.subAction?this.subAction.eval(a):a.continueTask()};a.prototype.toString=function(){return this._actionName+"("+this._flatParams+")"};return a}(b.mwg.plugin.AbstractTaskAction);f.ActionPlugin=e;e=function(b){function a(a){b.call(this);this._name=a}__extends(a,b);a.prototype.eval=function(a){console.log(a.template(this._name));a.continueTask()};a.prototype.toString=function(){return"print('"+
this._name+"')"};return a}(b.mwg.plugin.AbstractTaskAction);f.ActionPrint=e;e=function(d){function a(a){d.call(this);this._filter=a}__extends(a,d);a.prototype.eval=function(a){for(var d=this,e=a.result(),f=a.newResult(),g=0;g<e.size();g++)if(e.get(g)instanceof b.mwg.plugin.AbstractNode){var l=e.get(g);a.graph().resolver().resolveState(l).each(function(b,e,m){if(-1==d._filter||e==d._filter)b=a.graph().resolver().hashToString(b),null!=b&&f.add(b)});l.free()}e.clear();a.continueWith(f)};return a}(b.mwg.plugin.AbstractTaskAction);
f.ActionProperties=e;e=function(d){function a(a,b){d.call(this);this._relationName=a;this._variableNameToRemove=b}__extends(a,d);a.prototype.eval=function(a){var d=a.result(),e=a.variable(a.template(this._variableNameToRemove));if(null!=d&&null!=e)for(var f=a.template(this._relationName),d=d.iterator(),g=d.next();null!=g;){if(g instanceof b.mwg.plugin.AbstractNode)for(var l=e.iterator(),h=l.next();null!=h;)h instanceof b.mwg.plugin.AbstractNode&&g.remove(f,h),h=l.next();g=d.next()}a.continueTask()};
a.prototype.toString=function(){return"remove('"+this._relationName+"'"+b.mwg.Constants.QUERY_SEP+"'"+this._variableNameToRemove+"')"};return a}(b.mwg.plugin.AbstractTaskAction);f.ActionRemove=e;e=function(d){function a(a){d.call(this);this._propertyName=a}__extends(a,d);a.prototype.eval=function(a){var d=a.result();if(null!=d)for(var e=a.template(this._propertyName),f=0;f<d.size();f++){var g=d.get(f);g instanceof b.mwg.plugin.AbstractNode&&g.removeProperty(e)}a.continueTask()};a.prototype.toString=
function(){return"removeProperty('"+this._propertyName+"')"};return a}(b.mwg.plugin.AbstractTaskAction);f.ActionRemoveProperty=e;e=function(b){function a(){b.apply(this,arguments)}__extends(a,b);a.prototype.eval=function(a){a.graph().save(function(b){a.continueTask()})};a.prototype.toString=function(){return"save()"};return a}(b.mwg.plugin.AbstractTaskAction);f.ActionSave=e;e=function(d){function a(a){d.call(this);this._filter=a}__extends(a,d);a.prototype.eval=function(a){for(var d=a.result(),e=a.newResult(),
f=d.size(),g=0;g<f;g++){var l=d.get(g);l instanceof b.mwg.plugin.AbstractNode?this._filter(l)?e.add(l):l.free():e.add(l)}d.clear();a.continueWith(e)};a.prototype.toString=function(){return"select()"};return a}(b.mwg.plugin.AbstractTaskAction);f.ActionSelect=e;e=function(d){function a(a){d.call(this);this._filter=a}__extends(a,d);a.prototype.eval=function(a){for(var d=a.result(),e=a.wrap(null),d=d.iterator(),f=d.next();null!=f;)this._filter(f,a)&&(f instanceof b.mwg.plugin.AbstractNode?e.add(f.graph().cloneNode(f)):
e.add(f)),f=d.next();a.continueWith(e)};a.prototype.toString=function(){return"selectObject()"};return a}(b.mwg.plugin.AbstractTaskAction);f.ActionSelectObject=e;e=function(d){function a(a,b,e){d.call(this);this._relationName=a;this._variableNameToSet=e;this._propertyType=b}__extends(a,d);a.prototype.eval=function(a){var d=a.result(),e=a.template(this._relationName);if(null!=d){var f;f=a.template(this._variableNameToSet);switch(this._propertyType){case b.mwg.Type.BOOL:f=this.parseBoolean(f.toString());
break;case b.mwg.Type.INT:f=b.mwg.core.task.TaskHelper.parseInt(f.toString());break;case b.mwg.Type.DOUBLE:f=parseFloat(f.toString());break;case b.mwg.Type.LONG:f=java.lang.Long.parseLong(f.toString());break}for(var g=0;g<d.size();g++){var l=d.get(g);l instanceof b.mwg.plugin.AbstractNode&&l.setProperty(e,this._propertyType,f)}}a.continueTask()};a.prototype.toString=function(){return"setProperty('"+this._relationName+"'"+b.mwg.Constants.QUERY_SEP+"'"+this._propertyType+"'"+b.mwg.Constants.QUERY_SEP+
"'"+this._variableNameToSet+"')"};a.prototype.parseBoolean=function(a){a=a.toLowerCase();return"true"===a||"1"===a};return a}(b.mwg.plugin.AbstractTaskAction);f.ActionSetProperty=e;e=function(b){function a(a){b.call(this);this._splitPattern=a}__extends(a,b);a.prototype.eval=function(a){for(var b=a.template(this._splitPattern),d=a.result(),e=a.wrap(null),f=0;f<d.size();f++){var l=d.get(0);if(l instanceof String)if(l=l.split(b),1==d.size())for(var h=0;h<l.length;h++)e.add(l[h]);else e.add(l)}a.continueWith(e)};
a.prototype.toString=function(){return"split('"+this._splitPattern+"')"};return a}(b.mwg.plugin.AbstractTaskAction);f.ActionSplit=e;e=function(d){function a(a){d.call(this);this._subTask=a}__extends(a,d);a.prototype.eval=function(a){var d=a.result();this._subTask.executeFrom(a,d,b.mwg.plugin.SchedulerAffinity.SAME_THREAD,function(b){a.continueWith(b)})};a.prototype.toString=function(){return"subTask()"};return a}(b.mwg.plugin.AbstractTaskAction);f.ActionSubTask=e;e=function(d){function a(a){d.call(this);
this._subTasks=a}__extends(a,d);a.prototype.eval=function(a){var d=this,e=a.result(),f=new java.util.concurrent.atomic.AtomicInteger(0),g=this._subTasks.length,l=a.newResult(),h=Array(1);h[0]=function(p){var n=f.getAndIncrement();if(null!=p)for(var q=0;q<p.size();q++){var r=p.get(q);null!=r&&l.add(r)}n<g?d._subTasks[n].executeFrom(a,e,b.mwg.plugin.SchedulerAffinity.SAME_THREAD,h[0]):a.continueWith(l)};var p=f.getAndIncrement();p<g?this._subTasks[p].executeFrom(a,e,b.mwg.plugin.SchedulerAffinity.SAME_THREAD,
h[0]):a.continueWith(l)};a.prototype.toString=function(){return"subTasks()"};return a}(b.mwg.plugin.AbstractTaskAction);f.ActionSubTasks=e;e=function(d){function a(a){d.call(this);this._subTasks=a}__extends(a,d);a.prototype.eval=function(a){var d=a.result(),e=a.newResult(),f=this._subTasks.length;e.allocate(f);for(var g=a.graph().newCounter(f),l=0;l<f;l++){var h=l;this._subTasks[l].executeFrom(a,d,b.mwg.plugin.SchedulerAffinity.ANY_LOCAL_THREAD,function(a){e.set(h,a);g.count()})}g.then(function(){a.continueWith(e)})};
a.prototype.toString=function(){return"subTasksPar()"};return a}(b.mwg.plugin.AbstractTaskAction);f.ActionSubTasksPar=e;e=function(b){function a(a){b.call(this);this._varName=a}__extends(a,b);a.prototype.eval=function(a){var b=a.template(this._varName);a.setTime(java.lang.Long.parseLong(b));a.continueTask()};a.prototype.toString=function(){return"setTime('"+this._varName+"')"};return a}(b.mwg.plugin.AbstractTaskAction);f.ActionTime=e;e=function(d){function a(a){d.call(this);this._name=a}__extends(a,
d);a.prototype.eval=function(a){var d=a.wrap(null),e=a.template(this._name),f=a.result();if(null!=f){for(var g=f.size(),l=a.graph().newCounter(g),h=0;h<g;h++){var p=f.get(h);if(p instanceof b.mwg.plugin.AbstractNode){var n=p;n.rel(e,function(a){if(null!=a)for(var b=0;b<a.length;b++)d.add(a[b]);n.free();l.count()})}else d.add(p),l.count()}l.then(function(){f.clear();a.continueWith(d)})}else a.continueTask()};a.prototype.toString=function(){return"traverse('"+this._name+"')"};return a}(b.mwg.plugin.AbstractTaskAction);
f.ActionTraverse=e;e=function(d){function a(a,b){d.call(this);this._query=b;this._indexName=a}__extends(a,d);a.prototype.eval=function(a){var d=a.wrap(null),e=a.template(this._indexName),f=a.template(this._query),g=a.result();if(null!=g){for(var l=g.size(),h=a.graph().newCounter(l),p=0;p<l;p++){var n=g.get(p);if(n instanceof b.mwg.plugin.AbstractNode){var q=n;q.find(e,f,function(a){if(null!=a)for(var b=0;b<a.length;b++)null!=a[b]&&d.add(a[b]);q.free();h.count()})}else d.add(n),h.count()}h.then(function(){g.clear();
a.continueWith(d)})}else a.continueTask()};a.prototype.toString=function(){return"traverseIndex('"+this._indexName+b.mwg.core.CoreConstants.QUERY_SEP+this._query+"')"};return a}(b.mwg.plugin.AbstractTaskAction);f.ActionTraverseIndex=e;e=function(d){function a(a){d.call(this);this._indexName=a}__extends(a,d);a.prototype.eval=function(a){var d=a.wrap(null),e=a.template(this._indexName),f=a.result();if(null!=f){for(var g=f.size(),l=a.graph().newCounter(g),h=0;h<g;h++){var p=f.get(h);if(p instanceof b.mwg.plugin.AbstractNode){var n=
p;n.findAll(e,function(a){if(null!=a)for(var b=0;b<a.length;b++)null!=a[b]&&d.add(a[b]);n.free();l.count()})}else d.add(p),l.count()}l.then(function(){f.clear();a.continueWith(d)})}else a.continueTask()};a.prototype.toString=function(){return"traverseIndexAll('"+this._indexName+"')"};return a}(b.mwg.plugin.AbstractTaskAction);f.ActionTraverseIndexAll=e;e=function(d){function a(a){d.call(this);this._name=a}__extends(a,d);a.prototype.eval=function(a){var d=a.template(this._name),e=a.result();if(null!=
e){for(var f=a.newResult(),g=e.size(),l=a.graph().newCounter(g),h=0;h<g;h++){var p=e.get(h);p instanceof b.mwg.plugin.AbstractNode?p.type(d)==b.mwg.Type.RELATION?p.rel(d,function(a){if(null!=a)for(var b=0;b<a.length;b++)f.add(a[b]);l.count()}):(f.add(p.graph().cloneNode(p)),l.count()):(f.add(p),l.count())}l.then(function(){a.continueWith(f)})}else a.continueTask()};a.prototype.toString=function(){return"traverseOrKeep('"+this._name+"')"};return a}(b.mwg.plugin.AbstractTaskAction);f.ActionTraverseOrKeep=
e;e=function(d){function a(a,b){d.call(this);this._cond=a;this._then=b}__extends(a,d);a.prototype.eval=function(a){var d=this,e=this,f=Array(1);f[0]=function(g){var l=a._result;a._result=g;d._cond(a)?(null!=l&&l.free(),e._then.executeFrom(a,a._result,b.mwg.plugin.SchedulerAffinity.SAME_THREAD,f[0])):(null!=l&&l.free(),a.continueWith(g))};this._cond(a)?this._then.executeFrom(a,a._result,b.mwg.plugin.SchedulerAffinity.SAME_THREAD,f[0]):a.continueTask()};a.prototype.toString=function(){return"whileDo()"};
return a}(b.mwg.plugin.AbstractTaskAction);f.ActionWhileDo=e;e=function(d){function a(a,b){d.call(this);this._patternTemplate=b;this._name=a}__extends(a,d);a.prototype.toString=function(){return"with('"+this._name+"'"+b.mwg.Constants.QUERY_SEP+"'"+this._patternTemplate+"')"};a.prototype.eval=function(a){for(var d=new RegExp(a.template(this._patternTemplate)),e=a.result(),f=a.newResult(),g=e.size(),l=0;l<g;l++){var h=e.get(l);if(h instanceof b.mwg.plugin.AbstractNode){var p=h.get(this._name);null!=
p&&d.test(p.toString())&&f.add(h.graph().cloneNode(h))}else f.add(h)}a.continueWith(f)};return a}(b.mwg.plugin.AbstractTaskAction);f.ActionWith=e;e=function(d){function a(a,b){d.call(this);this._patternTemplate=b;this._name=a}__extends(a,d);a.prototype.toString=function(){return"without('"+this._name+"'"+b.mwg.Constants.QUERY_SEP+"'"+this._patternTemplate+"')"};a.prototype.eval=function(a){for(var d=new RegExp(a.template(this._patternTemplate)),e=a.result(),f=a.newResult(),g=e.size(),l=0;l<g;l++){var h=
e.get(l);if(h instanceof b.mwg.plugin.AbstractNode){var p=h.get(this._name);null!=p&&d.test(p.toString())||f.add(h.graph().cloneNode(h))}else f.add(h)}a.continueWith(f)};return a}(b.mwg.plugin.AbstractTaskAction);f.ActionWithout=e;e=function(b){function a(a){b.call(this);this._varName=a}__extends(a,b);a.prototype.eval=function(a){var b=a.template(this._varName);a.setWorld(java.lang.Long.parseLong(b));a.continueTask()};a.prototype.toString=function(){return"setWorld('"+this._varName+"')"};return a}(b.mwg.plugin.AbstractTaskAction);
f.ActionWorld=e;e=function(b){function a(a){b.call(this);this._wrapped=a}__extends(a,b);a.prototype.eval=function(a){this._wrapped(a)};a.prototype.toString=function(){return"then()"};return a}(b.mwg.plugin.AbstractTaskAction);f.ActionWrapper=e;e=function(){function d(){this._hookFactory=this._last=this._first=null}d.prototype.addAction=function(a){null==this._first?this._last=this._first=a:(this._last.setNext(a),this._last=a)};d.prototype.setWorld=function(a){this.addAction(new b.mwg.core.task.ActionWorld(a));
return this};d.prototype.setTime=function(a){this.addAction(new b.mwg.core.task.ActionTime(a));return this};d.prototype.fromIndex=function(a,c){if(null==a)throw Error("indexName should not be null");if(null==c)throw Error("query should not be null");this.addAction(new b.mwg.core.task.ActionFromIndex(a,c));return this};d.prototype.fromIndexAll=function(a){if(null==a)throw Error("indexName should not be null");this.addAction(new b.mwg.core.task.ActionFromIndexAll(a));return this};d.prototype.indexNode=
function(a,c){this.addAction(new b.mwg.core.task.ActionIndexOrUnindexNode(a,c,!0));return this};d.prototype.localIndex=function(a,c,d){this.addAction(new b.mwg.core.task.ActionLocalIndexOrUnindex(a,c,d,!0));return this};d.prototype.unindexNode=function(a,c){this.addAction(new b.mwg.core.task.ActionIndexOrUnindexNode(a,c,!1));return this};d.prototype.localUnindex=function(a,c,d){this.addAction(new b.mwg.core.task.ActionLocalIndexOrUnindex(a,c,d,!1));return this};d.prototype.selectWith=function(a,c){if(null==
c)throw Error("pattern should not be null");this.addAction(new b.mwg.core.task.ActionWith(a,c));return this};d.prototype.selectWithout=function(a,c){if(null==c)throw Error("pattern should not be null");this.addAction(new b.mwg.core.task.ActionWithout(a,c));return this};d.prototype.asGlobalVar=function(a){if(null==a)throw Error("variableName should not be null");this.addAction(new b.mwg.core.task.ActionAsVar(a,!0));return this};d.prototype.asVar=function(a){if(null==a)throw Error("variableName should not be null");
this.addAction(new b.mwg.core.task.ActionAsVar(a,!1));return this};d.prototype.defineVar=function(a){if(null==a)throw Error("variableName should not be null");this.addAction(new b.mwg.core.task.ActionDefineVar(a));return this};d.prototype.addToGlobalVar=function(a){if(null==a)throw Error("variableName should not be null");this.addAction(new b.mwg.core.task.ActionAddToVar(a,!0));return this};d.prototype.addToVar=function(a){if(null==a)throw Error("variableName should not be null");this.addAction(new b.mwg.core.task.ActionAddToVar(a,
!1));return this};d.prototype.fromVar=function(a){if(null==a)throw Error("variableName should not be null");this.addAction(new b.mwg.core.task.ActionFromVar(a,-1));return this};d.prototype.fromVarAt=function(a,c){if(null==a)throw Error("variableName should not be null");this.addAction(new b.mwg.core.task.ActionFromVar(a,c));return this};d.prototype.select=function(a){if(null==a)throw Error("filter should not be null");this.addAction(new b.mwg.core.task.ActionSelect(a));return this};d.prototype.selectObject=
function(a){if(null==a)throw Error("filterFunction should not be null");this.addAction(new b.mwg.core.task.ActionSelectObject(a));return this};d.prototype.selectWhere=function(a){throw Error("Not implemented yet");};d.prototype.get=function(a){this.addAction(new b.mwg.core.task.ActionGet(a));return this};d.prototype.traverse=function(a){this.addAction(new b.mwg.core.task.ActionTraverse(a));return this};d.prototype.traverseOrKeep=function(a){this.addAction(new b.mwg.core.task.ActionTraverseOrKeep(a));
return this};d.prototype.traverseIndex=function(a,c){if(null==a)throw Error("indexName should not be null");this.addAction(new b.mwg.core.task.ActionTraverseIndex(a,c));return this};d.prototype.traverseIndexAll=function(a){if(null==a)throw Error("indexName should not be null");this.addAction(new b.mwg.core.task.ActionTraverseIndexAll(a));return this};d.prototype.map=function(a){if(null==a)throw Error("mapFunction should not be null");this.addAction(new b.mwg.core.task.ActionMap(a));return this};d.prototype.flatMap=
function(a){throw Error("Not implemented yet");};d.prototype.group=function(a){throw Error("Not implemented yet");};d.prototype.groupWhere=function(a){throw Error("Not implemented yet");};d.prototype.inject=function(a){if(null==a)throw Error("inputValue should not be null");this.addAction(new b.mwg.core.task.ActionInject(a));return this};d.prototype.subTask=function(a){if(null==a)throw Error("subTask should not be null");this.addAction(new b.mwg.core.task.ActionSubTask(a));return this};d.prototype.isolate=
function(a){if(null==a)throw Error("subTask should not be null");this.addAction(new b.mwg.core.task.ActionIsolate(a));return this};d.prototype.subTasks=function(a){if(null==a)throw Error("subTask should not be null");this.addAction(new b.mwg.core.task.ActionSubTasks(a));return this};d.prototype.subTasksPar=function(a){if(null==a)throw Error("subTask should not be null");this.addAction(new b.mwg.core.task.ActionSubTasksPar(a));return this};d.prototype.ifThen=function(a,c){if(null==a)throw Error("condition should not be null");
if(null==c)throw Error("subTask should not be null");this.addAction(new b.mwg.core.task.ActionIfThen(a,c));return this};d.prototype.ifThenElse=function(a,c,d){if(null==a)throw Error("condition should not be null");if(null==c)throw Error("thenSub should not be null");if(null==d)throw Error("elseSub should not be null");this.addAction(new b.mwg.core.task.ActionIfThenElse(a,c,d));return this};d.prototype.whileDo=function(a,c){this.addAction(new b.mwg.core.task.ActionWhileDo(a,c));return this};d.prototype.doWhile=
function(a,c){this.addAction(new b.mwg.core.task.ActionDoWhile(a,c));return this};d.prototype.then=function(a){if(null==a)throw Error("action should not be null");this.addAction(new b.mwg.core.task.ActionWrapper(a));return this};d.prototype.foreach=function(a){if(null==a)throw Error("subTask should not be null");this.addAction(new b.mwg.core.task.ActionForeach(a));return this};d.prototype.foreachPar=function(a){if(null==a)throw Error("subTask should not be null");this.addAction(new b.mwg.core.task.ActionForeachPar(a));
return this};d.prototype.save=function(){this.addAction(new b.mwg.core.task.ActionSave);return this};d.prototype.clear=function(){this.addAction(new b.mwg.core.task.ActionClear);return this};d.prototype.lookup=function(a){this.addAction(new b.mwg.core.task.ActionLookup(a));return this};d.prototype.execute=function(a,b){this.executeWith(a,null,b)};d.prototype.executeSync=function(a){var b=a.newSyncCounter(1);this.executeWith(a,null,b.wrap());return b.waitResult()};d.prototype.executeWith=function(a,
c,d){var e=this;if(null!=this._first){c=c instanceof b.mwg.core.task.CoreTaskResult?c.clone():new b.mwg.core.task.CoreTaskResult(c,!0);var f=null;null!=this._hookFactory?f=this._hookFactory.newHook():null!=a.taskHookFactory()&&(f=a.taskHookFactory().newHook());var g=new b.mwg.core.task.CoreTaskContext(null,c,a,f,d);a.scheduler().dispatch(b.mwg.plugin.SchedulerAffinity.SAME_THREAD,function(){g.execute(e._first)})}else null!=d&&d(this.emptyResult())};d.prototype.prepareWith=function(a,c,d){c=c instanceof
b.mwg.core.task.CoreTaskResult?c.clone():new b.mwg.core.task.CoreTaskResult(c,!0);var e=null;null!=this._hookFactory?e=this._hookFactory.newHook():null!=a.taskHookFactory()&&(e=a.taskHookFactory().newHook());return new b.mwg.core.task.CoreTaskContext(null,c,a,e,d)};d.prototype.executeUsing=function(a){var c=this;null!=this._first?a.graph().scheduler().dispatch(b.mwg.plugin.SchedulerAffinity.SAME_THREAD,function(){a.execute(c._first)}):null!=a._callback&&a._callback(this.emptyResult())};d.prototype.executeFrom=
function(a,c,d,e){var f=this;if(null!=this._first){var g=new b.mwg.core.task.CoreTaskContext(a,c.clone(),a.graph(),a.hook(),e);a.graph().scheduler().dispatch(d,function(){g.execute(f._first)})}else null!=e&&e(this.emptyResult())};d.prototype.executeFromUsing=function(a,c,d,e,f){var g=this;if(null!=this._first){var l=new b.mwg.core.task.CoreTaskContext(a,c.clone(),a.graph(),a.hook(),f);null!=e&&e(l);a.graph().scheduler().dispatch(d,function(){l.execute(g._first)})}else null!=f&&f(this.emptyResult())};
d.prototype.action=function(a,c){if(null==a)throw Error("name should not be null");if(null==c)throw Error("flatParams should not be null");this.addAction(new b.mwg.core.task.ActionPlugin(a,c));return this};d.prototype.parse=function(a){if(null==a)throw Error("flat should not be null");for(var c=0,d=a.length,e=0,f=null,g=!1,l=!1;c<d;){switch(a.charAt(c)){case "'":for(l=!0;c<d&&"'"!=a.charAt(c);)c++;break;case b.mwg.Constants.TASK_SEP:g||(f=a.substring(e,c),this.action("get",f));f=null;l=!1;e=c+1;break;
case b.mwg.Constants.TASK_PARAM_OPEN:f=a.substring(e,c);e=c+1;break;case b.mwg.Constants.TASK_PARAM_CLOSE:g=l?a.substring(e+1,c-1):a.substring(e,c),this.action(f,g),f=null,e=c+1,g=!0}c++}g||(f=a.substring(e,c),0<f.length&&this.action("get",f));return this};d.prototype.newNode=function(){this.addAction(new b.mwg.core.task.ActionNewNode(null));return this};d.prototype.newTypedNode=function(a){this.addAction(new b.mwg.core.task.ActionNewNode(a));return this};d.prototype.setProperty=function(a,c,d){if(null==
a)throw Error("propertyName should not be null");if(null==d)throw Error("variableNameToSet should not be null");this.addAction(new b.mwg.core.task.ActionSetProperty(a,c,d));return this};d.prototype.removeProperty=function(a){if(null==a)throw Error("propertyName should not be null");this.addAction(new b.mwg.core.task.ActionRemoveProperty(a));return this};d.prototype.add=function(a,c){if(null==a)throw Error("relationName should not be null");if(null==c)throw Error("variableNameToAdd should not be null");
this.addAction(new b.mwg.core.task.ActionAdd(a,c));return this};d.prototype.addTo=function(a,c){if(null==a)throw Error("relationName should not be null");if(null==c)throw Error("variableNameTarget should not be null");this.addAction(new b.mwg.core.task.ActionAddTo(a,c));return this};d.prototype.properties=function(){this.addAction(new b.mwg.core.task.ActionProperties(-1));return this};d.prototype.propertiesWithType=function(a){this.addAction(new b.mwg.core.task.ActionProperties(a));return this};d.prototype.remove=
function(a,c){if(null==a)throw Error("relationName should not be null");if(null==c)throw Error("variableNameToRemove should not be null");this.addAction(new b.mwg.core.task.ActionRemove(a,c));return this};d.prototype.jump=function(a){if(null==a)throw Error("time should not be null");this.addAction(new b.mwg.core.task.ActionJump(a));return this};d.prototype.math=function(a){this.addAction(new b.mwg.core.task.ActionMath(a));return this};d.prototype.split=function(a){this.addAction(new b.mwg.core.task.ActionSplit(a));
return this};d.prototype.loop=function(a,c,d){this.addAction(new b.mwg.core.task.ActionLoop(a,c,d));return this};d.prototype.loopPar=function(a,c,d){this.addAction(new b.mwg.core.task.ActionLoopPar(a,c,d));return this};d.prototype.print=function(a){this.addAction(new b.mwg.core.task.ActionPrint(a));return this};d.prototype.hook=function(a){this._hookFactory=a;return this};d.prototype.emptyResult=function(){return new b.mwg.core.task.CoreTaskResult(null,!1)};d.prototype.mathConditional=function(a){return(new b.mwg.core.task.math.MathConditional(a)).conditional()};
d.fillDefault=function(a){a.put("get",function(a){if(1!=a.length)throw Error("get action need one parameter");return new b.mwg.core.task.ActionGet(a[0])});a.put("math",function(a){if(1!=a.length)throw Error("math action need one parameter");return new b.mwg.core.task.ActionMath(a[0])});a.put("traverse",function(a){if(1!=a.length)throw Error("traverse action need one parameter");return new b.mwg.core.task.ActionTraverse(a[0])});a.put("traverseOrKeep",function(a){if(1!=a.length)throw Error("traverseOrKeep action need one parameter");
return new b.mwg.core.task.ActionTraverseOrKeep(a[0])});a.put("fromIndexAll",function(a){if(1!=a.length)throw Error("fromIndexAll action need one parameter");return new b.mwg.core.task.ActionFromIndexAll(a[0])});a.put("fromIndex",function(a){if(2!=a.length)throw Error("fromIndex action need two parameter");return new b.mwg.core.task.ActionFromIndex(a[0],a[1])});a.put("with",function(a){if(2!=a.length)throw Error("with action need two parameter");return new b.mwg.core.task.ActionWith(a[0],a[1])});
a.put("without",function(a){if(2!=a.length)throw Error("without action need two parameter");return new b.mwg.core.task.ActionWithout(a[0],a[1])})};return d}();f.CoreTask=e;e=function(){function d(a,b,d,e,f){this._nextVariables=this._localVariables=null;this._hook=e;null!=a?(this._time=a.time(),this._world=a.world()):this._time=this._world=0;this._graph=d;this._parent=a;this._globalVariables=null==a?new java.util.ConcurrentHashMap:a.globalVariables();this._result=b;this._callback=f}d.prototype.graph=
function(){return this._graph};d.prototype.world=function(){return this._world};d.prototype.setWorld=function(a){this._world=a};d.prototype.time=function(){return this._time};d.prototype.setTime=function(a){this._time=a};d.prototype.variable=function(a){var b=this._globalVariables.get(a);null==b&&(b=this.internal_deep_resolve(a));return b};d.prototype.internal_deep_resolve=function(a){var b=null;null!=this._localVariables&&(b=this._localVariables.get(a));if(null==b&&null!=this._parent){var d=this._parent;
return null!=d._nextVariables&&(b=d._nextVariables.get(a),null!=b)?b:d.internal_deep_resolve(a)}return b};d.prototype.wrap=function(a){return new b.mwg.core.task.CoreTaskResult(a,!1)};d.prototype.wrapClone=function(a){return new b.mwg.core.task.CoreTaskResult(a,!0)};d.prototype.newResult=function(){return new b.mwg.core.task.CoreTaskResult(null,!1)};d.prototype.declareVariable=function(a){null==this._localVariables&&(this._localVariables=new java.util.HashMap);this._localVariables.put(a,new b.mwg.core.task.CoreTaskResult(null,
!1))};d.prototype.lazyWrap=function(a){return a instanceof b.mwg.core.task.CoreTaskResult?a:this.wrap(a)};d.prototype.defineVariable=function(a,b){null==this._localVariables&&(this._localVariables=new java.util.HashMap);this._localVariables.put(a,this.lazyWrap(b).clone())};d.prototype.defineVariableForSubTask=function(a,b){null==this._nextVariables&&(this._nextVariables=new java.util.HashMap);this._nextVariables.put(a,this.lazyWrap(b).clone())};d.prototype.setGlobalVariable=function(a,b){var d=this._globalVariables.put(a,
this.lazyWrap(b).clone());null!=d&&d.free()};d.prototype.setVariable=function(a,b){var d=this.internal_deep_resolve_map(a);null==d&&(null==this._localVariables&&(this._localVariables=new java.util.HashMap),d=this._localVariables);d=d.put(a,this.lazyWrap(b).clone());null!=d&&d.free()};d.prototype.internal_deep_resolve_map=function(a){if(null!=this._localVariables){var b=this._localVariables.get(a);if(null!=b)return this._localVariables}return null!=this._parent?(b=this._parent,null!=b._nextVariables&&
(b=b._nextVariables.get(a),null!=b)?this._localVariables:this._parent.internal_deep_resolve_map(a)):null};d.prototype.addToGlobalVariable=function(a,c){var d=this._globalVariables.get(a);null==d&&(d=new b.mwg.core.task.CoreTaskResult(null,!1),this._globalVariables.put(a,d));if(null!=c)if(c instanceof b.mwg.core.task.CoreTaskResult)for(var e=0;e<c.size();e++){var f=c.get(e);f instanceof b.mwg.plugin.AbstractNode?d.add(f.graph().cloneNode(f)):d.add(f)}else c instanceof b.mwg.plugin.AbstractNode?(f=
c,d.add(f.graph().cloneNode(f))):d.add(c)};d.prototype.addToVariable=function(a,c){var d=this.internal_deep_resolve_map(a);null==d&&(null==this._localVariables&&(this._localVariables=new java.util.HashMap),d=this._localVariables);var e=d.get(a);null==e&&(e=new b.mwg.core.task.CoreTaskResult(null,!1),d.put(a,e));if(null!=c)if(c instanceof b.mwg.core.task.CoreTaskResult)for(d=0;d<c.size();d++){var f=c.get(d);f instanceof b.mwg.plugin.AbstractNode?e.add(f.graph().cloneNode(f)):e.add(f)}else c instanceof
b.mwg.plugin.AbstractNode?(f=c,e.add(f.graph().cloneNode(f))):e.add(c)};d.prototype.globalVariables=function(){return this._globalVariables};d.prototype.nextVariables=function(){return this._globalVariables};d.prototype.variables=function(){return this._localVariables};d.prototype.result=function(){return this._result};d.prototype.resultAsNodes=function(){return this._result};d.prototype.resultAsStrings=function(){return this._result};d.prototype.continueWith=function(a){var b=this._result;null!=
b&&b!=a&&b.free();this._result=a;this.continueTask()};d.prototype.continueTask=function(){null!=this._hook&&this._hook.afterAction(this._current,this);var a=this._current.next();this._current=a;if(null==a){if(null!=this._localVariables)for(var a=this._localVariables.keySet(),b=a.toArray(Array(a.size())),a=0;a<b.length;a++)this._localVariables.get(b[a]).free();if(null!=this._nextVariables)for(a=this._nextVariables.keySet(),b=a.toArray(Array(a.size())),a=0;a<b.length;a++)this._nextVariables.get(b[a]).free();
if(null==this._parent)for(a=this._globalVariables.keySet(),b=a.toArray(Array(a.size())),a=0;a<b.length;a++)this._globalVariables.get(b[a]).free();null!=this._hook&&(null==this._parent?this._hook.end(this):this._hook.afterTask(this));null!=this._callback?this._callback(this._result):null!=this._result&&this._result.free()}else null!=this._hook&&this._hook.beforeAction(a,this),a.eval(this)};d.prototype.execute=function(a){this._current=a;null!=this._hook&&(null==this._parent?this._hook.start(this):
this._hook.beforeTask(this._parent,this),this._hook.beforeAction(this._current,this));this._current.eval(this)};d.prototype.template=function(a){if(null==a)return null;for(var c=0,d=null,e=-1;c<a.length;){var f=a.charAt(c),g="0",l="0";0<c&&(g=a.charAt(c-1));c+1<a.length&&(l=a.charAt(c+1));if("{"==f&&"{"==g)e=c+1;else if(-1!=e&&"}"==f&&"}"==g){null==d&&(d=new java.lang.StringBuilder,d.append(a.substring(0,e-2)));e=a.substring(e,c-1).trim();if(0<e.length&&"="==e.charAt(0)){e=b.mwg.core.task.math.CoreMathExpressionEngine.parse(e.substring(1)).eval(null,
this,new java.util.HashMap)+"";for(f=e.length-1;0<=f;f--)if("."==e.charAt(f)){e=e.substring(0,f);break}else if("0"!=e.charAt(f))break;d.append(e)}else{g=-1;if("]"==e.charAt(e.length-1)){l=-1;for(f=e.length-3;0<=f;f--)if("["==e.charAt(f)){l=f+1;break}if(-1!=l&&(g=b.mwg.core.task.TaskHelper.parseInt(e.substring(l,e.length-1)),e=e.substring(0,l-1),0>g))throw Error("Array index out of range: "+g);}f=this.variable(e);null==f&&"result"===e&&(f=this.result());if(null!=f)if(1==f.size()||-1!=g)e=-1==g?f.get(0):
f.get(g),d.append(e);else{e=f.iterator();d.append("[");f=!0;for(g=e.next();null!=g;)f?f=!1:d.append(","),d.append(g),g=e.next();d.append("]")}}e=-1}else-1!=e||null==d||"{"==f&&"{"==l||d.append(a.charAt(c));c++}return null==d?a:d.toString()};d.prototype.hook=function(){return this._hook};d.prototype.toString=function(){return"{result:"+this._result.toString()+"}"};return d}();f.CoreTaskContext=e;e=function(){function d(a,c){this._size=this._capacity=0;if(Array.isArray(a))if(this._capacity=this._size=
a.length,this._backend=Array(this._size),c)for(var d=0;d<this._size;d++){var e=a[d];this._backend[d]=e instanceof b.mwg.plugin.AbstractNode?e.graph().cloneNode(e):e}else java.lang.System.arraycopy(a,0,this._backend,0,this._size);else if(a instanceof Float64Array){e=a;this._backend=Array(e.length);for(d=0;d<e.length;d++)this._backend[d]=e[d];this._size=this._capacity=this._backend.length}else if(a instanceof Int32Array){e=a;this._backend=Array(e.length);for(d=0;d<e.length;d++)this._backend[d]=e[d];
this._size=this._capacity=this._backend.length}else if(a instanceof Float64Array){e=a;this._backend=Array(e.length);for(d=0;d<e.length;d++)this._backend[d]=e[d];this._size=this._capacity=this._backend.length}else if(a instanceof java.util.ArrayList){this._backend=Array(a.size());for(d=0;d<a.size();d++)this._backend[d]=a.get(d);this._size=this._capacity=this._backend.length}else if(a instanceof b.mwg.core.task.CoreTaskResult){if(this._size=a._size,this._capacity=a._capacity,null!=a._backend)if(this._backend=
Array(a._backend.length),c)for(d=0;d<this._size;d++)e=a._backend[d],this._backend[d]=e instanceof b.mwg.plugin.AbstractNode?e.graph().cloneNode(e):e;else java.lang.System.arraycopy(a._backend,0,this._backend,0,this._size)}else null!=a&&(this._backend=Array(1),this._size=this._capacity=1,this._backend[0]=a instanceof b.mwg.plugin.AbstractNode?c?a.graph().cloneNode(a):a:a)}d.prototype.asArray=function(){var a=Array(this._size);null!=this._backend&&java.lang.System.arraycopy(this._backend,0,a,0,this._size);
return a};d.prototype.iterator=function(){return new b.mwg.core.task.CoreTaskResultIterator(this._backend)};d.prototype.get=function(a){return a<this._size?this._backend[a]:null};d.prototype.set=function(a,b){a>=this._capacity&&this.extendTil(a);this._backend[a]=b;a>=this._size&&this._size++};d.prototype.allocate=function(a){if(a>=this._capacity)if(null==this._backend)this._backend=Array(a),this._capacity=a;else throw Error("Not implemented yet!!!");};d.prototype.add=function(a){this._size>=this._capacity&&
this.extendTil(this._size);this.set(this._size,a)};d.prototype.clear=function(){this._backend=null;this._size=this._capacity=0};d.prototype.clone=function(){return new b.mwg.core.task.CoreTaskResult(this,!0)};d.prototype.free=function(){for(var a=0;a<this._capacity;a++)this._backend[a]instanceof b.mwg.plugin.AbstractNode&&this._backend[a].free()};d.prototype.size=function(){return this._size};d.prototype.extendTil=function(a){if(this._capacity<=a){var b=2*this._capacity;b<=a&&(b=a+1);a=Array(b);null!=
this._backend&&java.lang.System.arraycopy(this._backend,0,a,0,this._size);this._backend=a;this._capacity=b}};d.prototype.toString=function(){return this.toJson(!0)};d.prototype.toJson=function(a){a=new java.lang.StringBuilder;a.append("[");for(var b=0;b<this._size;b++){0!=b&&a.append(",");var d=this._backend[b];null!=d&&a.append(d.toString())}a.append("]");return a.toString()};return d}();f.CoreTaskResult=e;e=function(){function b(a){this._current=0;this._backend=null!=a?a:[];this._size=this._backend.length}
b.prototype.next=function(){if(this._current<this._size){var a=this._backend[this._current];this._current++;return a}return null};return b}();f.CoreTaskResultIterator=e;e=function(){function d(){}d.flatNodes=function(a,c){if(a instanceof b.mwg.plugin.AbstractNode)return[a];if(Array.isArray(a)){for(var d=[],e=0;e<a.length;e++)if(a[e]instanceof b.mwg.plugin.AbstractNode){var f=Array(d.length+1);java.lang.System.arraycopy(d,0,f,0,d.length);f[d.length]=a[e];d=f}else if(Array.isArray(a[e])){var g=b.mwg.core.task.TaskHelper.flatNodes(a[e],
c),f=Array(d.length+g.length);java.lang.System.arraycopy(d,0,f,0,d.length);java.lang.System.arraycopy(g,0,f,d.length,g.length);d=f}else if(c)throw Error("[ActionIndexOrUnindexNode] The array in result contains an element with wrong type. Expected type: AbstractNode. Actual type: "+a[e]);return d}if(c)throw Error("[ActionIndexOrUnindexNode] Wrong type of result. Expected type is AbstractNode or an array of AbstractNode.Actual type is "+a);return[]};d.parseInt=function(a){return parseInt(a)};return d}();
f.TaskHelper=e;(function(d){var a=function(){function a(b){this._cacheAST=this.buildAST(this.shuntingYard(b))}a.parse=function(a){return new b.mwg.core.task.math.CoreMathExpressionEngine(a)};a.isNumber=function(a){return!isNaN(+a)};a.isDigit=function(a){a=a.charCodeAt(0);return 48<=a&&57>=a?!0:!1};a.isLetter=function(a){a=a.charCodeAt(0);return 65<=a&&90>=a||97<=a&&122>=a?!0:!1};a.isWhitespace=function(a){a=a.charCodeAt(0);return 9<=a&&13>=a||32==a||133==a||160==a?!0:!1};a.prototype.shuntingYard=
function(a){var c=new java.util.ArrayList,d=new java.util.Stack;a=new b.mwg.core.task.math.MathExpressionTokenizer(a);for(var e=null,f=null;a.hasNext();){var h=a.next();if(b.mwg.core.task.math.MathEntities.getINSTANCE().functions.keySet().contains(h.toUpperCase()))d.push(h),e=h;else if(","===h){for(;!d.isEmpty()&&"("!==d.peek();)c.add(d.pop());if(d.isEmpty())throw Error("Parse error for function '"+e+"'");}else if(b.mwg.core.task.math.MathEntities.getINSTANCE().operators.keySet().contains(h)){for(var f=
b.mwg.core.task.math.MathEntities.getINSTANCE().operators.get(h),p=d.isEmpty()?null:d.peek();b.mwg.core.task.math.MathEntities.getINSTANCE().operators.keySet().contains(p)&&(f.isLeftAssoc()&&f.getPrecedence()<=b.mwg.core.task.math.MathEntities.getINSTANCE().operators.get(p).getPrecedence()||f.getPrecedence()<b.mwg.core.task.math.MathEntities.getINSTANCE().operators.get(p).getPrecedence());)c.add(d.pop()),p=d.isEmpty()?null:d.peek();d.push(h)}else if("("===h){if(null!=f&&b.mwg.core.task.math.CoreMathExpressionEngine.isNumber(f))throw Error("Missing operator at character position "+
a.getPos());d.push(h)}else if(")"===h){for(;!d.isEmpty()&&"("!==d.peek();)c.add(d.pop());if(d.isEmpty())throw Error("Mismatched parentheses");d.pop();!d.isEmpty()&&b.mwg.core.task.math.MathEntities.getINSTANCE().functions.keySet().contains(d.peek().toUpperCase())&&c.add(d.pop())}else c.add(h);f=h}for(;!d.isEmpty();){a=d.pop();if("("===a||")"===a)throw Error("Mismatched parentheses");c.add(a)}return c};a.prototype.eval=function(a,b,c){if(null==this._cacheAST)throw Error("Call parse before");for(var d=
new java.util.Stack,e=0;e<this._cacheAST.length;e++){var f=this._cacheAST[e];switch(f.type()){case 0:var p=d.pop(),n=d.pop();d.push(f.eval(n,p));break;case 1:p=f;n=new Float64Array(p.getNumParams());for(f=p.getNumParams()-1;0<=f;f--)n[f]=d.pop();d.push(p.eval(n));break;case 2:d.push(f.content());break;case 3:if(p=f,f=null,null!=c&&(f=c.get(p.content())),null!=f)d.push(f);else if("TIME"===p.content())d.push(a.time());else{var q=p.content().trim(),r=n=null;null!=a&&(0<q.length&&"{"==q.charAt(0)&&"}"==
q.charAt(q.length-1)?(n=a.get(p.content().substring(1,q.length-1)),r=p.content().substring(1,q.length-1)):(n=a.get(p.content()),r=p.content()),0<r.length&&"$"==r.charAt(0)&&(r=r.substring(1)));if(null!=b&&null==n)if("]"==q.charAt(q.length-1)){for(var y=-1,B=-1,f=q.length-3;0<=f;f--)if("["==q.charAt(f)){y=f+1;break}-1!=y&&(B=this.parseInt(q.substring(y,q.length-1)),q=q.substring(0,y-1));f=b.variable(q);null==f&&"result"===q&&(f=b.result());null!=f&&f.size()>B&&(n=f.get(B))}else f=b.variable(q),null==
f&&"result"===q&&(f=b.result()),null!=f&&(n=f.get(0));if(null!=n)if(f=this.parseDouble(n.toString()),c.put(r,f),p=n.toString(),"true"===p)d.push(1);else if("false"===p)d.push(0);else try{d.push(f)}catch(z){if(!(z instanceof Error))throw z;}else throw Error("Unknow variable for name "+p.content());}}}a=d.pop();return null==a?0:a};a.prototype.buildAST=function(a){for(var c=Array(a.size()),d=0;d<a.size();d++){var e=a.get(d);if(b.mwg.core.task.math.MathEntities.getINSTANCE().operators.keySet().contains(e))c[d]=
b.mwg.core.task.math.MathEntities.getINSTANCE().operators.get(e);else if(b.mwg.core.task.math.MathEntities.getINSTANCE().functions.keySet().contains(e.toUpperCase()))c[d]=b.mwg.core.task.math.MathEntities.getINSTANCE().functions.get(e.toUpperCase());else if(0<e.length&&b.mwg.core.task.math.CoreMathExpressionEngine.isLetter(e.charAt(0)))c[d]=new b.mwg.core.task.math.MathFreeToken(e);else try{var f=this.parseDouble(e);c[d]=new b.mwg.core.task.math.MathDoubleToken(f)}catch(h){if(h instanceof Error)c[d]=
new b.mwg.core.task.math.MathFreeToken(e);else throw h;}}return c};a.prototype.parseDouble=function(a){return parseFloat(a)};a.prototype.parseInt=function(a){return parseInt(a)};a.decimalSeparator=".";a.minusSign="-";return a}();d.CoreMathExpressionEngine=a;a=function(){function a(c){this._expression=c;this._engine=b.mwg.core.task.math.CoreMathExpressionEngine.parse(c)}a.prototype.conditional=function(){var a=this;return function(b){var c=new java.util.HashMap;c.put("PI",Math.PI);c.put("TRUE",1);
c.put("FALSE",0);return.5<=a._engine.eval(null,b,c)}};a.prototype.toString=function(){return"cond('"+this._expression+"')"};return a}();d.MathConditional=a;a=function(){function a(b){this._content=b}a.prototype.type=function(){return 2};a.prototype.content=function(){return this._content};return a}();d.MathDoubleToken=a;a=function(){function a(){this.operators=new java.util.HashMap;this.operators.put("+",new b.mwg.core.task.math.MathOperation("+",20,!0));this.operators.put("-",new b.mwg.core.task.math.MathOperation("-",
20,!0));this.operators.put("*",new b.mwg.core.task.math.MathOperation("*",30,!0));this.operators.put("/",new b.mwg.core.task.math.MathOperation("/",30,!0));this.operators.put("%",new b.mwg.core.task.math.MathOperation("%",30,!0));this.operators.put("^",new b.mwg.core.task.math.MathOperation("^",40,!1));this.operators.put("&&",new b.mwg.core.task.math.MathOperation("&&",4,!1));this.operators.put("||",new b.mwg.core.task.math.MathOperation("||",2,!1));this.operators.put(">",new b.mwg.core.task.math.MathOperation(">",
10,!1));this.operators.put(">=",new b.mwg.core.task.math.MathOperation(">=",10,!1));this.operators.put("<",new b.mwg.core.task.math.MathOperation("<",10,!1));this.operators.put("<=",new b.mwg.core.task.math.MathOperation("<=",10,!1));this.operators.put("==",new b.mwg.core.task.math.MathOperation("==",7,!1));this.operators.put("!=",new b.mwg.core.task.math.MathOperation("!=",7,!1));this.functions=new java.util.HashMap;this.functions.put("NOT",new b.mwg.core.task.math.MathFunction("NOT",1));this.functions.put("IF",
new b.mwg.core.task.math.MathFunction("IF",3));this.functions.put("RAND",new b.mwg.core.task.math.MathFunction("RAND",0));this.functions.put("SIN",new b.mwg.core.task.math.MathFunction("SIN",1));this.functions.put("COS",new b.mwg.core.task.math.MathFunction("COS",1));this.functions.put("TAN",new b.mwg.core.task.math.MathFunction("TAN",1));this.functions.put("ASIN",new b.mwg.core.task.math.MathFunction("ASIN",1));this.functions.put("ACOS",new b.mwg.core.task.math.MathFunction("ACOS",1));this.functions.put("ATAN",
new b.mwg.core.task.math.MathFunction("ATAN",1));this.functions.put("MAX",new b.mwg.core.task.math.MathFunction("MAX",2));this.functions.put("MIN",new b.mwg.core.task.math.MathFunction("MIN",2));this.functions.put("ABS",new b.mwg.core.task.math.MathFunction("ABS",1));this.functions.put("LOG",new b.mwg.core.task.math.MathFunction("LOG",1));this.functions.put("ROUND",new b.mwg.core.task.math.MathFunction("ROUND",2));this.functions.put("FLOOR",new b.mwg.core.task.math.MathFunction("FLOOR",1));this.functions.put("CEILING",
new b.mwg.core.task.math.MathFunction("CEILING",1));this.functions.put("SQRT",new b.mwg.core.task.math.MathFunction("SQRT",1));this.functions.put("SECONDS",new b.mwg.core.task.math.MathFunction("SECONDS",1));this.functions.put("MINUTES",new b.mwg.core.task.math.MathFunction("MINUTES",1));this.functions.put("HOURS",new b.mwg.core.task.math.MathFunction("HOURS",1));this.functions.put("DAY",new b.mwg.core.task.math.MathFunction("DAY",1));this.functions.put("MONTH",new b.mwg.core.task.math.MathFunction("MONTH",
1));this.functions.put("YEAR",new b.mwg.core.task.math.MathFunction("YEAR",1));this.functions.put("DAYOFWEEK",new b.mwg.core.task.math.MathFunction("DAYOFWEEK",1))}a.getINSTANCE=function(){null==a.INSTANCE&&(a.INSTANCE=new b.mwg.core.task.math.MathEntities);return a.INSTANCE};a.INSTANCE=null;return a}();d.MathEntities=a;a=function(){function a(b){this.pos=0;this.input=b.trim()}a.prototype.hasNext=function(){return this.pos<this.input.length};a.prototype.peekNextChar=function(){return this.pos<this.input.length-
1?this.input.charAt(this.pos+1):"\x00"};a.prototype.next=function(){var a=new java.lang.StringBuilder;if(this.pos>=this.input.length)return this.previousToken=null;for(var c=this.input.charAt(this.pos);b.mwg.core.task.math.CoreMathExpressionEngine.isWhitespace(c)&&this.pos<this.input.length;)c=this.input.charAt(++this.pos);if(b.mwg.core.task.math.CoreMathExpressionEngine.isDigit(c))for(;(b.mwg.core.task.math.CoreMathExpressionEngine.isDigit(c)||c==b.mwg.core.task.math.CoreMathExpressionEngine.decimalSeparator)&&
this.pos<this.input.length;)a.append(this.input.charAt(this.pos++)),c=this.pos==this.input.length?"\x00":this.input.charAt(this.pos);else if(c==b.mwg.core.task.math.CoreMathExpressionEngine.minusSign&&b.mwg.core.task.math.CoreMathExpressionEngine.isDigit(this.peekNextChar())&&("("===this.previousToken||","===this.previousToken||null==this.previousToken||b.mwg.core.task.math.MathEntities.getINSTANCE().operators.keySet().contains(this.previousToken)))a.append(b.mwg.core.task.math.CoreMathExpressionEngine.minusSign),
this.pos++,a.append(this.next());else if(b.mwg.core.task.math.CoreMathExpressionEngine.isLetter(c)||"_"==c||"{"==c||"}"==c||"$"==c){for(;(b.mwg.core.task.math.CoreMathExpressionEngine.isLetter(c)||b.mwg.core.task.math.CoreMathExpressionEngine.isDigit(c)||"_"==c||"{"==c||"}"==c||"$"==c)&&this.pos<this.input.length;)a.append(this.input.charAt(this.pos++)),c=this.pos==this.input.length?"\x00":this.input.charAt(this.pos);if(this.pos<this.input.length&&"["==this.input.charAt(this.pos)){a.append(this.input.charAt(this.pos++));
for(c=this.pos==this.input.length?"\x00":this.input.charAt(this.pos);b.mwg.core.task.math.CoreMathExpressionEngine.isDigit(c)&&this.pos<this.input.length;)a.append(this.input.charAt(this.pos++)),c=this.pos==this.input.length?"\x00":this.input.charAt(this.pos);if("]"!=this.input.charAt(this.pos))throw Error("Error in array definition '"+a+"' at position "+(this.pos-a.length+1));a.append(this.input.charAt(this.pos++))}}else if("("==c||")"==c||","==c)a.append(c),this.pos++;else{for(;!b.mwg.core.task.math.CoreMathExpressionEngine.isLetter(c)&&
!b.mwg.core.task.math.CoreMathExpressionEngine.isDigit(c)&&"_"!=c&&!b.mwg.core.task.math.CoreMathExpressionEngine.isWhitespace(c)&&"("!=c&&")"!=c&&","!=c&&"{"!=c&&"}"!=c&&"$"!=c&&this.pos<this.input.length&&(a.append(this.input.charAt(this.pos)),this.pos++,c=this.pos==this.input.length?"\x00":this.input.charAt(this.pos),c!=b.mwg.core.task.math.CoreMathExpressionEngine.minusSign););if(!b.mwg.core.task.math.MathEntities.getINSTANCE().operators.keySet().contains(a.toString()))throw Error("Unknown operator '"+
a+"' at position "+(this.pos-a.length+1));}return this.previousToken=a.toString()};a.prototype.getPos=function(){return this.pos};return a}();d.MathExpressionTokenizer=a;a=function(){function a(b){this._content=b}a.prototype.content=function(){return this._content};a.prototype.type=function(){return 3};return a}();d.MathFreeToken=a;a=function(){function a(b,c){this.name=b.toUpperCase();this.numParams=c}a.prototype.getName=function(){return this.name};a.prototype.getNumParams=function(){return this.numParams};
a.prototype.eval=function(a){if("NOT"===this.name)return 0==a[0]?1:0;if("IF"===this.name)return 0!=a[0]?a[1]:a[2];if("RAND"===this.name)return Math.random();if("SIN"===this.name)return Math.sin(a[0]);if("COS"===this.name)return Math.cos(a[0]);if("TAN"===this.name)return Math.tan(a[0]);if("ASIN"===this.name)return Math.asin(a[0]);if("ACOS"===this.name)return Math.acos(a[0]);if("ATAN"===this.name)return Math.atan(a[0]);if("MAX"===this.name)return a[0]>a[1]?a[0]:a[1];if("MIN"===this.name)return a[0]<
a[1]?a[0]:a[1];if("ABS"===this.name)return Math.abs(a[0]);if("LOG"===this.name)return Math.log(a[0]);if("ROUND"===this.name){var b=Math.pow(10,a[1]);return Math.round(a[0]*b)/b}return"FLOOR"===this.name?Math.floor(a[0]):"CEILING"===this.name?Math.ceil(a[0]):"SQRT"===this.name?Math.sqrt(a[0]):"SECONDS"===this.name?this.date_to_seconds(a[0]):"MINUTES"===this.name?this.date_to_minutes(a[0]):"HOURS"===this.name?this.date_to_hours(a[0]):"DAY"===this.name?this.date_to_days(a[0]):"MONTH"===this.name?this.date_to_months(a[0]):
"YEAR"===this.name?this.date_to_year(a[0]):"DAYOFWEEK"===this.name?this.date_to_dayofweek(a[0]):0};a.prototype.date_to_seconds=function(a){return(new Date(a)).getSeconds()};a.prototype.date_to_minutes=function(a){return(new Date(a)).getMinutes()};a.prototype.date_to_hours=function(a){return(new Date(a)).getHours()};a.prototype.date_to_days=function(a){return(new Date(a)).getDate()};a.prototype.date_to_months=function(a){return(new Date(a)).getMonth()};a.prototype.date_to_year=function(a){return(new Date(a)).getFullYear()};
a.prototype.date_to_dayofweek=function(a){return(new Date(a)).getDay()};a.prototype.type=function(){return 1};return a}();d.MathFunction=a;a=function(){function a(b,c,d){this.oper=b;this.precedence=c;this.leftAssoc=d}a.prototype.getOper=function(){return this.oper};a.prototype.getPrecedence=function(){return this.precedence};a.prototype.isLeftAssoc=function(){return this.leftAssoc};a.prototype.eval=function(a,b){return"+"===this.oper?a+b:"-"===this.oper?a-b:"*"===this.oper?a*b:"/"===this.oper?a/b:
"%"===this.oper?a%b:"^"===this.oper?Math.pow(a,b):"&&"===this.oper?0!=a&&0!=b?1:0:"||"===this.oper?0!=a||0!=b?1:0:">"===this.oper?a>b?1:0:">="===this.oper?a>=b?1:0:"<"===this.oper?a<b?1:0:"<="===this.oper?a<=b?1:0:"=="===this.oper?a==b?1:0:"!="===this.oper?a!=b?1:0:0};a.prototype.type=function(){return 0};return a}();d.MathOperation=a})(f.math||(f.math={}))})(f.task||(f.task={}));(function(b){var e=function(){function b(a){this._counter=a;this._nb_down=new java.util.concurrent.atomic.AtomicInteger(0)}
b.prototype.count=function(){var a,b;do a=this._nb_down.get(),b=a+1;while(!this._nb_down.compareAndSet(a,b));b==this._counter&&null!=this._end&&this._end()};b.prototype.getCount=function(){return this._nb_down.get()};b.prototype.then=function(a){this._end=a;this._nb_down.get()==this._counter&&null!=a&&a()};b.prototype.wrap=function(){var a=this;return function(b){a.count()}};return b}();b.CoreDeferCounter=e;e=function(){function b(a){this._result=null;this._counter=a;this._nb_down=new java.util.concurrent.atomic.AtomicInteger(0)}
b.prototype.count=function(){this._nb_down.set(this._nb_down.get()+1);this._nb_down.get()==this._counter&&null!=this._end&&this._end()};b.prototype.getCount=function(){return this._nb_down.get()};b.prototype.then=function(a){this._end=a;this._nb_down.get()==this._counter&&null!=a&&a()};b.prototype.wrap=function(){var a=this;return function(b){a._result=b;a.count()}};b.prototype.waitResult=function(){for(;this._nb_down.get()!=this._counter;);return this._result};return b}();b.CoreDeferCounterSync=
e;e=function(){function b(a){this.wrapped=a}b.prototype.get=function(a,b){this.wrapped.get(a,b)};b.prototype.put=function(a,b){console.error("WARNING: PUT TO A READ ONLY STORAGE")};b.prototype.remove=function(a,b){console.error("WARNING: REMOVE TO A READ ONLY STORAGE")};b.prototype.connect=function(a,b){this.wrapped.connect(a,b)};b.prototype.disconnect=function(a){this.wrapped.disconnect(a)};b.prototype.lock=function(a){this.wrapped.lock(a)};b.prototype.unlock=function(a,b){this.wrapped.unlock(a,
b)};return b}();b.ReadOnlyStorage=e})(f.utility||(f.utility={}))})(f.core||(f.core={}))})(b.mwg||(b.mwg={}))})(org||(org={}));
